"use strict";(()=>{var u=[];var _t=function(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t},kt=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},le,c=class extends Error{constructor(e,t){super(t),le.set(this,void 0),_t(this,le,e,"f")}get key(){return kt(this,le,"f")}};le=new WeakMap;function U(r,e,t){return(n,o="")=>{try{let s=e.reduce((i,a)=>a(i,o),n);return t?.(s,o),Et(o,r,s)}catch(s){return Be(n,s)}}}function Be(r,e){return{initialValue:r,hasError:!0,error:e}}function Et(r,e,t){try{return e.forEach(n=>n(t,r)),{initialValue:t,result:t,hasError:!1}}catch(n){return Be(t,n)}}var W=(r,e,t,n)=>(o,s="")=>{if(!(r?!e(o):e(o)))throw new c(s,`${t??typeof o} '${o}' ${r?"is":"is not"} ${n}`)};function Tt(r,e,t,n){return`${r} ${e} is${n?" ":" not "}${t}`}function H(r){return(e,t,n,o,s)=>{if(!t())throw new c(e,Tt(r,n,o,s))}}var ue=H("array"),Ne=r=>e=>(t,n="")=>{ue(n,()=>r?t.length!==e:t.length===e,`of length ${t.length}`,`of exact length ${e}`,r)},St=r=>e=>(t,n="")=>{ue(n,()=>r?t.length<e:t.length>=e,`of length ${t.length}`,`within minimum length of ${e}`,r)},At=r=>e=>(t,n="")=>{ue(n,()=>r?t.length>e:t.length<=e,`of length ${t.length}`,`within maximum length of ${e}`,r)},Oe=r=>()=>(e,t="")=>{ue(t,()=>r?e.length!==0:e.length===0,`of length ${e.length}`,"empty",r)};function X(r=[]){let e=[],t=U(e,r,(n,o="")=>{if(!Array.isArray(n))throw new c(o,`Value ${n} is not an array`)});return t.toString=I(t,n=>n.join(", ")),t.toNumber=L(t,n=>Number(n)),t.toBoolean=v(t,n=>!!n),t.toCustom=N(t),t.assert=(n,o)=>(e.push(W(!1,n,"array",o)),t),t.ofExactLength=n=>(e.push(Ne(!1)(n)),t),t.ofMinLength=n=>(e.push(St(!1)(n)),t),t.ofMaxLength=n=>(e.push(At(!1)(n)),t),t.empty=()=>(e.push(Oe(!1)()),t),t.not={assert:(n,o)=>(e.push(W(!0,n,"array",o)),t),empty:()=>(e.push(Oe(!0)()),t),ofExactLength:n=>(e.push(Ne(!0)(n)),t)},t.items=function(n){return X([(o,s="")=>{let i=t(o,s);if(i.hasError)throw i.error;let a=i.result.map((l,D)=>n(l,[s,`[${D}]`].filter(Boolean).join(".")));if(a.some(l=>l.hasError))throw a.filter(l=>l.hasError);return a.reduce((l,D)=>(D.hasError||l.push(D.result),l),[])}])},t}var Le=H("boolean"),Ue=r=>()=>(e,t="")=>{Le(t,()=>r?!e:e,e,"true",r)},Ie=r=>()=>(e,t="")=>{Le(t,()=>r?e:!e,e,"false",r)};function ce(r=[]){let e=[],t=U(e,r,(o,s="")=>{if(typeof o!="boolean")throw new c(s,`Value ${o} is not a boolean`)});t.toString=I(t,o=>o.toString()),t.toNumber=L(t,o=>o?1:0),t.toBoolean=v(t,o=>o),t.toCustom=N(t),t.toArray=V(t);let n=o=>(s,i)=>(e.push(W(o,s,"boolean",i)),t);return t.assert=n(!1),t.true=()=>(e.push(Ue(!1)()),Q(!0,t)),t.false=()=>(e.push(Ie(!1)()),Q(!1,t)),t.not={assert:n(!0),true:()=>(e.push(Ue(!0)()),Q(!1,t)),false:()=>(e.push(Ie(!0)()),Q(!0,t))},t}function ve(r=[]){let t=U([],r,(n,o="")=>{if(typeof n!="boolean")throw new c(o,`Value ${n} is not a boolean`);if(n!==!1)throw new c(o,`Value ${n} must be false`)});return t.toString=I(t,n=>n.toString()),t.toNumber=L(t,n=>n?1:0),t.toBoolean=v(t,n=>n),t.toCustom=N(t),t.toArray=V(t),t}function Ce(r=[]){let t=U([],r,(n,o="")=>{if(typeof n!="boolean")throw new c(o,`Value ${n} is not a boolean`);if(n!==!0)throw new c(o,`Value ${n} must be true`)});return t.toString=I(t,n=>n.toString()),t.toNumber=L(t,n=>n?1:0),t.toBoolean=v(t,n=>n),t.toCustom=N(t),t.toArray=V(t),t}function De(r=[]){let e=[],t=U(e,r);t.toString=I(t,()=>""),t.toNumber=L(t,()=>0),t.toBoolean=v(t,()=>!1),t.toCustom=N(t),t.toArray=V(t);let n=o=>(s,i)=>(e.push(W(o,s,"custom value",i)),t);return t.assert=n(!1),t.not={assert:n(!0)},t}var z=H("number"),Me=r=>e=>(t,n="")=>{if(!(r?e.indexOf(t)===-1:e.indexOf(t)!==-1))throw new c(n,`Number value ${t} ${r?`is one of the disallowed values in [${e.join(", ")}]`:`is not one of the allowed values in [${e.join(", ")}]`}`)},We=r=>()=>(e,t="")=>{z(t,()=>r?e<0:e>0,e,"positive",r)},$e=r=>()=>(e,t="")=>{z(t,()=>r?e>0:e<0,e,"negative",r)},Ve=r=>()=>(e,t="")=>{z(t,()=>r?e!==0:e===0,e,"zero",r)},je=r=>e=>(t,n="")=>{z(n,()=>r?t>=e:t<e,t,`less than ${e}`,r)},qe=r=>e=>(t,n="")=>{z(n,()=>r?t<=e:t>e,t,`more than ${e}`,r)},He=r=>e=>(t,n="")=>{z(n,()=>r?t!==e:t===e,t,`equal to ${e}`,r)},ze=r=>e=>(t,n="")=>{z(n,()=>r?t%e!==0:t%e===0,t,`a multiple of ${e}`,r)},Ke=r=>()=>(e,t="")=>{z(t,()=>r?!Number.isInteger(e):Number.isInteger(e),e,"an integer",r)};function me(r=[]){let e=[],t=U(e,r,(o,s="")=>{if(typeof o!="number")throw new c(s,`Value ${o} is not a number`)});t.toString=I(t,o=>o.toString()),t.toNumber=L(t,o=>o),t.toBoolean=v(t,o=>o!==0),t.toCustom=N(t),t.toArray=V(t);let n=o=>(s,i)=>(e.push(W(o,s,"number",i)),t);return t.assert=n(!1),t.allowed=(...o)=>(e.push(Me(!1)(o)),t),t.integer=()=>(e.push(Ke(!1)()),t),t.positive=()=>(e.push(We(!1)()),t),t.negative=()=>(e.push($e(!1)()),t),t.lessThan=o=>(e.push(je(!1)(o)),t),t.moreThan=o=>(e.push(qe(!1)(o)),t),t.zero=()=>(e.push(Ve(!1)()),t),t.multipleOf=o=>(e.push(ze(!1)(o)),t),t.equals=o=>(e.push(He(!1)(o)),t),t.not={assert:n(!0),allowed:(...o)=>(e.push(Me(!0)(o)),t),integer:()=>(e.push(Ke(!0)()),t),positive:()=>(e.push(We(!0)()),t),negative:()=>(e.push($e(!0)()),t),lessThan:o=>(e.push(je(!0)(o)),t),moreThan:o=>(e.push(qe(!0)(o)),t),zero:()=>(e.push(Ve(!0)()),t),multipleOf:o=>(e.push(ze(!0)(o)),t),equals:o=>(e.push(He(!0)(o)),t)},t}function pe(r=[]){let e=[],t=U(e,r);t.toCustom=N(t);let n=o=>(s,i)=>(e.push(W(o,s,"custom value",i)),t);return t.assert=n(!1),t.not={assert:n(!0)},t}function I(r,e){return(t=e)=>fe([(n,o="")=>{let s=r(n,o);if(s.hasError)throw s.error;try{return t(s.result)}catch(i){throw new c(o,`Unable to create a string from ${typeof s.result} ${s.result}

 ${i instanceof Error?i.message:i}`)}}])}function L(r,e){return(t=e)=>me([(n,o="")=>{let s=r(n,o);if(s.hasError)throw s.error;try{return t(s.result)}catch(i){throw new c(o,`Unable to create a number from ${typeof s.result} ${s.result}

 ${i instanceof Error?i.message:i}`)}}])}function v(r,e){return(t=e)=>ce([(n,o="")=>{let s=r(n,o);if(s.hasError)throw s.error;try{return t(s.result)}catch(i){throw new c(o,`Unable to create a booolean from ${typeof s.result} ${s.result}

 ${i instanceof Error?i.message:i}`)}}])}function N(r){return e=>De([(t,n="")=>{let o=r(t,n);if(o.hasError)throw o.error;try{return e(o.result)}catch(s){throw new c(n,`Unable to create custom type from ${typeof o.result} ${o.result}

 ${s instanceof Error?s.message:s}`)}}])}function V(r){return e=>X([(t,n="")=>{let o=r(t,n);if(o.hasError)throw o.error;try{return e(o.result)}catch(s){throw new c(n,`Unable to create an array from ${typeof o.result} ${o.result}

 ${s instanceof Error?s.message:s}`)}}])}function Te(r){return pe([(e,t="")=>{let n=r(e,t);if(n.hasError)throw n.error;return e}])}function Q(r,e){return(r?Ce:ve)([(n,o="")=>{let s=e(n,o);if(s.hasError)throw s.error;return n}])}var Xe=H("string"),Je=(r,e)=>t=>(n,o="")=>{Xe(o,()=>{let s=e?t:t.toLowerCase(),i=e?n:n.toLowerCase();return r?i!==s:i===s},n,"equal to",r)},Ye=(r,e)=>t=>(n,o="")=>{let s=e?t:t.map(l=>l.toLowerCase()),i=e?n:n.toLowerCase();if(!(r?s.indexOf(i)===-1:s.indexOf(i)!==-1))throw new c(o,`String value ${n} ${r?`is one of the disallowed values in [${t.join(", ")}]`:`is not one of the allowed values in [${t.join(", ")}]`}`)},Ge=r=>()=>(e,t="")=>{Xe(t,()=>r?e.length!==0:e.length===0,e,"empty",r)},Ze=r=>e=>(t,n="")=>{if(!(r?!e.test(t):e.test(t)))throw new c(n,`String value '${t}' ${r?"matches":"does not match"} pattern ${e}`)};function fe(r=[]){let e=[],t={enabled:!0},n=U(e,r,(s,i="")=>{if(typeof s!="string")throw new c(i,`Value ${s} is not a string`)});n.toString=I(n,s=>s),n.toNumber=L(n,s=>Number(s)),n.toBoolean=v(n,s=>!!s),n.toCustom=N(n),n.toArray=V(n);let o=s=>(i,a)=>(e.push(W(s,i,"string",a)),n);return n.assert=o(!1),n.allowed=(...s)=>(e.push(Ye(!1,t.enabled)(s)),Te(n)),n.matches=s=>(e.push(Ze(!1)(s)),n),n.empty=()=>(e.push(Ge(!1)()),n),n.equals=s=>(e.push(Je(!1,t.enabled)(s)),Te(n)),n.case=s=>(t.enabled=s==="sensitive",n),n.not={assert:o(!0),allowed:(...s)=>(e.push(Ye(!0,t.enabled)(s)),n),matches:s=>(e.push(Ze(!0)(s)),n),empty:()=>(e.push(Ge(!0)()),n),equals:s=>(e.push(Je(!0,t.enabled)(s)),n)},n}function de(...r){return(e,t="")=>{let n=[];for(let o of r){let s=o(e,t);if(!s.hasError)return s;n.push(s)}return{hasError:!0,initialValue:e,error:n}}}function ye(r=[]){let e=U([],r,(t,n="")=>{if(t!==void 0)throw new c(n,`Value ${t} is not undefined`)});return e.toString=I(e,()=>String(void 0)),e.toNumber=L(e,()=>NaN),e.toBoolean=v(e,()=>!1),e.toCustom=N(e),e.toArray=V(e),e}function ge(...r){return de(ye(),...r)}function be(r=[]){let e=[],t=U(e,r,(o,s="")=>{if(o===null||typeof o!="object"||Array.isArray(o))throw new c(s,`Value ${o} is not an object`)});t.toString=I(t,o=>String(o)),t.toNumber=L(t,o=>Number(o)),t.toBoolean=v(t,o=>!!o),t.toCustom=N(t);let n=o=>(s,i)=>(e.push(W(o,s,"object",i)),t);return t.assert=n(!1),t.not={assert:n(!0)},t.schema=function(o){return be([(s,i="")=>{let a=t(s,i);if(a.hasError)throw a.error;let l={...s??{},...a.result},D=Object.entries(o).map(([m,B])=>[m,B(l[m],[i,m].filter(Boolean).join("."))]),C=D.filter(([,m])=>m.hasError);if(C.length>0)throw C.reduce((m,[B,O])=>(m[B]=O,m),{});return D.reduce((m,[B,O])=>(O.hasError||(m[B]=O.result),m),l)}])},t.partial=function(o){return be([(s,i="")=>{let a=t(s,i);if(a.hasError)throw a.error;let l={...s??{},...a.result},D=Object.entries(o).map(([m,B])=>{let O=ge(B)(l[m],[i,m].filter(Boolean).join("."));return O.hasError&&console.error("ERROR IS HERE",O.error),[m,O]}),C=D.filter(([,m])=>m.hasError);if(C.length>0)throw C.reduce((m,[B,O])=>(m[B]=O,m),{});return D.reduce((m,[B,O])=>(O.hasError||O.result!==void 0&&(m[B]=O.result),m),l)}])},t}function Qe(r=[]){let e=U([],r,(t,n="")=>{if(t!==null)throw new c(n,`Value ${t} is not null`)});return e.toString=I(e,()=>String(null)),e.toNumber=L(e,()=>0),e.toBoolean=v(e,()=>!1),e.toCustom=N(e),e}function et(){let r=U([],[],(e,t="")=>{if(e!==null)throw new c(t,`Value ${e} is not an error`)});return r.toString=I(r,e=>String(e)),r.toNumber=L(r,()=>0),r.toBoolean=v(r,()=>!1),r.toCustom=N(r),r}function tt(r){let e=(t,n="")=>{if(!t||typeof t!="object"||Array.isArray(t))return{initialValue:t,hasError:!0,error:new c(n,`Value ${t} is not a record`)};let o=Object.entries(t).map(([s,i],a)=>r(i,[s,`[${a}]`].filter(Boolean).join(".")));return o.some(s=>s.hasError)?{initialValue:t,hasError:!0,error:o.filter(s=>s.hasError)}:{hasError:!1,initialValue:t,result:t}};return e.toString=I(e,t=>String(t)),e.toNumber=L(e,t=>Number(t)),e.toBoolean=v(e,t=>!!t),e.toCustom=N(e),e.toArray=V(e),e}var P={string:fe,number:me,boolean:ce,array:X,object:be,error:et,null:Qe,undefined:ye,oneof:de,stringUnion:pe,record:tt,optional:ge,anything:()=>r=>({initialValue:r,hasError:!1,result:r})};function K(r){return e=>!r(e).hasError}function rt(r){return!!(r&&typeof r=="object"&&!Array.isArray(r))}function xe(r){return{success:!1,error:r}}function nt(r){return{success:!0,value:r}}function ee(r){try{let e=r();return ot(e)?e:nt(e)}catch(e){return xe(e)}}async function $(r){try{let e=await r();return ot(e)?e:nt(e)}catch(e){return xe(e)}}function ot(r){return rt(r)&&typeof r.success=="boolean"&&(r.success&&"value"in r||!r.success&&"error"in r)}function st(r){return ee(()=>JSON.parse(r))}function it(r){return ee(()=>JSON.stringify(r))}var j=class r extends Error{_error;_type;_state;static SerializedType="JSONableError";constructor(e){super(typeof e=="string"?e:void 0),this._error=typeof e=="string"?this:e,this._type=r.SerializedType}toJSON(){return{__serialized_type:this._type,stack:this._error.stack,message:this._error.message,name:this._error.name,state:this._state}}static create(e){if(e instanceof Error)return new r(e);if(typeof e=="string"||typeof e=="boolean"||typeof e=="number"||typeof e=="symbol"||typeof e=="bigint"||typeof e=="function")return new r(e.toString());if(Rt(e))return Pt(e);let t=it(e);return t.success?new r(t.value):new r("Unserializeable data error")}setState(e){this._state=e}},Ft=P.object().schema({__serialized_type:P.string().equals(j.SerializedType),stack:P.optional(P.string()),message:P.string(),name:P.string(),state:P.anything()}),Rt=K(Ft);function Pt(r){let e=new Error;return e.stack=r.stack,e.name=r.name,e.message=r.message,new j(e)}var Se=class r extends j{static SerializedType="UnexpectedResponseError";constructor(e,t={}){super(`Expected [${e}] response was not valid`),this._type=r.SerializedType,this.setState({expectedType:e,errors:t})}},Bt=P.object().schema({__serialized_type:P.string().equals(Se.SerializedType),stack:P.optional(P.string()),message:P.string(),name:P.string(),state:P.object().schema({expectedType:P.string(),errors:P.record(P.string())})}),Xc=K(Bt);var Ae=class extends Error{_element;constructor(e,t){super(`Elements of type [${t}] cannot be packed across contexts`),this._element=e}get element(){return this._element}};var te=class r{_binaries;_packedBuffer;_packHeader;constructor(){this._binaries={},this._packedBuffer=new Uint8Array,this._packHeader={packTime:0,rootPackType:{type:"undefined"},binaryLengths:{}}}get packHeader(){return this._packHeader}get packedBuffer(){return this._packedBuffer}get nextBinIndex(){return Object.keys(this._binaries).length}get combinedBinaryLength(){return Object.values(this._binaries).reduce((e,t)=>e+t.byteLength,0)}static sortObjectAsEntries=e=>Object.entries(e).sort(([t],[n])=>Number(t)-Number(n));static safePack=e=>$(()=>r.pack(e));static pack=async e=>{let t=new r,n=await t.packUnknownElement(e,t),o=r.sortObjectAsEntries(t._binaries),s={packTime:new Date().getTime(),rootPackType:n,binaryLengths:o.reduce((C,[m,B])=>(C[m]=B.byteLength,C),{})},i=new TextEncoder().encode(JSON.stringify(s)),a=new Uint8Array(4+i.byteLength+t.combinedBinaryLength),l=new DataView(new ArrayBuffer(4));l.setInt32(0,i.byteLength),a.set(new Uint8Array(l.buffer),0),a.set(i,4);let D=4+i.length;for(let[,C]of o){let m=new Uint8Array(C);a.set(m,D),D+=m.byteLength}return t._packedBuffer=a,t._packHeader=s,t};packImageData=(e,t)=>({type:"image_data",value:{colorSpace:e.colorSpace,width:e.width,height:e.height,data:this.packUintArray(2,e.data,t)}});packUintArray=(e,t,n)=>{let o=n.nextBinIndex;return n._binaries[o]=t.buffer,{type:"binary",binaryType:e,index:o,byteLength:t.byteLength}};packUnknownElement=async(e,t)=>{let n=r.getPackingConstraints(e);if(n)throw new Ae(e,n);if(e===null)return{type:"null"};if(e===void 0)return{type:"undefined"};if(typeof e=="string")return{type:"string",value:e};if(typeof e=="number")return{type:"number",value:e};if(typeof e=="boolean")return{type:"boolean",value:e};if(e instanceof Date)return{type:"date",value:e.getTime()};if(e instanceof BigInt)return{type:"bigint",radix:16,value:e.toString(36)};if(e instanceof Blob){let s=t.nextBinIndex,i=await e.arrayBuffer();return t._binaries[s]=i,{type:"binary",binaryType:0,index:s,byteLength:i.byteLength,mimeType:e.type}}return e instanceof Uint8Array?this.packUintArray(1,e,t):e instanceof Uint8ClampedArray?this.packUintArray(2,e,t):e instanceof Uint16Array?this.packUintArray(3,e,t):e instanceof Uint32Array?this.packUintArray(4,e,t):e instanceof ImageData?this.packImageData(e,t):Array.isArray(e)?{type:"array",values:Object.fromEntries(await Promise.all(e.map(async(s,i)=>[i,await this.packUnknownElement(s,t)])))}:{type:"object",value:await Promise.all(Object.entries(e).map(async([s,i])=>({key:s,value:await this.packUnknownElement(i,t)}),[]))}};static isBinaryType=e=>e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Blob;static getPackingConstraints=e=>{if(!(!e||Array.isArray(e)||r.isBinaryType(e)||e instanceof ImageData)){if(typeof e=="symbol"||typeof e=="function")return typeof e;if(e instanceof Promise)return"promise";if(typeof e=="object"&&e.constructor.name!=="Object")return e.constructor.name}};static safeUnpack=e=>ee(()=>r.unpack(e));static unpack=e=>{if(e.byteLength<4)throw new Error("Invalid buffer in binary pack");let t=e.slice(0,4),n=4,o=new DataView(t.buffer).getInt32(0),s=e.slice(n,n+o),i=new TextDecoder().decode(s),a=st(i);if(!a.success)throw new Error("Unable to decode binary pack header");n+=o;let l=new r;l._packHeader=a.value,l._packedBuffer=e;let D=r.sortObjectAsEntries(l._packHeader.binaryLengths);for(let[C,m]of D){let B=e.slice(n,n+m);n+=m,l._binaries[C]=B.buffer}return l.unpackUnknownValue(l._packHeader.rootPackType,l)};unpackUnknownValue=(e,t)=>{if(e.type!=="undefined"){if(e.type==="null")return null;if(e.type==="string"||e.type==="boolean"||e.type==="number")return e.value;if(e.type==="date")return new Date(e.value);if(e.type==="bigint")return BigInt(`0x${e.value}`);if(e.type==="binary")return this.unpackBinary(e,t);if(e.type==="array")return r.sortObjectAsEntries(e.values).map(([,o])=>this.unpackUnknownValue(o,t));if(e.type==="image_data"){let n=this.unpackBinary(e.value.data,t);return new ImageData(n,e.value.width,e.value.height,{colorSpace:e.value.colorSpace})}if(e.type==="object")return e.value.reduce((n,{key:o,value:s})=>(n[o]=this.unpackUnknownValue(s,t),n),{});throw new Error(`Unknown packing type [${e.type}]`)}};unpackBinary(e,t){let n=e.index;if(e.binaryType===0)return new Blob([t._binaries[n]],{type:e.mimeType});if(e.binaryType===1)return new Uint8Array(t._binaries[n]);if(e.binaryType===2)return new Uint8ClampedArray(t._binaries[n]);if(e.binaryType===3)return new Uint16Array(t._binaries[n]);if(e.binaryType===4)return new Uint32Array(t._binaries[n]);throw new Error("Unable to unpack unknown binary")}};function Z(...r){}globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION||(globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION=globalThis.console);var at=globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION;var lt=null,Nt=(u??[]).map(r=>r.split(".")),J=at;globalThis.console===J&&(globalThis.console=new Proxy(J,{get:()=>Z}));function Y(r){return ut(r,Nt)||lt&&!ut(r,lt)?{log:Z,warn:Z,error:(e,...t)=>J.error(`[${r}] ${e}`,...t),info:Z,debug:Z}:{log:(e,...t)=>J.log(`[${r}] ${e}`,...t),warn:(e,...t)=>J.warn(`[${r}] ${e}`,...t),error:(e,...t)=>J.error(`[${r}] ${e}`,...t),info:(e,...t)=>J.info(`[${r}] ${e}`,...t),debug:(e,...t)=>J.debug(`[${r}] ${e}`,...t)}}function ut(r,e){let t=r.split(".");for(let n of e){let o=0,s=!0;for(;o<t.length;){if(n[o]==="*"){if(n.length-1===o){s=!0;break}o+=1;continue}if(n[o]===t[o]){o+=1;continue}s=!1;break}if(s)return!0}return!1}var Ot=P.object().schema({result_type:P.string().allowed("string_literal","serialized_error"),result_value:P.string()});function Fe(r,e){return{result_type:r,result_value:e}}var gf=K(Ot);var Ut=P.object().schema({keepalive:P.oneof(P.number(),P.boolean().false()),maxConcurrency:P.oneof(P.string().equals("max"),P.number())}),It=P.object().schema({ready:P.boolean().true(),poolSettings:Ut}),qf=K(It),Hf=Y("offscreen.initialize_worker");async function Lt(r,e){let t=a=>self.postMessage(self.postMessage(Fe("serialized_error",JSON.stringify(j.create(a)))));if(!e.task_id)return t("No valid task ID provided to worker");if(!e.binary||!(e.binary instanceof Uint8Array))return t("No valid binary provided for worker parameters");let n=te.safeUnpack(e.binary);if(!n.success)return t(n.error instanceof Error?n.error:"Failed to unpack worker parameters");let o=n.value;if(!Array.isArray(o))return t(`Expected array of parameters but received [${typeof o}]`);let s=await $(()=>r.apply(self,o));if(!s.success)return t(s.error instanceof Error?s.error:String(s.error));if(typeof s.value=="string")return self.postMessage(Fe("string_literal",s.value));let i=await te.safePack(s.value);return i.success?self.postMessage(i.value.packedBuffer,{transfer:[i.value.packedBuffer.buffer]}):t(i.error instanceof Error?i.error:"Unable to create binary pack of response data from worker")}function ct(r,e={keepalive:1e3,maxConcurrency:"max"}){self.postMessage({ready:!0,poolSettings:e}),self.addEventListener("message",async t=>Lt(r,t.data))}var re=globalThis.browser??globalThis.chrome;re&&re.runtime&&(re.runtime.OnInstalledReason=re.runtime.OnInstalledReason??{INSTALL:"install",UPDATE:"update",CHROME_UPDATE:"chrome_update",SHARED_MODULE_UPDATE:"shared_module_update"});var vt={},Id=Y("m.document_content_extraction"),mt={"squarex_textextraction_bg.wasm":"./module_statics/document-content-extraction/squarex_textextraction_bg.wasm"};var Ld=new Proxy(vt,{get:(r,e,t)=>{if(e==="Content"){let n=globalThis.ContentModule?.documentContentExtraction;if(!n)throw globalThis.ServiceWorkerGlobalScope?new Error("Content modules can not be loaded in a background script"):new Error("Content modules can only be loaded after initialization");return n}if(e==="Background"){let n=globalThis.BackgroundModule?.documentContentExtraction;if(!n)throw globalThis.ServiceWorkerGlobalScope?new Error("Background modules can only be loaded after initialization"):new Error("Background modules can not be loaded in a content script");return n}}});var Ct=Y("m.document_content_extraction"),M,pt=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&pt.decode();var ne=null;function se(){if(!M)throw new Error("WASM is not initialized");return(ne===null||ne.byteLength===0)&&(ne=new Uint8Array(M.memory.buffer)),ne}function ft(r,e){return r=r>>>0,pt.decode(se().subarray(r,r+e))}var q=new Array(128).fill(void 0);q.push(void 0,null,!0,!1);var ie=q.length;function Dt(r){ie===q.length&&q.push(q.length+1);let e=ie;return ie=q[e],q[e]=r,e}var ae=0;function Mt(r,e){let t=e(r.length*1,1)>>>0;return se().set(r,t/1),ae=r.length,t}var he=typeof TextEncoder<"u"?new TextEncoder:{encode:()=>{throw Error("TextEncoder not available")}},Wt=typeof he.encodeInto=="function"?function(r,e){return he.encodeInto(r,e)}:function(r,e){let t=he.encode(r);return e.set(t),{read:r.length,written:t.length}};function $t(r,e,t){if(t===void 0){let a=he.encode(r),l=e(a.length,1)>>>0;return se().subarray(l,l+a.length).set(a),ae=a.length,l}let n=r.length,o=e(n,1)>>>0,s=se(),i=0;for(;i<n;i++){let a=r.charCodeAt(i);if(a>127)break;s[o+i]=a}if(i!==n){i!==0&&(r=r.slice(i)),o=t(o,n,n=i+r.length*3,1)>>>0;let a=se().subarray(o+i,o+n),l=Wt(r,a);i+=l.written,o=t(o,n,i,1)>>>0}return ae=i,o}var oe=null;function we(){if(!M)throw new Error("WASM not initialized!");return(oe===null||oe.byteLength===0)&&(oe=new Int32Array(M.memory.buffer)),oe}function Vt(r){return q[r]}function jt(r){r<132||(q[r]=ie,ie=r)}function qt(r){let e=Vt(r);return jt(r),e}function dt(r,e){if(!M)throw new Error("WASM not initialized!");let t,n;try{let o=M.__wbindgen_add_to_stack_pointer(-16),s=Mt(r,M.__wbindgen_malloc),i=ae,a=$t(e,M.__wbindgen_malloc,M.__wbindgen_realloc),l=ae;M.extract_document_text(o,s,i,a,l);let D=we()[o/4+0],C=we()[o/4+1],m=we()[o/4+2],B=we()[o/4+3],O=D,Ee=C;if(B)throw O=0,Ee=0,qt(m);return t=O,n=Ee,ft(O,Ee)}finally{M.__wbindgen_add_to_stack_pointer(16),M.__wbindgen_free(t,n,1)}}async function Ht(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")Ct.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}let t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function zt(){let r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){let n=new Error(ft(e,t));return Dt(n)},r}function Kt(r,e){return M=r.exports,yt.__wbindgen_wasm_module=e,oe=null,ne=null,M}async function yt(){if(M!==void 0)return M;let r=mt["squarex_textextraction_bg.wasm"],e=zt();let{instance:t,module:n}=await Ht(await fetch(r),e);return Kt(t,n)}var gt=yt;var Jt=1,Yt="idfs",G="files",Re="fileNameIdx",_e=class{static db=null;static async _openDB(){return this.db?this.db:new Promise((e,t)=>{let n=indexedDB.open(Yt,Jt);n.onupgradeneeded=o=>{let s=o.target.result;s.objectStoreNames.contains(G)||s.createObjectStore(G,{keyPath:["fileName","position"]}).createIndex(Re,"fileName",{unique:!1})},n.onsuccess=()=>{this.db=n.result,e(this.db)},n.onerror=()=>t(n.error)})}static async _saveChunk(e,t,n){let o=await this._openDB();return new Promise((s,i)=>{let a=o.transaction(G,"readwrite");a.objectStore(G).put({fileName:e,position:t,chunk:n}),a.oncomplete=()=>s(!0),a.onerror=()=>i(a.error)})}static async saveChunk(e,t,n){return $(()=>this._saveChunk(e,t,n))}static async _getFileContents(e){let t=await this._openDB();return new Promise((n,o)=>{let a=t.transaction(G,"readonly").objectStore(G).index(Re).getAll(e);a.onsuccess=()=>{let l=a.result.filter(B=>B.fileName===e).sort((B,O)=>B.position-O.position).map(B=>B.chunk);if(l.length===0){n(null);return}let D=l.reduce((B,O)=>B+O.byteLength,0),C=new Uint8Array(D),m=0;for(let B of l)C.set(new Uint8Array(B),m),m+=B.byteLength;n(C)},a.onerror=()=>o(a.error)})}static async getFileContents(e){return $(()=>this._getFileContents(e))}static async _deleteFile(e){let t=await this._openDB();return new Promise((n,o)=>{let s=t.transaction(G,"readwrite"),i=s.objectStore(G),l=i.index(Re).getAll(e);l.onsuccess=()=>{l.result.filter(C=>C.fileName===e).forEach(C=>i.delete([e,C.position])),s.oncomplete=()=>n(!0),s.onerror=()=>o(s.error)},l.onerror=()=>o(l.error)})}static async deleteFile(e){return $(()=>this._deleteFile(e))}};var bt=Y("common.opfs"),Pe=class extends j{static SerializedType="OPFSError";constructor(e){let t=e instanceof Error?e.message:e;super(`Error during OPFS operation: ${t}`),this.setState({originalError:e})}},ke=class r{static isSupported=()=>typeof navigator.storage?.getDirectory=="function";static async asFailable(e){let t=await $(e);return t.success?t:xe(new Pe(t.error instanceof Error?t.error:JSON.stringify(t)))}static async _getRootDirectory(){return navigator.storage.getDirectory()}static async _getDirectoryHandle(e){if(!e.endsWith("/")&&e!=="")throw new Error("path should end with / or should be blank for root");e==="/"&&(e="");let t=await r._getRootDirectory(),n=e.split("/"),o=t;for(let s=0;s<n.length-1;s++){let i=await $(()=>o.getDirectoryHandle(n[s],{create:!0}));if(i.success)o=i.value;else throw bt.error(`error getting directory handle for [${n[s]}]`,i.error),new Error(`error getting directory handle for [${n[s]}]`)}return o}static async _getFileHandle(e,t){let n=e.lastIndexOf("/"),o=await r._getDirectoryHandle(e.substring(0,n+1)),s=e.substring(n+1);return await o.getFileHandle(s,t)}static async _getFile(e){return(await this._getFileHandle(e,{create:!1})).getFile()}static async _getFileWriteStream(e,t){return(await this._getFileHandle(e,{create:t?.create??!1})).createWritable({keepExistingData:t?.keepExistingData??!1})}static async _writeFile(e,t,n={keepExistingData:!1}){let o=await r._getFileWriteStream(e,{keepExistingData:n.keepExistingData,create:!0});await o.write(t),await o.close()}static async getFileWriteStream(e,t){return r.asFailable(()=>r._getFileWriteStream(e,t))}static async writeFile(e,t,n){return r.asFailable(()=>r._writeFile(e,t,n))}static async getFileReadStream(e){return r.asFailable(async()=>(await r._getFile(e)).stream())}static async getFile(e){return r.asFailable(()=>r._getFile(e))}static async readFileHeader(e,t){return r.asFailable(async()=>{let n=(await r._getFile(e)).slice(0,t).stream(),o=new Response(n);return new Uint8Array(await o.arrayBuffer())})}static async readAllFileBytes(e){return r.asFailable(async()=>{let t=(await r._getFile(e)).stream(),n=new Response(t);return new Uint8Array(await n.arrayBuffer())})}static async readAllFileText(e){let t=await r.getFileReadStream(e);return t.success?r.asFailable(async()=>{let n=new TextDecoderStream;t.value.pipeTo(n.writable);let o=n.readable.getReader(),s=!1,i="";for(;!s;){let a=await o.read();a.value&&(i+=a.value),s=a.done}return i}):t}static async destroyFileInDir(e,t){return r.asFailable(async()=>await t.removeEntry(e,{recursive:!0}))}static async destroyFile(e){return r.asFailable(async()=>{let t=e.lastIndexOf("/"),n=await r._getDirectoryHandle(e.substring(0,t+1)),o=e.substring(t+1);return await n.removeEntry(o,{recursive:!0})})}static async _listFiles(e){let t=e.values(),n=[];for await(let o of t){let s=o;s.kind==="directory"?n.push(...await this._listFiles(s)):n.push({dirHandle:e,fileName:s.name})}return n}static async listFiles(e){let t=await $(()=>this._getDirectoryHandle(e));return t.success?this._listFiles(t.value):(bt.error("error getting handle",t.error),[])}};var xt=(r,e)=>$(async()=>{switch(e){case"opfs":{let t=await ke.readAllFileBytes(r);if(!t.success)throw new j("failed to get file from "+e);return t.value}case"idfs":{let t=await _e.getFileContents(r);if(!t.success||t.value==null)throw new j("failed to get file from "+e);return t.value}case"url":{let t=await $(()=>fetch(r));if(!t.success)throw new j("failed to get file from "+e);return new Uint8Array(await t.value.arrayBuffer())}}});async function wt(r){await gt();let e=await xt(r.identifier,r.identifierType);if(!e.success)throw e.error;return dt(e.value,r.mime)}ct(wt,{maxConcurrency:4,keepalive:1e4});})();
