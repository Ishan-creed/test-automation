"use strict";(()=>{var f=[];var Ue=Symbol("Comlink.proxy"),St=Symbol("Comlink.endpoint"),At=Symbol("Comlink.releaseProxy"),xe=Symbol("Comlink.finalizer"),ie=Symbol("Comlink.thrown"),De=r=>typeof r=="object"&&r!==null||typeof r=="function",Ft={canHandle:r=>De(r)&&r[Ue],serialize(r){let{port1:e,port2:t}=new MessageChannel;return $e(r,e),[t,[t]]},deserialize(r){return r.start(),Le(r)}},Pt={canHandle:r=>De(r)&&ie in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Be=new Map([["proxy",Ft],["throw",Pt]]);function Ct(r,e){for(let t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function $e(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!Ct(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}let{id:o,type:a,path:s}=Object.assign({path:[]},i.data),u=(i.data.argumentList||[]).map(K),p;try{let m=s.slice(0,-1).reduce((c,U)=>c[U],r),l=s.reduce((c,U)=>c[U],r);switch(a){case"GET":p=l;break;case"SET":m[s.slice(-1)[0]]=K(i.data.value),p=!0;break;case"APPLY":p=l.apply(m,u);break;case"CONSTRUCT":{let c=new l(...u);p=Bt(c)}break;case"ENDPOINT":{let{port1:c,port2:U}=new MessageChannel;$e(r,U),p=je(c,[c])}break;case"RELEASE":p=void 0;break;default:return}}catch(m){p={value:m,[ie]:0}}Promise.resolve(p).catch(m=>({value:m,[ie]:0})).then(m=>{let[l,c]=se(m);e.postMessage(Object.assign(Object.assign({},l),{id:o}),c),a==="RELEASE"&&(e.removeEventListener("message",n),Ie(e),xe in r&&typeof r[xe]=="function"&&r[xe]())}).catch(m=>{let[l,c]=se({value:new TypeError("Unserializable return value"),[ie]:0});e.postMessage(Object.assign(Object.assign({},l),{id:o}),c)})}),e.start&&e.start()}function Rt(r){return r.constructor.name==="MessagePort"}function Ie(r){Rt(r)&&r.close()}function Le(r,e){return Te(r,[],e)}function ne(r){if(r)throw new Error("Proxy has been released and is not useable")}function Ne(r){return J(r,{type:"RELEASE"}).then(()=>{Ie(r)})}var oe=new WeakMap,ae="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{let e=(oe.get(r)||0)-1;oe.set(r,e),e===0&&Ne(r)});function Ot(r,e){let t=(oe.get(e)||0)+1;oe.set(e,t),ae&&ae.register(r,e,r)}function Ut(r){ae&&ae.unregister(r)}function Te(r,e=[],t=function(){}){let n=!1,i=new Proxy(t,{get(o,a){if(ne(n),a===At)return()=>{Ut(i),Ne(r),n=!0};if(a==="then"){if(e.length===0)return{then:()=>i};let s=J(r,{type:"GET",path:e.map(u=>u.toString())}).then(K);return s.then.bind(s)}return Te(r,[...e,a])},set(o,a,s){ne(n);let[u,p]=se(s);return J(r,{type:"SET",path:[...e,a].map(m=>m.toString()),value:u},p).then(K)},apply(o,a,s){ne(n);let u=e[e.length-1];if(u===St)return J(r,{type:"ENDPOINT"}).then(K);if(u==="bind")return Te(r,e.slice(0,-1));let[p,m]=Oe(s);return J(r,{type:"APPLY",path:e.map(l=>l.toString()),argumentList:p},m).then(K)},construct(o,a){ne(n);let[s,u]=Oe(a);return J(r,{type:"CONSTRUCT",path:e.map(p=>p.toString()),argumentList:s},u).then(K)}});return Ot(i,r),i}function Dt(r){return Array.prototype.concat.apply([],r)}function Oe(r){let e=r.map(se);return[e.map(t=>t[0]),Dt(e.map(t=>t[1]))]}var Me=new WeakMap;function je(r,e){return Me.set(r,e),r}function Bt(r){return Object.assign(r,{[Ue]:!0})}function se(r){for(let[e,t]of Be)if(t.canHandle(r)){let[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},Me.get(r)||[]]}function K(r){switch(r.type){case"HANDLER":return Be.get(r.name).deserialize(r.value);case"RAW":return r.value}}function J(r,e,t){return new Promise(n=>{let i=$t();r.addEventListener("message",function o(a){!a.data||!a.data.id||a.data.id!==i||(r.removeEventListener("message",o),n(a.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function $t(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function It(r){let e=new WeakMap;return{postMessage:r.postMessage.bind(r),addEventListener:(t,n)=>{let i=o=>{"handleEvent"in n?n.handleEvent({data:o}):n({data:o})};r.on("message",i),e.set(n,i)},removeEventListener:(t,n)=>{let i=e.get(n);i&&(r.off("message",i),e.delete(n))},start:r.start&&r.start.bind(r)}}function Lt(r){let e;if(typeof OffscreenCanvas<"u")e=new OffscreenCanvas(r.width,r.height);else if(typeof HTMLCanvasElement<"u"){let n=document.createElement("canvas");n.width=r.width,n.height=r.height,e=n}else throw new Error("No canvas implementation available");let t=e.getContext("2d");return t.drawImage(r,0,0,r.width,r.height),t.getImageData(0,0,r.width,r.height)}function Nt(){return"./module_statics/ocr/tesseract-worker.js"}function Mt(r){return new Worker(r)}var ue=class{constructor({createWorker:e=Mt,wasmBinary:t,workerURL:n=Nt()}={}){let i=e(n);this._worker=i,this._progressListeners=[];let o="addEventListener"in i?i:It(i),a=Le(o),{port1:s,port2:u}=new MessageChannel;this._progressChannel=s,this._progressChannel.onmessage=p=>{let{progress:m}=p.data;for(let l of this._progressListeners)l(m)},this._ocrEngine=a.createOCREngine({wasmBinary:t},je(u,[u]))}async destroy(){this._worker.terminate(),this._progressChannel.close()}async loadModel(e){let t=await this._ocrEngine;return typeof e=="string"&&(e=await(await fetch(e)).arrayBuffer()),t.loadModel(e)}async loadImage(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap&&(e=Lt(e)),(await this._ocrEngine).loadImage(e)}async clearImage(){return(await this._ocrEngine).clearImage()}async getBoundingBoxes(e){return(await this._ocrEngine).getBoundingBoxes(e)}async getTextBoxes(e,t){let n=await this._ocrEngine;t&&this._addProgressListener(t);try{return await n.getTextBoxes(e)}finally{t&&this._removeProgressListener(t)}}async getText(e){let t=await this._ocrEngine;e&&this._addProgressListener(e);try{return await t.getText()}finally{e&&this._removeProgressListener(e)}}async getHOCR(e){let t=await this._ocrEngine;e&&this._addProgressListener(e);try{return await t.getHOCR()}finally{e&&this._removeProgressListener(e)}}async getOrientation(){return(await this._ocrEngine).getOrientation()}_addProgressListener(e){this._progressListeners.push(e)}_removeProgressListener(e){this._progressListeners=this._progressListeners.filter(t=>t!==e)}};function G(...r){}globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION||(globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION=globalThis.console);var Ve=globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION;var We=null,jt=(f??[]).map(r=>r.split(".")),W=Ve;globalThis.console===W&&(globalThis.console=new Proxy(W,{get:()=>G}));function X(r){return He(r,jt)||We&&!He(r,We)?{log:G,warn:G,error:(e,...t)=>W.error(`[${r}] ${e}`,...t),info:G,debug:G}:{log:(e,...t)=>W.log(`[${r}] ${e}`,...t),warn:(e,...t)=>W.warn(`[${r}] ${e}`,...t),error:(e,...t)=>W.error(`[${r}] ${e}`,...t),info:(e,...t)=>W.info(`[${r}] ${e}`,...t),debug:(e,...t)=>W.debug(`[${r}] ${e}`,...t)}}function He(r,e){let t=r.split(".");for(let n of e){let i=0,o=!0;for(;i<t.length;){if(n[i]==="*"){if(n.length-1===i){o=!0;break}i+=1;continue}if(n[i]===t[i]){i+=1;continue}o=!1;break}if(o)return!0}return!1}var Z=globalThis.browser??globalThis.chrome;Z&&Z.runtime&&(Z.runtime.OnInstalledReason=Z.runtime.OnInstalledReason??{INSTALL:"install",UPDATE:"update",CHROME_UPDATE:"chrome_update",SHARED_MODULE_UPDATE:"shared_module_update"});var Vt={},ii=X("m.ocr"),Ee={"tesseract-core.wasm":"./module_statics/ocr/tesseract-core.wasm","eng.traineddata":"./module_statics/ocr/eng.traineddata","tesseract-worker.js":"./module_statics/ocr/tesseract-worker.js"};var oi=new Proxy(Vt,{get:(r,e,t)=>{if(e==="Content"){let n=globalThis.ContentModule?.ocr;if(!n)throw globalThis.ServiceWorkerGlobalScope?new Error("Content modules can not be loaded in a background script"):new Error("Content modules can only be loaded after initialization");return n}if(e==="Background"){let n=globalThis.BackgroundModule?.ocr;if(!n)throw globalThis.ServiceWorkerGlobalScope?new Error("Background modules can only be loaded after initialization"):new Error("Background modules can not be loaded in a content script");return n}}});function ze(r){return!!(r&&typeof r=="object"&&!Array.isArray(r))}var Wt=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},Ht=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},le,d=class extends Error{constructor(e,t){super(t),le.set(this,void 0),Wt(this,le,e,"f")}get key(){return Ht(this,le,"f")}};le=new WeakMap;function B(r,e,t){return(n,i="")=>{try{let o=e.reduce((a,s)=>s(a,i),n);return t?.(o,i),zt(i,r,o)}catch(o){return Ye(n,o)}}}function Ye(r,e){return{initialValue:r,hasError:!0,error:e}}function zt(r,e,t){try{return e.forEach(n=>n(t,r)),{initialValue:t,result:t,hasError:!1}}catch(n){return Ye(t,n)}}var N=(r,e,t,n)=>(i,o="")=>{if(!(r?!e(i):e(i)))throw new d(o,`${t??typeof i} '${i}' ${r?"is":"is not"} ${n}`)};function Yt(r,e,t,n){return`${r} ${e} is${n?" ":" not "}${t}`}function H(r){return(e,t,n,i,o)=>{if(!t())throw new d(e,Yt(r,n,i,o))}}var ce=H("array"),qe=r=>e=>(t,n="")=>{ce(n,()=>r?t.length!==e:t.length===e,`of length ${t.length}`,`of exact length ${e}`,r)},qt=r=>e=>(t,n="")=>{ce(n,()=>r?t.length<e:t.length>=e,`of length ${t.length}`,`within minimum length of ${e}`,r)},Kt=r=>e=>(t,n="")=>{ce(n,()=>r?t.length>e:t.length<=e,`of length ${t.length}`,`within maximum length of ${e}`,r)},Ke=r=>()=>(e,t="")=>{ce(t,()=>r?e.length!==0:e.length===0,`of length ${e.length}`,"empty",r)};function Q(r=[]){let e=[],t=B(e,r,(n,i="")=>{if(!Array.isArray(n))throw new d(i,`Value ${n} is not an array`)});return t.toString=$(t,n=>n.join(", ")),t.toNumber=I(t,n=>Number(n)),t.toBoolean=L(t,n=>!!n),t.toCustom=D(t),t.assert=(n,i)=>(e.push(N(!1,n,"array",i)),t),t.ofExactLength=n=>(e.push(qe(!1)(n)),t),t.ofMinLength=n=>(e.push(qt(!1)(n)),t),t.ofMaxLength=n=>(e.push(Kt(!1)(n)),t),t.empty=()=>(e.push(Ke(!1)()),t),t.not={assert:(n,i)=>(e.push(N(!0,n,"array",i)),t),empty:()=>(e.push(Ke(!0)()),t),ofExactLength:n=>(e.push(qe(!0)(n)),t)},t.items=function(n){return Q([(i,o="")=>{let a=t(i,o);if(a.hasError)throw a.error;let s=a.result.map((u,p)=>n(u,[o,`[${p}]`].filter(Boolean).join(".")));if(s.some(u=>u.hasError))throw s.filter(u=>u.hasError);return s.reduce((u,p)=>(p.hasError||u.push(p.result),u),[])}])},t}var Xe=H("boolean"),Je=r=>()=>(e,t="")=>{Xe(t,()=>r?!e:e,e,"true",r)},Ge=r=>()=>(e,t="")=>{Xe(t,()=>r?e:!e,e,"false",r)};function fe(r=[]){let e=[],t=B(e,r,(i,o="")=>{if(typeof i!="boolean")throw new d(o,`Value ${i} is not a boolean`)});t.toString=$(t,i=>i.toString()),t.toNumber=I(t,i=>i?1:0),t.toBoolean=L(t,i=>i),t.toCustom=D(t),t.toArray=M(t);let n=i=>(o,a)=>(e.push(N(i,o,"boolean",a)),t);return t.assert=n(!1),t.true=()=>(e.push(Je(!1)()),ee(!0,t)),t.false=()=>(e.push(Ge(!1)()),ee(!1,t)),t.not={assert:n(!0),true:()=>(e.push(Je(!0)()),ee(!1,t)),false:()=>(e.push(Ge(!0)()),ee(!0,t))},t}function Ze(r=[]){let t=B([],r,(n,i="")=>{if(typeof n!="boolean")throw new d(i,`Value ${n} is not a boolean`);if(n!==!1)throw new d(i,`Value ${n} must be false`)});return t.toString=$(t,n=>n.toString()),t.toNumber=I(t,n=>n?1:0),t.toBoolean=L(t,n=>n),t.toCustom=D(t),t.toArray=M(t),t}function Qe(r=[]){let t=B([],r,(n,i="")=>{if(typeof n!="boolean")throw new d(i,`Value ${n} is not a boolean`);if(n!==!0)throw new d(i,`Value ${n} must be true`)});return t.toString=$(t,n=>n.toString()),t.toNumber=I(t,n=>n?1:0),t.toBoolean=L(t,n=>n),t.toCustom=D(t),t.toArray=M(t),t}function et(r=[]){let e=[],t=B(e,r);t.toString=$(t,()=>""),t.toNumber=I(t,()=>0),t.toBoolean=L(t,()=>!1),t.toCustom=D(t),t.toArray=M(t);let n=i=>(o,a)=>(e.push(N(i,o,"custom value",a)),t);return t.assert=n(!1),t.not={assert:n(!0)},t}var z=H("number"),tt=r=>e=>(t,n="")=>{if(!(r?e.indexOf(t)===-1:e.indexOf(t)!==-1))throw new d(n,`Number value ${t} ${r?`is one of the disallowed values in [${e.join(", ")}]`:`is not one of the allowed values in [${e.join(", ")}]`}`)},rt=r=>()=>(e,t="")=>{z(t,()=>r?e<0:e>0,e,"positive",r)},nt=r=>()=>(e,t="")=>{z(t,()=>r?e>0:e<0,e,"negative",r)},it=r=>()=>(e,t="")=>{z(t,()=>r?e!==0:e===0,e,"zero",r)},ot=r=>e=>(t,n="")=>{z(n,()=>r?t>=e:t<e,t,`less than ${e}`,r)},at=r=>e=>(t,n="")=>{z(n,()=>r?t<=e:t>e,t,`more than ${e}`,r)},st=r=>e=>(t,n="")=>{z(n,()=>r?t!==e:t===e,t,`equal to ${e}`,r)},ut=r=>e=>(t,n="")=>{z(n,()=>r?t%e!==0:t%e===0,t,`a multiple of ${e}`,r)},lt=r=>()=>(e,t="")=>{z(t,()=>r?!Number.isInteger(e):Number.isInteger(e),e,"an integer",r)};function de(r=[]){let e=[],t=B(e,r,(i,o="")=>{if(typeof i!="number")throw new d(o,`Value ${i} is not a number`)});t.toString=$(t,i=>i.toString()),t.toNumber=I(t,i=>i),t.toBoolean=L(t,i=>i!==0),t.toCustom=D(t),t.toArray=M(t);let n=i=>(o,a)=>(e.push(N(i,o,"number",a)),t);return t.assert=n(!1),t.allowed=(...i)=>(e.push(tt(!1)(i)),t),t.integer=()=>(e.push(lt(!1)()),t),t.positive=()=>(e.push(rt(!1)()),t),t.negative=()=>(e.push(nt(!1)()),t),t.lessThan=i=>(e.push(ot(!1)(i)),t),t.moreThan=i=>(e.push(at(!1)(i)),t),t.zero=()=>(e.push(it(!1)()),t),t.multipleOf=i=>(e.push(ut(!1)(i)),t),t.equals=i=>(e.push(st(!1)(i)),t),t.not={assert:n(!0),allowed:(...i)=>(e.push(tt(!0)(i)),t),integer:()=>(e.push(lt(!0)()),t),positive:()=>(e.push(rt(!0)()),t),negative:()=>(e.push(nt(!0)()),t),lessThan:i=>(e.push(ot(!0)(i)),t),moreThan:i=>(e.push(at(!0)(i)),t),zero:()=>(e.push(it(!0)()),t),multipleOf:i=>(e.push(ut(!0)(i)),t),equals:i=>(e.push(st(!0)(i)),t)},t}function pe(r=[]){let e=[],t=B(e,r);t.toCustom=D(t);let n=i=>(o,a)=>(e.push(N(i,o,"custom value",a)),t);return t.assert=n(!1),t.not={assert:n(!0)},t}function $(r,e){return(t=e)=>me([(n,i="")=>{let o=r(n,i);if(o.hasError)throw o.error;try{return t(o.result)}catch(a){throw new d(i,`Unable to create a string from ${typeof o.result} ${o.result}

 ${a instanceof Error?a.message:a}`)}}])}function I(r,e){return(t=e)=>de([(n,i="")=>{let o=r(n,i);if(o.hasError)throw o.error;try{return t(o.result)}catch(a){throw new d(i,`Unable to create a number from ${typeof o.result} ${o.result}

 ${a instanceof Error?a.message:a}`)}}])}function L(r,e){return(t=e)=>fe([(n,i="")=>{let o=r(n,i);if(o.hasError)throw o.error;try{return t(o.result)}catch(a){throw new d(i,`Unable to create a booolean from ${typeof o.result} ${o.result}

 ${a instanceof Error?a.message:a}`)}}])}function D(r){return e=>et([(t,n="")=>{let i=r(t,n);if(i.hasError)throw i.error;try{return e(i.result)}catch(o){throw new d(n,`Unable to create custom type from ${typeof i.result} ${i.result}

 ${o instanceof Error?o.message:o}`)}}])}function M(r){return e=>Q([(t,n="")=>{let i=r(t,n);if(i.hasError)throw i.error;try{return e(i.result)}catch(o){throw new d(n,`Unable to create an array from ${typeof i.result} ${i.result}

 ${o instanceof Error?o.message:o}`)}}])}function ke(r){return pe([(e,t="")=>{let n=r(e,t);if(n.hasError)throw n.error;return e}])}function ee(r,e){return(r?Qe:Ze)([(n,i="")=>{let o=e(n,i);if(o.hasError)throw o.error;return n}])}var mt=H("string"),ct=(r,e)=>t=>(n,i="")=>{mt(i,()=>{let o=e?t:t.toLowerCase(),a=e?n:n.toLowerCase();return r?a!==o:a===o},n,"equal to",r)},ft=(r,e)=>t=>(n,i="")=>{let o=e?t:t.map(u=>u.toLowerCase()),a=e?n:n.toLowerCase();if(!(r?o.indexOf(a)===-1:o.indexOf(a)!==-1))throw new d(i,`String value ${n} ${r?`is one of the disallowed values in [${t.join(", ")}]`:`is not one of the allowed values in [${t.join(", ")}]`}`)},dt=r=>()=>(e,t="")=>{mt(t,()=>r?e.length!==0:e.length===0,e,"empty",r)},pt=r=>e=>(t,n="")=>{if(!(r?!e.test(t):e.test(t)))throw new d(n,`String value '${t}' ${r?"matches":"does not match"} pattern ${e}`)};function me(r=[]){let e=[],t={enabled:!0},n=B(e,r,(o,a="")=>{if(typeof o!="string")throw new d(a,`Value ${o} is not a string`)});n.toString=$(n,o=>o),n.toNumber=I(n,o=>Number(o)),n.toBoolean=L(n,o=>!!o),n.toCustom=D(n),n.toArray=M(n);let i=o=>(a,s)=>(e.push(N(o,a,"string",s)),n);return n.assert=i(!1),n.allowed=(...o)=>(e.push(ft(!1,t.enabled)(o)),ke(n)),n.matches=o=>(e.push(pt(!1)(o)),n),n.empty=()=>(e.push(dt(!1)()),n),n.equals=o=>(e.push(ct(!1,t.enabled)(o)),ke(n)),n.case=o=>(t.enabled=o==="sensitive",n),n.not={assert:i(!0),allowed:(...o)=>(e.push(ft(!0,t.enabled)(o)),n),matches:o=>(e.push(pt(!0)(o)),n),empty:()=>(e.push(dt(!0)()),n),equals:o=>(e.push(ct(!0,t.enabled)(o)),n)},n}function ge(...r){return(e,t="")=>{let n=[];for(let i of r){let o=i(e,t);if(!o.hasError)return o;n.push(o)}return{hasError:!0,initialValue:e,error:n}}}function ye(r=[]){let e=B([],r,(t,n="")=>{if(t!==void 0)throw new d(n,`Value ${t} is not undefined`)});return e.toString=$(e,()=>String(void 0)),e.toNumber=I(e,()=>NaN),e.toBoolean=L(e,()=>!1),e.toCustom=D(e),e.toArray=M(e),e}function he(...r){return ge(ye(),...r)}function be(r=[]){let e=[],t=B(e,r,(i,o="")=>{if(i===null||typeof i!="object"||Array.isArray(i))throw new d(o,`Value ${i} is not an object`)});t.toString=$(t,i=>String(i)),t.toNumber=I(t,i=>Number(i)),t.toBoolean=L(t,i=>!!i),t.toCustom=D(t);let n=i=>(o,a)=>(e.push(N(i,o,"object",a)),t);return t.assert=n(!1),t.not={assert:n(!0)},t.schema=function(i){return be([(o,a="")=>{let s=t(o,a);if(s.hasError)throw s.error;let u={...o??{},...s.result},p=Object.entries(i).map(([l,c])=>[l,c(u[l],[a,l].filter(Boolean).join("."))]),m=p.filter(([,l])=>l.hasError);if(m.length>0)throw m.reduce((l,[c,U])=>(l[c]=U,l),{});return p.reduce((l,[c,U])=>(U.hasError||(l[c]=U.result),l),u)}])},t.partial=function(i){return be([(o,a="")=>{let s=t(o,a);if(s.hasError)throw s.error;let u={...o??{},...s.result},p=Object.entries(i).map(([l,c])=>{let U=he(c)(u[l],[a,l].filter(Boolean).join("."));return U.hasError&&console.error("ERROR IS HERE",U.error),[l,U]}),m=p.filter(([,l])=>l.hasError);if(m.length>0)throw m.reduce((l,[c,U])=>(l[c]=U,l),{});return p.reduce((l,[c,U])=>(U.hasError||U.result!==void 0&&(l[c]=U.result),l),u)}])},t}function gt(r=[]){let e=B([],r,(t,n="")=>{if(t!==null)throw new d(n,`Value ${t} is not null`)});return e.toString=$(e,()=>String(null)),e.toNumber=I(e,()=>0),e.toBoolean=L(e,()=>!1),e.toCustom=D(e),e}function yt(){let r=B([],[],(e,t="")=>{if(e!==null)throw new d(t,`Value ${e} is not an error`)});return r.toString=$(r,e=>String(e)),r.toNumber=I(r,()=>0),r.toBoolean=L(r,()=>!1),r.toCustom=D(r),r}function ht(r){let e=(t,n="")=>{if(!t||typeof t!="object"||Array.isArray(t))return{initialValue:t,hasError:!0,error:new d(n,`Value ${t} is not a record`)};let i=Object.entries(t).map(([o,a],s)=>r(a,[o,`[${s}]`].filter(Boolean).join(".")));return i.some(o=>o.hasError)?{initialValue:t,hasError:!0,error:i.filter(o=>o.hasError)}:{hasError:!1,initialValue:t,result:t}};return e.toString=$(e,t=>String(t)),e.toNumber=I(e,t=>Number(t)),e.toBoolean=L(e,t=>!!t),e.toCustom=D(e),e.toArray=M(e),e}var O={string:me,number:de,boolean:fe,array:Q,object:be,error:yt,null:gt,undefined:ye,oneof:ge,stringUnion:pe,record:ht,optional:he,anything:()=>r=>({initialValue:r,hasError:!1,result:r})};function Y(r){return e=>!r(e).hasError}function we(r){return{success:!1,error:r}}function bt(r){return{success:!0,value:r}}function te(r){try{let e=r();return wt(e)?e:bt(e)}catch(e){return we(e)}}async function j(r){try{let e=await r();return wt(e)?e:bt(e)}catch(e){return we(e)}}function wt(r){return ze(r)&&typeof r.success=="boolean"&&(r.success&&"value"in r||!r.success&&"error"in r)}var Jt=1,Gt="idfs",q="files",Se="fileNameIdx",_e=class{static db=null;static async _openDB(){return this.db?this.db:new Promise((e,t)=>{let n=indexedDB.open(Gt,Jt);n.onupgradeneeded=i=>{let o=i.target.result;o.objectStoreNames.contains(q)||o.createObjectStore(q,{keyPath:["fileName","position"]}).createIndex(Se,"fileName",{unique:!1})},n.onsuccess=()=>{this.db=n.result,e(this.db)},n.onerror=()=>t(n.error)})}static async _saveChunk(e,t,n){let i=await this._openDB();return new Promise((o,a)=>{let s=i.transaction(q,"readwrite");s.objectStore(q).put({fileName:e,position:t,chunk:n}),s.oncomplete=()=>o(!0),s.onerror=()=>a(s.error)})}static async saveChunk(e,t,n){return j(()=>this._saveChunk(e,t,n))}static async _getFileContents(e){let t=await this._openDB();return new Promise((n,i)=>{let s=t.transaction(q,"readonly").objectStore(q).index(Se).getAll(e);s.onsuccess=()=>{let u=s.result.filter(c=>c.fileName===e).sort((c,U)=>c.position-U.position).map(c=>c.chunk);if(u.length===0){n(null);return}let p=u.reduce((c,U)=>c+U.byteLength,0),m=new Uint8Array(p),l=0;for(let c of u)m.set(new Uint8Array(c),l),l+=c.byteLength;n(m)},s.onerror=()=>i(s.error)})}static async getFileContents(e){return j(()=>this._getFileContents(e))}static async _deleteFile(e){let t=await this._openDB();return new Promise((n,i)=>{let o=t.transaction(q,"readwrite"),a=o.objectStore(q),u=a.index(Se).getAll(e);u.onsuccess=()=>{u.result.filter(m=>m.fileName===e).forEach(m=>a.delete([e,m.position])),o.oncomplete=()=>n(!0),o.onerror=()=>i(o.error)},u.onerror=()=>i(u.error)})}static async deleteFile(e){return j(()=>this._deleteFile(e))}};function _t(r){return te(()=>JSON.parse(r))}function vt(r){return te(()=>JSON.stringify(r))}var V=class r extends Error{_error;_type;_state;static SerializedType="JSONableError";constructor(e){super(typeof e=="string"?e:void 0),this._error=typeof e=="string"?this:e,this._type=r.SerializedType}toJSON(){return{__serialized_type:this._type,stack:this._error.stack,message:this._error.message,name:this._error.name,state:this._state}}static create(e){if(e instanceof Error)return new r(e);if(typeof e=="string"||typeof e=="boolean"||typeof e=="number"||typeof e=="symbol"||typeof e=="bigint"||typeof e=="function")return new r(e.toString());if(Zt(e))return Qt(e);let t=vt(e);return t.success?new r(t.value):new r("Unserializeable data error")}setState(e){this._state=e}},Xt=O.object().schema({__serialized_type:O.string().equals(V.SerializedType),stack:O.optional(O.string()),message:O.string(),name:O.string(),state:O.anything()}),Zt=Y(Xt);function Qt(r){let e=new Error;return e.stack=r.stack,e.name=r.name,e.message=r.message,new V(e)}var Ae=class r extends V{static SerializedType="UnexpectedResponseError";constructor(e,t={}){super(`Expected [${e}] response was not valid`),this._type=r.SerializedType,this.setState({expectedType:e,errors:t})}},er=O.object().schema({__serialized_type:O.string().equals(Ae.SerializedType),stack:O.optional(O.string()),message:O.string(),name:O.string(),state:O.object().schema({expectedType:O.string(),errors:O.record(O.string())})}),Yp=Y(er);var xt=X("common.opfs"),Fe=class extends V{static SerializedType="OPFSError";constructor(e){let t=e instanceof Error?e.message:e;super(`Error during OPFS operation: ${t}`),this.setState({originalError:e})}},ve=class r{static isSupported=()=>typeof navigator.storage?.getDirectory=="function";static async asFailable(e){let t=await j(e);return t.success?t:we(new Fe(t.error instanceof Error?t.error:JSON.stringify(t)))}static async _getRootDirectory(){return navigator.storage.getDirectory()}static async _getDirectoryHandle(e){if(!e.endsWith("/")&&e!=="")throw new Error("path should end with / or should be blank for root");e==="/"&&(e="");let t=await r._getRootDirectory(),n=e.split("/"),i=t;for(let o=0;o<n.length-1;o++){let a=await j(()=>i.getDirectoryHandle(n[o],{create:!0}));if(a.success)i=a.value;else throw xt.error(`error getting directory handle for [${n[o]}]`,a.error),new Error(`error getting directory handle for [${n[o]}]`)}return i}static async _getFileHandle(e,t){let n=e.lastIndexOf("/"),i=await r._getDirectoryHandle(e.substring(0,n+1)),o=e.substring(n+1);return await i.getFileHandle(o,t)}static async _getFile(e){return(await this._getFileHandle(e,{create:!1})).getFile()}static async _getFileWriteStream(e,t){return(await this._getFileHandle(e,{create:t?.create??!1})).createWritable({keepExistingData:t?.keepExistingData??!1})}static async _writeFile(e,t,n={keepExistingData:!1}){let i=await r._getFileWriteStream(e,{keepExistingData:n.keepExistingData,create:!0});await i.write(t),await i.close()}static async getFileWriteStream(e,t){return r.asFailable(()=>r._getFileWriteStream(e,t))}static async writeFile(e,t,n){return r.asFailable(()=>r._writeFile(e,t,n))}static async getFileReadStream(e){return r.asFailable(async()=>(await r._getFile(e)).stream())}static async getFile(e){return r.asFailable(()=>r._getFile(e))}static async readFileHeader(e,t){return r.asFailable(async()=>{let n=(await r._getFile(e)).slice(0,t).stream(),i=new Response(n);return new Uint8Array(await i.arrayBuffer())})}static async readAllFileBytes(e){return r.asFailable(async()=>{let t=(await r._getFile(e)).stream(),n=new Response(t);return new Uint8Array(await n.arrayBuffer())})}static async readAllFileText(e){let t=await r.getFileReadStream(e);return t.success?r.asFailable(async()=>{let n=new TextDecoderStream;t.value.pipeTo(n.writable);let i=n.readable.getReader(),o=!1,a="";for(;!o;){let s=await i.read();s.value&&(a+=s.value),o=s.done}return a}):t}static async destroyFileInDir(e,t){return r.asFailable(async()=>await t.removeEntry(e,{recursive:!0}))}static async destroyFile(e){return r.asFailable(async()=>{let t=e.lastIndexOf("/"),n=await r._getDirectoryHandle(e.substring(0,t+1)),i=e.substring(t+1);return await n.removeEntry(i,{recursive:!0})})}static async _listFiles(e){let t=e.values(),n=[];for await(let i of t){let o=i;o.kind==="directory"?n.push(...await this._listFiles(o)):n.push({dirHandle:e,fileName:o.name})}return n}static async listFiles(e){let t=await j(()=>this._getDirectoryHandle(e));return t.success?this._listFiles(t.value):(xt.error("error getting handle",t.error),[])}};var Pe=class extends Error{_element;constructor(e,t){super(`Elements of type [${t}] cannot be packed across contexts`),this._element=e}get element(){return this._element}};var re=class r{_binaries;_packedBuffer;_packHeader;constructor(){this._binaries={},this._packedBuffer=new Uint8Array,this._packHeader={packTime:0,rootPackType:{type:"undefined"},binaryLengths:{}}}get packHeader(){return this._packHeader}get packedBuffer(){return this._packedBuffer}get nextBinIndex(){return Object.keys(this._binaries).length}get combinedBinaryLength(){return Object.values(this._binaries).reduce((e,t)=>e+t.byteLength,0)}static sortObjectAsEntries=e=>Object.entries(e).sort(([t],[n])=>Number(t)-Number(n));static safePack=e=>j(()=>r.pack(e));static pack=async e=>{let t=new r,n=await t.packUnknownElement(e,t),i=r.sortObjectAsEntries(t._binaries),o={packTime:new Date().getTime(),rootPackType:n,binaryLengths:i.reduce((m,[l,c])=>(m[l]=c.byteLength,m),{})},a=new TextEncoder().encode(JSON.stringify(o)),s=new Uint8Array(4+a.byteLength+t.combinedBinaryLength),u=new DataView(new ArrayBuffer(4));u.setInt32(0,a.byteLength),s.set(new Uint8Array(u.buffer),0),s.set(a,4);let p=4+a.length;for(let[,m]of i){let l=new Uint8Array(m);s.set(l,p),p+=l.byteLength}return t._packedBuffer=s,t._packHeader=o,t};packImageData=(e,t)=>({type:"image_data",value:{colorSpace:e.colorSpace,width:e.width,height:e.height,data:this.packUintArray(2,e.data,t)}});packUintArray=(e,t,n)=>{let i=n.nextBinIndex;return n._binaries[i]=t.buffer,{type:"binary",binaryType:e,index:i,byteLength:t.byteLength}};packUnknownElement=async(e,t)=>{let n=r.getPackingConstraints(e);if(n)throw new Pe(e,n);if(e===null)return{type:"null"};if(e===void 0)return{type:"undefined"};if(typeof e=="string")return{type:"string",value:e};if(typeof e=="number")return{type:"number",value:e};if(typeof e=="boolean")return{type:"boolean",value:e};if(e instanceof Date)return{type:"date",value:e.getTime()};if(e instanceof BigInt)return{type:"bigint",radix:16,value:e.toString(36)};if(e instanceof Blob){let o=t.nextBinIndex,a=await e.arrayBuffer();return t._binaries[o]=a,{type:"binary",binaryType:0,index:o,byteLength:a.byteLength,mimeType:e.type}}return e instanceof Uint8Array?this.packUintArray(1,e,t):e instanceof Uint8ClampedArray?this.packUintArray(2,e,t):e instanceof Uint16Array?this.packUintArray(3,e,t):e instanceof Uint32Array?this.packUintArray(4,e,t):e instanceof ImageData?this.packImageData(e,t):Array.isArray(e)?{type:"array",values:Object.fromEntries(await Promise.all(e.map(async(o,a)=>[a,await this.packUnknownElement(o,t)])))}:{type:"object",value:await Promise.all(Object.entries(e).map(async([o,a])=>({key:o,value:await this.packUnknownElement(a,t)}),[]))}};static isBinaryType=e=>e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Blob;static getPackingConstraints=e=>{if(!(!e||Array.isArray(e)||r.isBinaryType(e)||e instanceof ImageData)){if(typeof e=="symbol"||typeof e=="function")return typeof e;if(e instanceof Promise)return"promise";if(typeof e=="object"&&e.constructor.name!=="Object")return e.constructor.name}};static safeUnpack=e=>te(()=>r.unpack(e));static unpack=e=>{if(e.byteLength<4)throw new Error("Invalid buffer in binary pack");let t=e.slice(0,4),n=4,i=new DataView(t.buffer).getInt32(0),o=e.slice(n,n+i),a=new TextDecoder().decode(o),s=_t(a);if(!s.success)throw new Error("Unable to decode binary pack header");n+=i;let u=new r;u._packHeader=s.value,u._packedBuffer=e;let p=r.sortObjectAsEntries(u._packHeader.binaryLengths);for(let[m,l]of p){let c=e.slice(n,n+l);n+=l,u._binaries[m]=c.buffer}return u.unpackUnknownValue(u._packHeader.rootPackType,u)};unpackUnknownValue=(e,t)=>{if(e.type!=="undefined"){if(e.type==="null")return null;if(e.type==="string"||e.type==="boolean"||e.type==="number")return e.value;if(e.type==="date")return new Date(e.value);if(e.type==="bigint")return BigInt(`0x${e.value}`);if(e.type==="binary")return this.unpackBinary(e,t);if(e.type==="array")return r.sortObjectAsEntries(e.values).map(([,i])=>this.unpackUnknownValue(i,t));if(e.type==="image_data"){let n=this.unpackBinary(e.value.data,t);return new ImageData(n,e.value.width,e.value.height,{colorSpace:e.value.colorSpace})}if(e.type==="object")return e.value.reduce((n,{key:i,value:o})=>(n[i]=this.unpackUnknownValue(o,t),n),{});throw new Error(`Unknown packing type [${e.type}]`)}};unpackBinary(e,t){let n=e.index;if(e.binaryType===0)return new Blob([t._binaries[n]],{type:e.mimeType});if(e.binaryType===1)return new Uint8Array(t._binaries[n]);if(e.binaryType===2)return new Uint8ClampedArray(t._binaries[n]);if(e.binaryType===3)return new Uint16Array(t._binaries[n]);if(e.binaryType===4)return new Uint32Array(t._binaries[n]);throw new Error("Unable to unpack unknown binary")}};var tr=O.object().schema({result_type:O.string().allowed("string_literal","serialized_error"),result_value:O.string()});function Ce(r,e){return{result_type:r,result_value:e}}var Ag=Y(tr);var rr=O.object().schema({keepalive:O.oneof(O.number(),O.boolean().false()),maxConcurrency:O.oneof(O.string().equals("max"),O.number())}),nr=O.object().schema({ready:O.boolean().true(),poolSettings:rr}),ty=Y(nr),ry=X("offscreen.initialize_worker");async function ir(r,e){let t=s=>self.postMessage(self.postMessage(Ce("serialized_error",JSON.stringify(V.create(s)))));if(!e.task_id)return t("No valid task ID provided to worker");if(!e.binary||!(e.binary instanceof Uint8Array))return t("No valid binary provided for worker parameters");let n=re.safeUnpack(e.binary);if(!n.success)return t(n.error instanceof Error?n.error:"Failed to unpack worker parameters");let i=n.value;if(!Array.isArray(i))return t(`Expected array of parameters but received [${typeof i}]`);let o=await j(()=>r.apply(self,i));if(!o.success)return t(o.error instanceof Error?o.error:String(o.error));if(typeof o.value=="string")return self.postMessage(Ce("string_literal",o.value));let a=await re.safePack(o.value);return a.success?self.postMessage(a.value.packedBuffer,{transfer:[a.value.packedBuffer.buffer]}):t(a.error instanceof Error?a.error:"Unable to create binary pack of response data from worker")}function Tt(r,e={keepalive:1e3,maxConcurrency:"max"}){self.postMessage({ready:!0,poolSettings:e}),self.addEventListener("message",async t=>ir(r,t.data))}var Re=new ue({workerURL:Ee["tesseract-worker.js"]}),or=Re.loadModel(Ee["eng.traineddata"]);async function ar(r){let t=await(await fetch(r)).blob();return createImageBitmap(t)}async function sr(r){let e=await ve.readAllFileBytes(r);if(!e.success)throw new Error("opfs read failed for ocr");let t=new Blob([e.value]);return createImageBitmap(t)}async function ur(r){let e=await _e.getFileContents(r);if(!e.success||e.value==null)throw new Error("opfs read failed for ocr");let t=new Blob([e.value]);return createImageBitmap(t)}async function Et(r,e){await or;let t=e==="url"?await ar(r):e==="opfs"?await sr(r):await ur(r);return await Re.loadImage(t),await Re.getText()}Tt(Et,{maxConcurrency:4,keepalive:1e4});})();
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
