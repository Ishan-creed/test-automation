"use strict";(()=>{var g=[];function ge(...n){}globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION||(globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION=globalThis.console);var vt=globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION;var Ct=null,Sr=(g??[]).map(n=>n.split(".")),ne=vt;globalThis.console===ne&&(globalThis.console=new Proxy(ne,{get:()=>ge}));function oe(n){return Ot(n,Sr)||Ct&&!Ot(n,Ct)?{log:ge,warn:ge,error:(e,...t)=>ne.error(`[${n}] ${e}`,...t),info:ge,debug:ge}:{log:(e,...t)=>ne.log(`[${n}] ${e}`,...t),warn:(e,...t)=>ne.warn(`[${n}] ${e}`,...t),error:(e,...t)=>ne.error(`[${n}] ${e}`,...t),info:(e,...t)=>ne.info(`[${n}] ${e}`,...t),debug:(e,...t)=>ne.debug(`[${n}] ${e}`,...t)}}function Ot(n,e){let t=n.split(".");for(let r of e){let o=0,s=!0;for(;o<t.length;){if(r[o]==="*"){if(r.length-1===o){s=!0;break}o+=1;continue}if(r[o]===t[o]){o+=1;continue}s=!1;break}if(s)return!0}return!1}var xe=globalThis.browser??globalThis.chrome;xe&&xe.runtime&&(xe.runtime.OnInstalledReason=xe.runtime.OnInstalledReason??{INSTALL:"install",UPDATE:"update",CHROME_UPDATE:"chrome_update",SHARED_MODULE_UPDATE:"shared_module_update"});var Ir={},No=oe("m.barcode_api_polyfill"),Ut={"zbar.wasm":"./module_statics/barcode-api-polyfill/zbar.wasm"};var Po=new Proxy(Ir,{get:(n,e,t)=>{if(e==="Content"){let r=globalThis.ContentModule?.barcodeApiPolyfill;if(!r)throw globalThis.ServiceWorkerGlobalScope?new Error("Content modules can not be loaded in a background script"):new Error("Content modules can only be loaded after initialization");return r}if(e==="Background"){let r=globalThis.BackgroundModule?.barcodeApiPolyfill;if(!r)throw globalThis.ServiceWorkerGlobalScope?new Error("Background modules can only be loaded after initialization"):new Error("Background modules can not be loaded in a content script");return r}}});var Ie={};function ee(n,e,t,r){return new(t||(t=Promise))(function(o,s){function a(d){try{p(r.next(d))}catch(F){s(F)}}function l(d){try{p(r.throw(d))}catch(F){s(F)}}function p(d){var F;d.done?o(d.value):(F=d.value,F instanceof t?F:new t(function(c){c(F)})).then(a,l)}p((r=r.apply(n,e||[])).next())})}var Ge,Nr=(Ge=Ie.url,async function(n={}){var e,t,r=n;r.ready=new Promise((i,u)=>{e=i,t=u});var o,s,a,l=Object.assign({},r),p=typeof window=="object",d=typeof importScripts=="function",F=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",c="";if(F){let{createRequire:i}=await Promise.resolve().then(()=>Cr);var D=i(Ie.url),H=D("fs"),Q=D("path");c=d?Q.dirname(c)+"/":D("url").fileURLToPath(new URL("./",Ie.url)),o=(u,O)=>(u=Te(u)?new URL(u):Q.normalize(u),H.readFileSync(u,O?void 0:"utf8")),a=u=>{var O=o(u,!0);return O.buffer||(O=new Uint8Array(O)),O},s=(u,O,m,U=!0)=>{u=Te(u)?new URL(u):Q.normalize(u),H.readFile(u,U?void 0:"utf8",(W,j)=>{W?m(W):O(U?j.buffer:j)})},!r.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),r.inspect=()=>"[Emscripten Module object]"}else(p||d)&&(d?c=self.location.href:typeof document<"u"&&document.currentScript&&(c=document.currentScript.src),Ge&&(c=Ge),c=c.indexOf("blob:")!==0?c.substr(0,c.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=i=>{var u=new XMLHttpRequest;return u.open("GET",i,!1),u.send(null),u.responseText},d&&(a=i=>{var u=new XMLHttpRequest;return u.open("GET",i,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),s=(i,u,O)=>{var m=new XMLHttpRequest;m.open("GET",i,!0),m.responseType="arraybuffer",m.onload=()=>{m.status==200||m.status==0&&m.response?u(m.response):O()},m.onerror=O,m.send(null)});var he,Ee,z,_r=r.print||console.log.bind(console),fe=r.printErr||console.error.bind(console);Object.assign(r,l),l=null,r.arguments&&r.arguments,r.thisProgram&&r.thisProgram,r.quit&&r.quit,r.wasmBinary&&(he=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&Tt("no native wasm support detected");var He,Re,wt=!1;function _t(){var i=Ee.buffer;r.HEAP8=new Int8Array(i),r.HEAP16=new Int16Array(i),r.HEAP32=new Int32Array(i),r.HEAPU8=He=new Uint8Array(i),r.HEAPU16=new Uint16Array(i),r.HEAPU32=Re=new Uint32Array(i),r.HEAPF32=new Float32Array(i),r.HEAPF64=new Float64Array(i)}var At=[],Et=[],Rt=[],le=0,be=null;function Tt(i){r.onAbort&&r.onAbort(i),fe(i="Aborted("+i+")"),wt=!0,i+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(i);throw t(u),u}var de,We,Ar="data:application/octet-stream;base64,";function kt(i){return i.startsWith(Ar)}function Te(i){return i.startsWith("file://")}function Bt(i){if(i==de&&he)return new Uint8Array(he);if(a)return a(i);throw"both async and sync fetching of the wasm failed"}function St(i,u,O){return function(m){if(!he&&(p||d)){if(typeof fetch=="function"&&!Te(m))return fetch(m,{credentials:"same-origin"}).then(U=>{if(!U.ok)throw"failed to load wasm binary file at '"+m+"'";return U.arrayBuffer()}).catch(()=>Bt(m));if(s)return new Promise((U,W)=>{s(m,j=>U(new Uint8Array(j)),W)})}return Promise.resolve().then(()=>Bt(m))}(i).then(m=>WebAssembly.instantiate(m,u)).then(m=>m).then(O,m=>{fe("failed to asynchronously prepare wasm: "+m),Tt(m)})}r.locateFile?kt(de="zbar.wasm")||(We=de,de=r.locateFile?r.locateFile(We,c):c+We):de=new URL("zbar.wasm",Ie.url).href;var ke,ze=i=>{for(;i.length>0;)i.shift()(r)},Er=i=>{var u=i-Ee.buffer.byteLength+65535>>>16;try{return Ee.grow(u),_t(),1}catch{}},It=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Rr=[null,[],[]],Tr=(i,u)=>{var O=Rr[i];u===0||u===10?((i===1?_r:fe)(((m,U,W)=>{for(var j=U+W,q=U;m[q]&&!(q>=j);)++q;if(q-U>16&&m.buffer&&It)return It.decode(m.subarray(U,q));for(var J="";U<q;){var Y=m[U++];if(128&Y){var Be=63&m[U++];if((224&Y)!=192){var Se=63&m[U++];if((Y=(240&Y)==224?(15&Y)<<12|Be<<6|Se:(7&Y)<<18|Be<<12|Se<<6|63&m[U++])<65536)J+=String.fromCharCode(Y);else{var Pt=Y-65536;J+=String.fromCharCode(55296|Pt>>10,56320|1023&Pt)}}else J+=String.fromCharCode((31&Y)<<6|Be)}else J+=String.fromCharCode(Y)}return J})(O,0)),O.length=0):O.push(u)},kr={d:()=>!0,e:function(){return Date.now()},c:i=>{var u=He.length,O=2147483648;if((i>>>=0)>O)return!1;for(var m,U,W=1;W<=4;W*=2){var j=u*(1+.2/W);j=Math.min(j,i+100663296);var q=Math.min(O,(m=Math.max(i,j))+((U=65536)-m%U)%U);if(Er(q))return!0}return!1},f:i=>52,b:function(i,u,O,m,U){return 70},a:(i,u,O,m)=>{for(var U=0,W=0;W<O;W++){var j=Re[u>>2],q=Re[u+4>>2];u+=8;for(var J=0;J<q;J++)Tr(i,He[j+J]);U+=q}return Re[m>>2]=U,0}};function Nt(){function i(){ke||(ke=!0,r.calledRun=!0,wt||(ze(Et),e(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)u=r.postRun.shift(),Rt.unshift(u);var u;ze(Rt)}()))}le>0||(function(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)u=r.preRun.shift(),At.unshift(u);var u;ze(At)}(),le>0||(r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),i()},1)):i()))}if(function(){var i,u,O,m,U={a:kr};function W(j,q){var J,Y=j.exports;return Ee=(z=Y).g,_t(),z.s,J=z.h,Et.unshift(J),function(Be){if(le--,r.monitorRunDependencies&&r.monitorRunDependencies(le),le==0&&be){var Se=be;be=null,Se()}}(),Y}if(le++,r.monitorRunDependencies&&r.monitorRunDependencies(le),r.instantiateWasm)try{return r.instantiateWasm(U,W)}catch(j){fe("Module.instantiateWasm callback failed with error: "+j),t(j)}(i=he,u=de,O=U,m=function(j){W(j.instance)},i||typeof WebAssembly.instantiateStreaming!="function"||kt(u)||Te(u)||F||typeof fetch!="function"?St(u,O,m):fetch(u,{credentials:"same-origin"}).then(j=>WebAssembly.instantiateStreaming(j,O).then(m,function(q){return fe("wasm streaming compile failed: "+q),fe("falling back to ArrayBuffer instantiation"),St(u,O,m)}))).catch(t)}(),r._ImageScanner_create=()=>(r._ImageScanner_create=z.i)(),r._ImageScanner_destory=i=>(r._ImageScanner_destory=z.j)(i),r._ImageScanner_set_config=(i,u,O,m)=>(r._ImageScanner_set_config=z.k)(i,u,O,m),r._ImageScanner_enable_cache=(i,u)=>(r._ImageScanner_enable_cache=z.l)(i,u),r._ImageScanner_recycle_image=(i,u)=>(r._ImageScanner_recycle_image=z.m)(i,u),r._ImageScanner_get_results=i=>(r._ImageScanner_get_results=z.n)(i),r._ImageScanner_scan=(i,u)=>(r._ImageScanner_scan=z.o)(i,u),r._Image_create=(i,u,O,m,U,W)=>(r._Image_create=z.p)(i,u,O,m,U,W),r._Image_destory=i=>(r._Image_destory=z.q)(i),r._Image_get_symbols=i=>(r._Image_get_symbols=z.r)(i),r._free=i=>(r._free=z.t)(i),r._malloc=i=>(r._malloc=z.u)(i),be=function i(){ke||Nt(),ke||(be=i)},r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Nt(),n.ready}),qe;function et(n={}){qe=function(){return ee(this,void 0,void 0,function*(){let e=yield Nr(n);if(e)return e;throw Error("WASM was not loaded")})}()}function Ke(){return ee(this,void 0,void 0,function*(){return qe||et(),yield qe})}var ce,ye,Ft;(function(n){n[n.ZBAR_NONE=0]="ZBAR_NONE",n[n.ZBAR_PARTIAL=1]="ZBAR_PARTIAL",n[n.ZBAR_EAN2=2]="ZBAR_EAN2",n[n.ZBAR_EAN5=5]="ZBAR_EAN5",n[n.ZBAR_EAN8=8]="ZBAR_EAN8",n[n.ZBAR_UPCE=9]="ZBAR_UPCE",n[n.ZBAR_ISBN10=10]="ZBAR_ISBN10",n[n.ZBAR_UPCA=12]="ZBAR_UPCA",n[n.ZBAR_EAN13=13]="ZBAR_EAN13",n[n.ZBAR_ISBN13=14]="ZBAR_ISBN13",n[n.ZBAR_COMPOSITE=15]="ZBAR_COMPOSITE",n[n.ZBAR_I25=25]="ZBAR_I25",n[n.ZBAR_DATABAR=34]="ZBAR_DATABAR",n[n.ZBAR_DATABAR_EXP=35]="ZBAR_DATABAR_EXP",n[n.ZBAR_CODABAR=38]="ZBAR_CODABAR",n[n.ZBAR_CODE39=39]="ZBAR_CODE39",n[n.ZBAR_PDF417=57]="ZBAR_PDF417",n[n.ZBAR_QRCODE=64]="ZBAR_QRCODE",n[n.ZBAR_SQCODE=80]="ZBAR_SQCODE",n[n.ZBAR_CODE93=93]="ZBAR_CODE93",n[n.ZBAR_CODE128=128]="ZBAR_CODE128",n[n.ZBAR_SYMBOL=255]="ZBAR_SYMBOL",n[n.ZBAR_ADDON2=512]="ZBAR_ADDON2",n[n.ZBAR_ADDON5=1280]="ZBAR_ADDON5",n[n.ZBAR_ADDON=1792]="ZBAR_ADDON"})(ce||(ce={})),function(n){n[n.ZBAR_CFG_ENABLE=0]="ZBAR_CFG_ENABLE",n[n.ZBAR_CFG_ADD_CHECK=1]="ZBAR_CFG_ADD_CHECK",n[n.ZBAR_CFG_EMIT_CHECK=2]="ZBAR_CFG_EMIT_CHECK",n[n.ZBAR_CFG_ASCII=3]="ZBAR_CFG_ASCII",n[n.ZBAR_CFG_BINARY=4]="ZBAR_CFG_BINARY",n[n.ZBAR_CFG_NUM=5]="ZBAR_CFG_NUM",n[n.ZBAR_CFG_MIN_LEN=32]="ZBAR_CFG_MIN_LEN",n[n.ZBAR_CFG_MAX_LEN=33]="ZBAR_CFG_MAX_LEN",n[n.ZBAR_CFG_UNCERTAINTY=64]="ZBAR_CFG_UNCERTAINTY",n[n.ZBAR_CFG_POSITION=128]="ZBAR_CFG_POSITION",n[n.ZBAR_CFG_TEST_INVERTED=129]="ZBAR_CFG_TEST_INVERTED",n[n.ZBAR_CFG_X_DENSITY=256]="ZBAR_CFG_X_DENSITY",n[n.ZBAR_CFG_Y_DENSITY=257]="ZBAR_CFG_Y_DENSITY"}(ye||(ye={})),function(n){n[n.ZBAR_ORIENT_UNKNOWN=-1]="ZBAR_ORIENT_UNKNOWN",n[n.ZBAR_ORIENT_UP=0]="ZBAR_ORIENT_UP",n[n.ZBAR_ORIENT_RIGHT=1]="ZBAR_ORIENT_RIGHT",n[n.ZBAR_ORIENT_DOWN=2]="ZBAR_ORIENT_DOWN",n[n.ZBAR_ORIENT_LEFT=3]="ZBAR_ORIENT_LEFT"}(Ft||(Ft={}));var Ne=class{constructor(e,t){this.ptr=e,this.inst=t}checkAlive(){if(!this.ptr)throw Error("Call after destroyed")}getPointer(){return this.checkAlive(),this.ptr}},Pe=class{constructor(e,t){this.ptr=e,this.ptr32=e>>2,this.buf=t,this.HEAP8=new Int8Array(t),this.HEAPU32=new Uint32Array(t),this.HEAP32=new Int32Array(t)}},Ye=class n extends Pe{get type(){return this.HEAPU32[this.ptr32]}get data(){let e=this.HEAPU32[this.ptr32+4],t=this.HEAPU32[this.ptr32+5];return Int8Array.from(this.HEAP8.subarray(t,t+e))}get points(){let e=this.HEAPU32[this.ptr32+7],t=this.HEAPU32[this.ptr32+8]>>2,r=[];for(let o=0;o<e;++o){let s=this.HEAP32[t+2*o],a=this.HEAP32[t+2*o+1];r.push({x:s,y:a})}return r}get orientation(){return this.HEAP32[this.ptr32+9]}get next(){let e=this.HEAPU32[this.ptr32+11];return e?new n(e,this.buf):null}get time(){return this.HEAPU32[this.ptr32+13]}get cacheCount(){return this.HEAP32[this.ptr32+14]}get quality(){return this.HEAP32[this.ptr32+15]}},Je=class extends Pe{get head(){let e=this.HEAPU32[this.ptr32+2];return e?new Ye(e,this.buf):null}},ve=class n{constructor(e){this.type=e.type,this.typeName=ce[this.type],this.data=e.data,this.points=e.points,this.orientation=e.orientation,this.time=e.time,this.cacheCount=e.cacheCount,this.quality=e.quality}static createSymbolsFromPtr(e,t){if(e==0)return[];let r=new Je(e,t).head,o=[];for(;r!==null;)o.push(new n(r)),r=r.next;return o}decode(e){return new TextDecoder(e).decode(this.data)}},Xe=class extends Ne{static createFromGrayBuffer(e,t,r,o=0){return ee(this,void 0,void 0,function*(){let s=yield Ke(),a=new Uint8Array(r),l=e*t;if(l!==a.byteLength)throw Error(`data length (${a.byteLength} bytes) does not match width and height (${l} bytes)`);let p=s._malloc(l);return s.HEAPU8.set(a,p),new this(s._Image_create(e,t,808466521,p,l,o),s)})}static createFromRGBABuffer(e,t,r,o=0){return ee(this,void 0,void 0,function*(){let s=yield Ke(),a=new Uint8Array(r),l=e*t;if(4*l!==a.byteLength)throw Error(`data length (${a.byteLength} bytes) does not match width and height (${4*l} bytes)`);let p=s._malloc(l),d=p+l,F=s.HEAPU8;for(let c=p,D=0;c<d;c++,D+=4)F[c]=19595*a[D]+38469*a[D+1]+7472*a[D+2]>>16;return new this(s._Image_create(e,t,808466521,p,l,o),s)})}destroy(){this.checkAlive(),this.inst._Image_destory(this.ptr),this.ptr=0}getSymbols(){this.checkAlive();let e=this.inst._Image_get_symbols(this.ptr);return ve.createSymbolsFromPtr(e,this.inst.HEAPU8.buffer)}},Qe=class extends Ne{static create(){return ee(this,void 0,void 0,function*(){let e=yield Ke();return new this(e._ImageScanner_create(),e)})}destroy(){this.checkAlive(),this.inst._ImageScanner_destory(this.ptr),this.ptr=0}setConfig(e,t,r){return this.checkAlive(),this.inst._ImageScanner_set_config(this.ptr,e,t,r)}enableCache(e=!0){this.checkAlive(),this.inst._ImageScanner_enable_cache(this.ptr,e)}recycleImage(e){this.checkAlive(),this.inst._ImageScanner_recycle_image(this.ptr,e.getPointer())}getResults(){this.checkAlive();let e=this.inst._ImageScanner_get_results(this.ptr);return ve.createSymbolsFromPtr(e,this.inst.HEAPU8.buffer)}scan(e){return this.checkAlive(),this.inst._ImageScanner_scan(this.ptr,e.getPointer())}},tt=()=>ee(void 0,void 0,void 0,function*(){let n=yield Qe.create();return n.setConfig(ce.ZBAR_NONE,ye.ZBAR_CFG_BINARY,1),n}),Dt,Pr=(n,e)=>ee(void 0,void 0,void 0,function*(){e===void 0&&(e=Dt||(yield tt()),Dt=e);let t=e.scan(n);if(t<0)throw Error("Scan Failed");return t===0?[]:n.getSymbols()});var vr=(n,e,t,r)=>ee(void 0,void 0,void 0,function*(){let o=yield Xe.createFromRGBABuffer(e,t,n),s=yield Pr(o,r);return o.destroy(),s}),Lt=(n,e)=>ee(void 0,void 0,void 0,function*(){return yield vr(n.data.buffer,n.width,n.height,e)}),Cr=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function rt(n){return!!(n&&typeof n=="object"&&!Array.isArray(n))}var Or=function(n,e,t,r,o){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!o:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?o.call(n,t):o?o.value=t:e.set(n,t),t},Ur=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ce,y=class extends Error{constructor(e,t){super(t),Ce.set(this,void 0),Or(this,Ce,e,"f")}get key(){return Ur(this,Ce,"f")}};Ce=new WeakMap;function Z(n,e,t){return(r,o="")=>{try{let s=e.reduce((a,l)=>l(a,o),r);return t?.(s,o),Fr(o,n,s)}catch(s){return Zt(r,s)}}}function Zt(n,e){return{initialValue:n,hasError:!0,error:e}}function Fr(n,e,t){try{return e.forEach(r=>r(t,n)),{initialValue:t,result:t,hasError:!1}}catch(r){return Zt(t,r)}}var G=(n,e,t,r)=>(o,s="")=>{if(!(n?!e(o):e(o)))throw new y(s,`${t??typeof o} '${o}' ${n?"is":"is not"} ${r}`)};function Dr(n,e,t,r){return`${n} ${e} is${r?" ":" not "}${t}`}function se(n){return(e,t,r,o,s)=>{if(!t())throw new y(e,Dr(n,r,o,s))}}var Oe=se("array"),Mt=n=>e=>(t,r="")=>{Oe(r,()=>n?t.length!==e:t.length===e,`of length ${t.length}`,`of exact length ${e}`,n)},Lr=n=>e=>(t,r="")=>{Oe(r,()=>n?t.length<e:t.length>=e,`of length ${t.length}`,`within minimum length of ${e}`,n)},Zr=n=>e=>(t,r="")=>{Oe(r,()=>n?t.length>e:t.length<=e,`of length ${t.length}`,`within maximum length of ${e}`,n)},Vt=n=>()=>(e,t="")=>{Oe(t,()=>n?e.length!==0:e.length===0,`of length ${e.length}`,"empty",n)};function we(n=[]){let e=[],t=Z(e,n,(r,o="")=>{if(!Array.isArray(r))throw new y(o,`Value ${r} is not an array`)});return t.toString=M(t,r=>r.join(", ")),t.toNumber=V(t,r=>Number(r)),t.toBoolean=$(t,r=>!!r),t.toCustom=L(t),t.assert=(r,o)=>(e.push(G(!1,r,"array",o)),t),t.ofExactLength=r=>(e.push(Mt(!1)(r)),t),t.ofMinLength=r=>(e.push(Lr(!1)(r)),t),t.ofMaxLength=r=>(e.push(Zr(!1)(r)),t),t.empty=()=>(e.push(Vt(!1)()),t),t.not={assert:(r,o)=>(e.push(G(!0,r,"array",o)),t),empty:()=>(e.push(Vt(!0)()),t),ofExactLength:r=>(e.push(Mt(!0)(r)),t)},t.items=function(r){return we([(o,s="")=>{let a=t(o,s);if(a.hasError)throw a.error;let l=a.result.map((p,d)=>r(p,[s,`[${d}]`].filter(Boolean).join(".")));if(l.some(p=>p.hasError))throw l.filter(p=>p.hasError);return l.reduce((p,d)=>(d.hasError||p.push(d.result),p),[])}])},t}var Ht=se("boolean"),$t=n=>()=>(e,t="")=>{Ht(t,()=>n?!e:e,e,"true",n)},jt=n=>()=>(e,t="")=>{Ht(t,()=>n?e:!e,e,"false",n)};function Ue(n=[]){let e=[],t=Z(e,n,(o,s="")=>{if(typeof o!="boolean")throw new y(s,`Value ${o} is not a boolean`)});t.toString=M(t,o=>o.toString()),t.toNumber=V(t,o=>o?1:0),t.toBoolean=$(t,o=>o),t.toCustom=L(t),t.toArray=K(t);let r=o=>(s,a)=>(e.push(G(o,s,"boolean",a)),t);return t.assert=r(!1),t.true=()=>(e.push($t(!1)()),_e(!0,t)),t.false=()=>(e.push(jt(!1)()),_e(!1,t)),t.not={assert:r(!0),true:()=>(e.push($t(!0)()),_e(!1,t)),false:()=>(e.push(jt(!0)()),_e(!0,t))},t}function Wt(n=[]){let t=Z([],n,(r,o="")=>{if(typeof r!="boolean")throw new y(o,`Value ${r} is not a boolean`);if(r!==!1)throw new y(o,`Value ${r} must be false`)});return t.toString=M(t,r=>r.toString()),t.toNumber=V(t,r=>r?1:0),t.toBoolean=$(t,r=>r),t.toCustom=L(t),t.toArray=K(t),t}function zt(n=[]){let t=Z([],n,(r,o="")=>{if(typeof r!="boolean")throw new y(o,`Value ${r} is not a boolean`);if(r!==!0)throw new y(o,`Value ${r} must be true`)});return t.toString=M(t,r=>r.toString()),t.toNumber=V(t,r=>r?1:0),t.toBoolean=$(t,r=>r),t.toCustom=L(t),t.toArray=K(t),t}function Gt(n=[]){let e=[],t=Z(e,n);t.toString=M(t,()=>""),t.toNumber=V(t,()=>0),t.toBoolean=$(t,()=>!1),t.toCustom=L(t),t.toArray=K(t);let r=o=>(s,a)=>(e.push(G(o,s,"custom value",a)),t);return t.assert=r(!1),t.not={assert:r(!0)},t}var ae=se("number"),qt=n=>e=>(t,r="")=>{if(!(n?e.indexOf(t)===-1:e.indexOf(t)!==-1))throw new y(r,`Number value ${t} ${n?`is one of the disallowed values in [${e.join(", ")}]`:`is not one of the allowed values in [${e.join(", ")}]`}`)},Kt=n=>()=>(e,t="")=>{ae(t,()=>n?e<0:e>0,e,"positive",n)},Yt=n=>()=>(e,t="")=>{ae(t,()=>n?e>0:e<0,e,"negative",n)},Jt=n=>()=>(e,t="")=>{ae(t,()=>n?e!==0:e===0,e,"zero",n)},Xt=n=>e=>(t,r="")=>{ae(r,()=>n?t>=e:t<e,t,`less than ${e}`,n)},Qt=n=>e=>(t,r="")=>{ae(r,()=>n?t<=e:t>e,t,`more than ${e}`,n)},er=n=>e=>(t,r="")=>{ae(r,()=>n?t!==e:t===e,t,`equal to ${e}`,n)},tr=n=>e=>(t,r="")=>{ae(r,()=>n?t%e!==0:t%e===0,t,`a multiple of ${e}`,n)},rr=n=>()=>(e,t="")=>{ae(t,()=>n?!Number.isInteger(e):Number.isInteger(e),e,"an integer",n)};function Fe(n=[]){let e=[],t=Z(e,n,(o,s="")=>{if(typeof o!="number")throw new y(s,`Value ${o} is not a number`)});t.toString=M(t,o=>o.toString()),t.toNumber=V(t,o=>o),t.toBoolean=$(t,o=>o!==0),t.toCustom=L(t),t.toArray=K(t);let r=o=>(s,a)=>(e.push(G(o,s,"number",a)),t);return t.assert=r(!1),t.allowed=(...o)=>(e.push(qt(!1)(o)),t),t.integer=()=>(e.push(rr(!1)()),t),t.positive=()=>(e.push(Kt(!1)()),t),t.negative=()=>(e.push(Yt(!1)()),t),t.lessThan=o=>(e.push(Xt(!1)(o)),t),t.moreThan=o=>(e.push(Qt(!1)(o)),t),t.zero=()=>(e.push(Jt(!1)()),t),t.multipleOf=o=>(e.push(tr(!1)(o)),t),t.equals=o=>(e.push(er(!1)(o)),t),t.not={assert:r(!0),allowed:(...o)=>(e.push(qt(!0)(o)),t),integer:()=>(e.push(rr(!0)()),t),positive:()=>(e.push(Kt(!0)()),t),negative:()=>(e.push(Yt(!0)()),t),lessThan:o=>(e.push(Xt(!0)(o)),t),moreThan:o=>(e.push(Qt(!0)(o)),t),zero:()=>(e.push(Jt(!0)()),t),multipleOf:o=>(e.push(tr(!0)(o)),t),equals:o=>(e.push(er(!0)(o)),t)},t}function De(n=[]){let e=[],t=Z(e,n);t.toCustom=L(t);let r=o=>(s,a)=>(e.push(G(o,s,"custom value",a)),t);return t.assert=r(!1),t.not={assert:r(!0)},t}function M(n,e){return(t=e)=>Le([(r,o="")=>{let s=n(r,o);if(s.hasError)throw s.error;try{return t(s.result)}catch(a){throw new y(o,`Unable to create a string from ${typeof s.result} ${s.result}

 ${a instanceof Error?a.message:a}`)}}])}function V(n,e){return(t=e)=>Fe([(r,o="")=>{let s=n(r,o);if(s.hasError)throw s.error;try{return t(s.result)}catch(a){throw new y(o,`Unable to create a number from ${typeof s.result} ${s.result}

 ${a instanceof Error?a.message:a}`)}}])}function $(n,e){return(t=e)=>Ue([(r,o="")=>{let s=n(r,o);if(s.hasError)throw s.error;try{return t(s.result)}catch(a){throw new y(o,`Unable to create a booolean from ${typeof s.result} ${s.result}

 ${a instanceof Error?a.message:a}`)}}])}function L(n){return e=>Gt([(t,r="")=>{let o=n(t,r);if(o.hasError)throw o.error;try{return e(o.result)}catch(s){throw new y(r,`Unable to create custom type from ${typeof o.result} ${o.result}

 ${s instanceof Error?s.message:s}`)}}])}function K(n){return e=>we([(t,r="")=>{let o=n(t,r);if(o.hasError)throw o.error;try{return e(o.result)}catch(s){throw new y(r,`Unable to create an array from ${typeof o.result} ${o.result}

 ${s instanceof Error?s.message:s}`)}}])}function nt(n){return De([(e,t="")=>{let r=n(e,t);if(r.hasError)throw r.error;return e}])}function _e(n,e){return(n?zt:Wt)([(r,o="")=>{let s=e(r,o);if(s.hasError)throw s.error;return r}])}var ir=se("string"),nr=(n,e)=>t=>(r,o="")=>{ir(o,()=>{let s=e?t:t.toLowerCase(),a=e?r:r.toLowerCase();return n?a!==s:a===s},r,"equal to",n)},or=(n,e)=>t=>(r,o="")=>{let s=e?t:t.map(p=>p.toLowerCase()),a=e?r:r.toLowerCase();if(!(n?s.indexOf(a)===-1:s.indexOf(a)!==-1))throw new y(o,`String value ${r} ${n?`is one of the disallowed values in [${t.join(", ")}]`:`is not one of the allowed values in [${t.join(", ")}]`}`)},sr=n=>()=>(e,t="")=>{ir(t,()=>n?e.length!==0:e.length===0,e,"empty",n)},ar=n=>e=>(t,r="")=>{if(!(n?!e.test(t):e.test(t)))throw new y(r,`String value '${t}' ${n?"matches":"does not match"} pattern ${e}`)};function Le(n=[]){let e=[],t={enabled:!0},r=Z(e,n,(s,a="")=>{if(typeof s!="string")throw new y(a,`Value ${s} is not a string`)});r.toString=M(r,s=>s),r.toNumber=V(r,s=>Number(s)),r.toBoolean=$(r,s=>!!s),r.toCustom=L(r),r.toArray=K(r);let o=s=>(a,l)=>(e.push(G(s,a,"string",l)),r);return r.assert=o(!1),r.allowed=(...s)=>(e.push(or(!1,t.enabled)(s)),nt(r)),r.matches=s=>(e.push(ar(!1)(s)),r),r.empty=()=>(e.push(sr(!1)()),r),r.equals=s=>(e.push(nr(!1,t.enabled)(s)),nt(r)),r.case=s=>(t.enabled=s==="sensitive",r),r.not={assert:o(!0),allowed:(...s)=>(e.push(or(!0,t.enabled)(s)),r),matches:s=>(e.push(ar(!0)(s)),r),empty:()=>(e.push(sr(!0)()),r),equals:s=>(e.push(nr(!0,t.enabled)(s)),r)},r}function Ze(...n){return(e,t="")=>{let r=[];for(let o of n){let s=o(e,t);if(!s.hasError)return s;r.push(s)}return{hasError:!0,initialValue:e,error:r}}}function Me(n=[]){let e=Z([],n,(t,r="")=>{if(t!==void 0)throw new y(r,`Value ${t} is not undefined`)});return e.toString=M(e,()=>String(void 0)),e.toNumber=V(e,()=>NaN),e.toBoolean=$(e,()=>!1),e.toCustom=L(e),e.toArray=K(e),e}function Ve(...n){return Ze(Me(),...n)}function $e(n=[]){let e=[],t=Z(e,n,(o,s="")=>{if(o===null||typeof o!="object"||Array.isArray(o))throw new y(s,`Value ${o} is not an object`)});t.toString=M(t,o=>String(o)),t.toNumber=V(t,o=>Number(o)),t.toBoolean=$(t,o=>!!o),t.toCustom=L(t);let r=o=>(s,a)=>(e.push(G(o,s,"object",a)),t);return t.assert=r(!1),t.not={assert:r(!0)},t.schema=function(o){return $e([(s,a="")=>{let l=t(s,a);if(l.hasError)throw l.error;let p={...s??{},...l.result},d=Object.entries(o).map(([c,D])=>[c,D(p[c],[a,c].filter(Boolean).join("."))]),F=d.filter(([,c])=>c.hasError);if(F.length>0)throw F.reduce((c,[D,H])=>(c[D]=H,c),{});return d.reduce((c,[D,H])=>(H.hasError||(c[D]=H.result),c),p)}])},t.partial=function(o){return $e([(s,a="")=>{let l=t(s,a);if(l.hasError)throw l.error;let p={...s??{},...l.result},d=Object.entries(o).map(([c,D])=>{let H=Ve(D)(p[c],[a,c].filter(Boolean).join("."));return H.hasError&&console.error("ERROR IS HERE",H.error),[c,H]}),F=d.filter(([,c])=>c.hasError);if(F.length>0)throw F.reduce((c,[D,H])=>(c[D]=H,c),{});return d.reduce((c,[D,H])=>(H.hasError||H.result!==void 0&&(c[D]=H.result),c),p)}])},t}function ur(n=[]){let e=Z([],n,(t,r="")=>{if(t!==null)throw new y(r,`Value ${t} is not null`)});return e.toString=M(e,()=>String(null)),e.toNumber=V(e,()=>0),e.toBoolean=$(e,()=>!1),e.toCustom=L(e),e}function lr(){let n=Z([],[],(e,t="")=>{if(e!==null)throw new y(t,`Value ${e} is not an error`)});return n.toString=M(n,e=>String(e)),n.toNumber=V(n,()=>0),n.toBoolean=$(n,()=>!1),n.toCustom=L(n),n}function cr(n){let e=(t,r="")=>{if(!t||typeof t!="object"||Array.isArray(t))return{initialValue:t,hasError:!0,error:new y(r,`Value ${t} is not a record`)};let o=Object.entries(t).map(([s,a],l)=>n(a,[s,`[${l}]`].filter(Boolean).join(".")));return o.some(s=>s.hasError)?{initialValue:t,hasError:!0,error:o.filter(s=>s.hasError)}:{hasError:!1,initialValue:t,result:t}};return e.toString=M(e,t=>String(t)),e.toNumber=V(e,t=>Number(t)),e.toBoolean=$(e,t=>!!t),e.toCustom=L(e),e.toArray=K(e),e}var f={string:Le,number:Fe,boolean:Ue,array:we,object:$e,error:lr,null:ur,undefined:Me,oneof:Ze,stringUnion:De,record:cr,optional:Ve,anything:()=>n=>({initialValue:n,hasError:!1,result:n})};function ie(n){return e=>!n(e).hasError}function pr(n){return{success:!1,error:n}}function mr(n){return{success:!0,value:n}}function te(n){try{let e=n();return fr(e)?e:mr(e)}catch(e){return pr(e)}}async function re(n){try{let e=await n();return fr(e)?e:mr(e)}catch(e){return pr(e)}}function fr(n){return rt(n)&&typeof n.success=="boolean"&&(n.success&&"value"in n||!n.success&&"error"in n)}var kf=f.object().partial({backgroundColor:f.string(),toBlackAndWhite:f.boolean(),toGreyscale:f.boolean()});function dr(n){return Mr(n,{threshold:128})}function Mr(n,e){let t=n.data,r=e?.threshold;for(let o=0;o<t.length;o+=4){let s=t[o],a=t[o+1],l=t[o+2],p=.299*s+.587*a+.114*l;if(t[o]=t[o+1]=t[o+2]=p,r!=null){let d=p>=r?255:0;t[o]=t[o+1]=t[o+2]=d}}return n}function gr(n){return te(()=>JSON.parse(n))}function yr(n){return te(()=>JSON.stringify(n))}var X=class n extends Error{_error;_type;_state;static SerializedType="JSONableError";constructor(e){super(typeof e=="string"?e:void 0),this._error=typeof e=="string"?this:e,this._type=n.SerializedType}toJSON(){return{__serialized_type:this._type,stack:this._error.stack,message:this._error.message,name:this._error.name,state:this._state}}static create(e){if(e instanceof Error)return new n(e);if(typeof e=="string"||typeof e=="boolean"||typeof e=="number"||typeof e=="symbol"||typeof e=="bigint"||typeof e=="function")return new n(e.toString());if(hr(e))return $r(e);let t=yr(e);return t.success?new n(t.value):new n("Unserializeable data error")}setState(e){this._state=e}},Vr=f.object().schema({__serialized_type:f.string().equals(X.SerializedType),stack:f.optional(f.string()),message:f.string(),name:f.string(),state:f.anything()}),hr=ie(Vr);function $r(n){let e=new Error;return e.stack=n.stack,e.name=n.name,e.message=n.message,new X(e)}var pe=class n extends X{_statusCode;_statusMessage;constructor(e,t,r){super(`HTTPError [${e}] for ${t}`),this._statusCode=e,this._statusMessage=r,this._type="HTTPError",this.setState({url:t,code:e,message:r})}get statusCode(){return this._statusCode}get statusMessage(){return this._statusMessage}static fromCode(e,t,r){switch(e){case 0:return new ot(t);case 401:return new st(t,r);case 403:return new at(t,r);case 404:return new it(t,r);case 405:return new ut(t,r);case 410:return new lt(t,r);case 425:return new ct(t,r);case 500:return new pt(t,r);case 501:return new mt(t,r);case 502:return new ft(t,r);case 503:return new dt(t,r);case 504:return new gt(t,r);default:return new n(e,t,"Unknown HTTP Error")}}},ue=class extends pe{constructor(e,t,r="ClientHTTPError"){super(e,t,r)}},me=class extends pe{constructor(e,t,r="ServerHTTPError"){super(e,t,r)}},ot=class extends pe{constructor(e){super(0,e,"Unable to connect to the server")}},st=class extends ue{constructor(e,t="Unauthorized"){super(401,e,t)}},at=class extends ue{constructor(e,t="Forbidden"){super(403,e,t)}},it=class extends ue{constructor(e,t="Not Found"){super(404,e,t)}},ut=class extends ue{constructor(e,t="Method Not Allowed"){super(405,e,t)}},lt=class extends ue{constructor(e,t="Gone"){super(410,e,t)}},ct=class extends ue{constructor(e,t="Too Early"){super(425,e,t)}},pt=class extends me{constructor(e,t="Internal Server Error"){super(500,e,t)}},mt=class extends me{constructor(e,t="Not Implemented"){super(501,e,t)}},ft=class extends me{constructor(e,t="Bad Gateway"){super(502,e,t)}},dt=class extends me{constructor(e,t="Service Unavailable"){super(503,e,t)}},gt=class extends me{constructor(e,t="Gateway Timeout"){super(504,e,t)}};var yt=oe("common.utilities.image_data_extractor"),je=class n{#r;#e;#t;constructor(e){if(globalThis.ServiceWorkerGlobalScope)throw new Error("Image data extraction is not available in a service worker context");globalThis.DedicatedWorkerGlobalScope&&e==="dom"&&(yt.warn("DOM Canvas can not be used in a dedicated worker. Offscreen canvas will be used instead"),e="offscreen"),this.#r=e;let{canvas:t,context:r}=n.spawnCanvas(e);this.#e=t,this.#t=r}resetCanvas(e){let{canvas:t,context:r}=n.spawnCanvas(e);this.#e=t,this.#t=r}static spawnCanvas(e,t){let r=e==="dom"?document.createElement("canvas"):new OffscreenCanvas(t?.width??0,t?.height??0);e==="dom"&&t&&(r.width=t.width,r.height=t.height);let o=r.getContext("2d",{alpha:!0,willReadFrequently:!0});if(!o)throw new Error("Unable to get 2D rendering context from canvas");return o.imageSmoothingEnabled=!1,{canvas:r,context:o}}static extractImage=async e=>globalThis.Image?n.extractImageFromDom(e):n.extractImageFromBitmap(e);static async extractImageFromDom(e){let t=new Image;t.crossOrigin="Anonymous";let r=e instanceof Blob?URL.createObjectURL(e):e;return t.src=r,(!t.complete||t.naturalWidth===0)&&await new Promise((o,s)=>{let a=l=>{e instanceof Blob&&setTimeout(()=>URL.revokeObjectURL(r),1e3),t.removeEventListener("load",a),t.removeEventListener("error",a),l instanceof ErrorEvent?(yt.error(`Error extracting image from DOM [${e}]`,l.error),s(l.error)):o()};t.addEventListener("load",a),t.addEventListener("error",a)}),t}static async extractImageFromBitmap(e){let t=typeof e=="string"?await re(async()=>{let r=await fetch(e);if(r.ok)return r.blob();throw pe.fromCode(r.status,e,r.statusText)}):await re(async()=>e);if(!t.success)throw yt.error("Error loading image from URL",e,t.error),new Error(`Failed to load image from url [${e}]`);return await createImageBitmap(t.value)}extractImageData=async(e,t=[{}],r)=>{let o=await n.extractImage(e),s="naturalWidth"in o?o.naturalWidth:o.width,a="naturalHeight"in o?o.naturalHeight:o.height;if(s===0||!(r?.(o,{width:s,height:a})??!0))return null;let l=[];this.#e.height=a,this.#e.width=s;for(let p of t){this.#t.clearRect(0,0,this.#e.width,this.#e.height),p.backgroundColor&&(this.#t.fillStyle=p.backgroundColor,this.#t.fillRect(0,0,this.#e.width,this.#e.height)),this.#t.drawImage(o,0,0);let d=te(()=>this.#t.getImageData(0,0,this.#e.width,this.#e.height));if(!d.success){if(!(e instanceof Blob))throw d.error;this.resetCanvas(this.#r);let c=await new Promise((D,H)=>{let Q=new FileReader;Q.readAsDataURL(e),Q.onload=()=>D(Q.result),Q.onerror=()=>H(Q.error)});return this.extractImageData(c,t,r)}let F=p.toBlackAndWhite?dr(d.value):d.value;l.push({variation:p,data:F})}return l}};var ht=class n extends X{static SerializedType="UnexpectedResponseError";constructor(e,t={}){super(`Expected [${e}] response was not valid`),this._type=n.SerializedType,this.setState({expectedType:e,errors:t})}},jr=f.object().schema({__serialized_type:f.string().equals(ht.SerializedType),stack:f.optional(f.string()),message:f.string(),name:f.string(),state:f.object().schema({expectedType:f.string(),errors:f.record(f.string())})}),Pg=ie(jr);var bt=class extends Error{_element;constructor(e,t){super(`Elements of type [${t}] cannot be packed across contexts`),this._element=e}get element(){return this._element}};var Ae=class n{_binaries;_packedBuffer;_packHeader;constructor(){this._binaries={},this._packedBuffer=new Uint8Array,this._packHeader={packTime:0,rootPackType:{type:"undefined"},binaryLengths:{}}}get packHeader(){return this._packHeader}get packedBuffer(){return this._packedBuffer}get nextBinIndex(){return Object.keys(this._binaries).length}get combinedBinaryLength(){return Object.values(this._binaries).reduce((e,t)=>e+t.byteLength,0)}static sortObjectAsEntries=e=>Object.entries(e).sort(([t],[r])=>Number(t)-Number(r));static safePack=e=>re(()=>n.pack(e));static pack=async e=>{let t=new n,r=await t.packUnknownElement(e,t),o=n.sortObjectAsEntries(t._binaries),s={packTime:new Date().getTime(),rootPackType:r,binaryLengths:o.reduce((F,[c,D])=>(F[c]=D.byteLength,F),{})},a=new TextEncoder().encode(JSON.stringify(s)),l=new Uint8Array(4+a.byteLength+t.combinedBinaryLength),p=new DataView(new ArrayBuffer(4));p.setInt32(0,a.byteLength),l.set(new Uint8Array(p.buffer),0),l.set(a,4);let d=4+a.length;for(let[,F]of o){let c=new Uint8Array(F);l.set(c,d),d+=c.byteLength}return t._packedBuffer=l,t._packHeader=s,t};packImageData=(e,t)=>({type:"image_data",value:{colorSpace:e.colorSpace,width:e.width,height:e.height,data:this.packUintArray(2,e.data,t)}});packUintArray=(e,t,r)=>{let o=r.nextBinIndex;return r._binaries[o]=t.buffer,{type:"binary",binaryType:e,index:o,byteLength:t.byteLength}};packUnknownElement=async(e,t)=>{let r=n.getPackingConstraints(e);if(r)throw new bt(e,r);if(e===null)return{type:"null"};if(e===void 0)return{type:"undefined"};if(typeof e=="string")return{type:"string",value:e};if(typeof e=="number")return{type:"number",value:e};if(typeof e=="boolean")return{type:"boolean",value:e};if(e instanceof Date)return{type:"date",value:e.getTime()};if(e instanceof BigInt)return{type:"bigint",radix:16,value:e.toString(36)};if(e instanceof Blob){let s=t.nextBinIndex,a=await e.arrayBuffer();return t._binaries[s]=a,{type:"binary",binaryType:0,index:s,byteLength:a.byteLength,mimeType:e.type}}return e instanceof Uint8Array?this.packUintArray(1,e,t):e instanceof Uint8ClampedArray?this.packUintArray(2,e,t):e instanceof Uint16Array?this.packUintArray(3,e,t):e instanceof Uint32Array?this.packUintArray(4,e,t):e instanceof ImageData?this.packImageData(e,t):Array.isArray(e)?{type:"array",values:Object.fromEntries(await Promise.all(e.map(async(s,a)=>[a,await this.packUnknownElement(s,t)])))}:{type:"object",value:await Promise.all(Object.entries(e).map(async([s,a])=>({key:s,value:await this.packUnknownElement(a,t)}),[]))}};static isBinaryType=e=>e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Blob;static getPackingConstraints=e=>{if(!(!e||Array.isArray(e)||n.isBinaryType(e)||e instanceof ImageData)){if(typeof e=="symbol"||typeof e=="function")return typeof e;if(e instanceof Promise)return"promise";if(typeof e=="object"&&e.constructor.name!=="Object")return e.constructor.name}};static safeUnpack=e=>te(()=>n.unpack(e));static unpack=e=>{if(e.byteLength<4)throw new Error("Invalid buffer in binary pack");let t=e.slice(0,4),r=4,o=new DataView(t.buffer).getInt32(0),s=e.slice(r,r+o),a=new TextDecoder().decode(s),l=gr(a);if(!l.success)throw new Error("Unable to decode binary pack header");r+=o;let p=new n;p._packHeader=l.value,p._packedBuffer=e;let d=n.sortObjectAsEntries(p._packHeader.binaryLengths);for(let[F,c]of d){let D=e.slice(r,r+c);r+=c,p._binaries[F]=D.buffer}return p.unpackUnknownValue(p._packHeader.rootPackType,p)};unpackUnknownValue=(e,t)=>{if(e.type!=="undefined"){if(e.type==="null")return null;if(e.type==="string"||e.type==="boolean"||e.type==="number")return e.value;if(e.type==="date")return new Date(e.value);if(e.type==="bigint")return BigInt(`0x${e.value}`);if(e.type==="binary")return this.unpackBinary(e,t);if(e.type==="array")return n.sortObjectAsEntries(e.values).map(([,o])=>this.unpackUnknownValue(o,t));if(e.type==="image_data"){let r=this.unpackBinary(e.value.data,t);return new ImageData(r,e.value.width,e.value.height,{colorSpace:e.value.colorSpace})}if(e.type==="object")return e.value.reduce((r,{key:o,value:s})=>(r[o]=this.unpackUnknownValue(s,t),r),{});throw new Error(`Unknown packing type [${e.type}]`)}};unpackBinary(e,t){let r=e.index;if(e.binaryType===0)return new Blob([t._binaries[r]],{type:e.mimeType});if(e.binaryType===1)return new Uint8Array(t._binaries[r]);if(e.binaryType===2)return new Uint8ClampedArray(t._binaries[r]);if(e.binaryType===3)return new Uint16Array(t._binaries[r]);if(e.binaryType===4)return new Uint32Array(t._binaries[r]);throw new Error("Unable to unpack unknown binary")}};var Hr=f.object().schema({result_type:f.string().allowed("string_literal","serialized_error"),result_value:f.string()});function xt(n,e){return{result_type:n,result_value:e}}var jy=ie(Hr);var Wr=f.object().schema({keepalive:f.oneof(f.number(),f.boolean().false()),maxConcurrency:f.oneof(f.string().equals("max"),f.number())}),zr=f.object().schema({ready:f.boolean().true(),poolSettings:Wr}),hh=ie(zr),bh=oe("offscreen.initialize_worker");async function Gr(n,e){let t=l=>self.postMessage(self.postMessage(xt("serialized_error",JSON.stringify(X.create(l)))));if(!e.task_id)return t("No valid task ID provided to worker");if(!e.binary||!(e.binary instanceof Uint8Array))return t("No valid binary provided for worker parameters");let r=Ae.safeUnpack(e.binary);if(!r.success)return t(r.error instanceof Error?r.error:"Failed to unpack worker parameters");let o=r.value;if(!Array.isArray(o))return t(`Expected array of parameters but received [${typeof o}]`);let s=await re(()=>n.apply(self,o));if(!s.success)return t(s.error instanceof Error?s.error:String(s.error));if(typeof s.value=="string")return self.postMessage(xt("string_literal",s.value));let a=await Ae.safePack(s.value);return a.success?self.postMessage(a.value.packedBuffer,{transfer:[a.value.packedBuffer.buffer]}):t(a.error instanceof Error?a.error:"Unable to create binary pack of response data from worker")}function br(n,e={keepalive:1e3,maxConcurrency:"max"}){self.postMessage({ready:!0,poolSettings:e}),self.addEventListener("message",async t=>Gr(n,t.data))}var qr=oe("worker.zbar_barcode_scanner"),Kr=Ut["zbar.wasm"];et({locateFile:()=>Kr});var Yr=new je("offscreen");function Jr(n){return re(async()=>{let e=await tt();return e.setConfig(ce.ZBAR_NONE,ye.ZBAR_CFG_ENABLE,0),e.setConfig(ce.ZBAR_QRCODE,ye.ZBAR_CFG_ENABLE,1),await Promise.all(n.map(t=>Lt(t)))})}async function xr(n){let e=await Jr(n);if(!e.success)return qr.warn("Error in QR code reading with ZBAR",e.error),[];let t=e.value.flatMap(r=>r.map(o=>te(()=>o.decode()))).filter(r=>r.success).map(r=>r.value);return Array.from(new Set(t))}async function Xr(n,e=[{}]){let t=(await Promise.allSettled(n.map(r=>Yr.extractImageData(r,e,(o,s)=>s.width>=20&&s.height>=20)))).filter(r=>r.status==="fulfilled"&&!!r.value).flatMap(r=>r.value).map(r=>r.data);return xr(t)}async function wr(n){return n.type==="from_source_urls"?Xr(n.urls,n.variations):xr(n.variations)}br(wr,{keepalive:2e3,maxConcurrency:"max"});})();
