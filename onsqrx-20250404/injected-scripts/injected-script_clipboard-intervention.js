"use strict";(()=>{function Z(t){return!!(t&&typeof t=="object"&&!Array.isArray(t))}var ne=function(t,e,r,o,E){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!E)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!E:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?E.call(t,r):E?E.value=r:e.set(t,r),r},se=function(t,e,r,o){if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?o:r==="a"?o.call(t):o?o.value:e.get(t)},I,S=class extends Error{constructor(e,r){super(r),I.set(this,void 0),ne(this,I,e,"f")}get key(){return se(this,I,"f")}};I=new WeakMap;function ie(t,e,r,o){return`${t} ${e} is${o?" ":" not "}${r}`}function F(t){return(e,r,o,E,C)=>{if(!r())throw new S(e,ie(t,o,E,C))}}var Ar=F("array");var Hr=F("boolean");var It=F("number");var un=F("string");function he(t){return{success:!1,error:t}}function be(t){return{success:!0,value:t}}async function K(t){try{let e=await t();return ye(e)?e:be(e)}catch(e){return he(e)}}function ye(t){return Z(t)&&typeof t.success=="boolean"&&(t.success&&"value"in t||!t.success&&"error"in t)}function W(...t){}var D=class{_resolver=W;_rejecter=W;_promise;_settled=!1;get[Symbol.toStringTag](){return"[object SynchronizingPromise]"}constructor(){this._promise=new Promise((e,r)=>{this._resolver=o=>{this._settled=!0,e(o)},this._rejecter=o=>{this._settled=!0,r(o)}})}get isSettled(){return this._settled}get reject(){return this._rejecter}get resolve(){return this._resolver}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}};var R=class{_reqString;_resString;_listener;constructor(e){this._reqString=e+"-req",this._resString=e+"-res"}addListener=e=>{let r=async o=>{if(!("detail"in o))return null;let E=await e(o)??null;return document.dispatchEvent(new CustomEvent(this._resString,{detail:E})),null};this._listener=r,document.addEventListener(this._reqString,r)};clearListener=()=>{if(!this._listener)return null;document.removeEventListener(this._reqString,this._listener),this._listener=void 0};request=async e=>{let r=await K(()=>{let o=new D;setTimeout(()=>o.reject(null),3e3);let E=C=>{if(!(C instanceof CustomEvent))return null;o.resolve(C.detail),document.removeEventListener(this._resString,E)};return document.addEventListener(this._resString,E),document.dispatchEvent(new CustomEvent(this._reqString,{detail:e})),o});return r.success?r.value:null}};var O=new R("clipboard-evaluate-copy-policy-resolver"),L=new R("clipboard-evaluate-write-to-virtual-clipboard"),M=new R("clipboard-evaluate-write-text-to-virtual-clipboard"),J=new R("clipboard-sync-vclipboard-with-injected-script"),Q=new R("clipboard-sync-policy-status-with-injected-script");var z=class{pasteStatus="inactive";copyStatus="inactive";useVirtualClipboard=!1;listeners=new Set;start=()=>{J.addListener(async e=>{this.updateUseVirtualClipboard(e.detail.useVirtualClipboard)}),Q.addListener(async e=>{let{status:r,rule:o}=e.detail;o==="copy"&&(this.copyStatus=r),o==="paste"&&(this.pasteStatus=r),this.updateUseVirtualClipboard(this.useVirtualClipboard),this.listeners.forEach(E=>E(this.copyStatus,this.pasteStatus))})};updateUseVirtualClipboard=e=>{this.copyStatus==="observe"&&this.pasteStatus==="observe"?this.useVirtualClipboard=!1:this.useVirtualClipboard=e;try{window.navigator.clipboard?.write||(this.useVirtualClipboard=!1)}catch{console.warn("navigator.clipboard is undefined")}};addListener=e=>{this.listeners.add(e)};removeListener=e=>{this.listeners.delete(e)}},P=new z;var Y="**** Redacted by SquareX****";window.sqrx={clipboard_writeText:window.navigator.clipboard?window.navigator.clipboard.writeText:void 0,clipboard_write:window.navigator.clipboard?window.navigator.clipboard.write:void 0};function ee(){window.navigator.clipboard&&(window.navigator.clipboard.writeText=new Proxy(window.navigator.clipboard.writeText,{apply:async function(t,e,r){let o=await Reflect.apply(t,e,r);if(P.copyStatus==="inactive"||r[0]===Y)return P.useVirtualClipboard&&M.request(r[0]),o;let E=P.copyStatus==="observe";if(E)return O.request(r[0]),P.useVirtualClipboard&&M.request(r[0]),o;K(async()=>{let C=r[0];if(!await O.request(C)&&!E)return P.useVirtualClipboard&&M.request(r[0]),o})}}),window.navigator.clipboard.write=new Proxy(window.navigator.clipboard.write,{apply:async function(t,e,r){let o=await Reflect.apply(t,e,r),{pastedData:E,pastedFiles:C}=await we(r[0]);if(P.copyStatus==="inactive")return P.useVirtualClipboard&&L.request({pastedData:E,pastedFiles:C}),o;let _=async()=>{let j="",X=r[0];for(let G of X){let re=G.types,te={};for(let U of re){let H=await G.getType(U).then(oe=>oe.text());te[U]=H,U==="text/plain"&&(j=H)}}return j},q=P.copyStatus==="observe";if(q)return _().then(j=>{O.request(j)}),P.useVirtualClipboard&&L.request({pastedData:E,pastedFiles:C}),o;K(async()=>{let j=await _();if(!await O.request(j)&&!q)return P.useVirtualClipboard&&L.request({pastedData:E,pastedFiles:C}),o})}}))}async function we(t){let e=[],r=[];for(let o of t)for(let E of o.types){let C=await o.getType(E);if(E.startsWith("image/")){let q=new File([C],E.split("/")[1],{type:C.type,lastModified:Date.now()});r.push(q);continue}let _=await C.text();_&&e.push({type:E,data:_})}return{pastedData:e,pastedFiles:r}}P.start();ee();})();
