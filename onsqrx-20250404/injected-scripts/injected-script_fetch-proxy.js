"use strict";(()=>{var J=r=>new Promise(e=>setTimeout(e,r));function Q(r){return!!(r&&typeof r=="object"&&!Array.isArray(r))}var ee=function(r,e,t,o,x){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!x)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!x:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?x.call(r,t):x?x.value=t:e.set(r,t),t},re=function(r,e,t,o){if(t==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?o:t==="a"?o.call(r):o?o.value:e.get(r)},D,A=class extends Error{constructor(e,t){super(t),D.set(this,void 0),ee(this,D,e,"f")}get key(){return re(this,D,"f")}};D=new WeakMap;function te(r,e,t,o){return`${r} ${e} is${o?" ":" not "}${t}`}function B(r){return(e,t,o,x,k)=>{if(!t())throw new A(e,te(r,o,x,k))}}var Ur=B("array");var ht=B("boolean");var so=B("number");var $n=B("string");function me(r){return{success:!1,error:r}}function fe(r){return{success:!0,value:r}}async function X(r){try{let e=await r();return pe(e)?e:fe(e)}catch(e){return me(e)}}function pe(r){return Q(r)&&typeof r.success=="boolean"&&(r.success&&"value"in r||!r.success&&"error"in r)}function U(...r){}var M=class{_resolver=U;_rejecter=U;_promise;_settled=!1;get[Symbol.toStringTag](){return"[object SynchronizingPromise]"}constructor(){this._promise=new Promise((e,t)=>{this._resolver=o=>{this._settled=!0,e(o)},this._rejecter=o=>{this._settled=!0,t(o)}})}get isSettled(){return this._settled}get reject(){return this._rejecter}get resolve(){return this._resolver}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}};var q=class{_reqString;_resString;_listener;constructor(e){this._reqString=e+"-req",this._resString=e+"-res"}addListener=e=>{let t=async o=>{if(!("detail"in o))return null;let x=await e(o)??null;return document.dispatchEvent(new CustomEvent(this._resString,{detail:x})),null};this._listener=t,document.addEventListener(this._reqString,t)};clearListener=()=>{if(!this._listener)return null;document.removeEventListener(this._reqString,this._listener),this._listener=void 0};request=async e=>{let t=await X(()=>{let o=new M;setTimeout(()=>o.reject(null),3e3);let x=k=>{if(!(k instanceof CustomEvent))return null;o.resolve(k.detail),document.removeEventListener(this._resString,x)};return document.addEventListener(this._resString,x),document.dispatchEvent(new CustomEvent(this._reqString,{detail:e})),o});return t.success?t.value:null}};var W=class{eventName="fetch-proxy-to-module";registerConfigEventName="should-fetch-proxy";allowedHostname={};method="GET"},H=class{constructor(e,t){this.subscriberId=e;this.url=t}status="failed";response={httpStatus:0}},S=new W,Y=new q(S.eventName),G=new q(S.registerConfigEventName);var z=!1;function he(){we(),de()}he();async function de(){let r=window.location.hostname,e=r.split(".").slice(-2).join("."),t=await G.request(e);for(let _=1;_<=3&&!t;_++)await J(100),t=await G.request(e);if(!t||!e){z=!1;return}z=!0;let{patterns:o,moduleTargetName:x,subscriberId:k,method:C,topWindowDomain:V,requestDomain:N}=t;S.allowedHostname[N]||(S.allowedHostname[N]=[],S.allowedHostname[r]=[]);let I={subscriberId:k,moduleTargetName:x??"",patterns:(o??[]).map(_=>new RegExp(_)),method:C,topWindowDomain:V,requestDomain:N};S.method=C,S.allowedHostname[N].push(I),S.allowedHostname[r].push(I)}function we(){window.fetch=new Proxy(window.fetch,{apply:(r,e,t)=>{let o=Reflect.apply(r,e,t);if(!z)return o;let x=typeof t[0]=="string"?t[0]:t[0].url,k=t[1]||{},C=k.method?k.method.toUpperCase():"GET",{subscriberId:V}=be(C,x)??{};if(!V)return o;async function N(I,_){let L=(await I).clone(),O=new H(_,x);O.response.httpStatus=L.status;try{if(!L.ok)throw new Error;let Z=await L.json();O.status="success",O.response.data=Z}catch{O.response.error=await L.text()}ye(O)}return N(o,V),o}})}function ye(r){Y.request(r)}function be(r,e){try{if(typeof e!="string")return;e.startsWith("/")&&(e=window.location.origin+e);let{hostname:t}=new URL(e),o=t.split(".").slice(-2).join(".");if(!o)return;let x=S.allowedHostname[t]??S.allowedHostname[o];if(!x||x.every(k=>k.method!==r))return;if(x)for(let k of x){let{subscriberId:C,patterns:V}=k;for(let N of V)if(N.test(e))return{subscriberId:C,url:e}}}catch{}}})();
