"use strict";(()=>{var U=[];var Lo=function(l,r,t,i,u){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!u)throw new TypeError("Private accessor was defined without a setter");if(typeof r=="function"?l!==r||!u:!r.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?u.call(l,t):u?u.value=t:r.set(l,t),t},Ao=function(l,r,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?l!==r||!i:!r.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(l):i?i.value:r.get(l)},vr,B=class extends Error{constructor(r,t){super(t),vr.set(this,void 0),Lo(this,vr,r,"f")}get key(){return Ao(this,vr,"f")}};vr=new WeakMap;function de(l,r,t){return(i,u="")=>{try{let m=r.reduce((h,w)=>w(h,u),i);return t?.(m,u),Po(u,l,m)}catch(m){return Zt(i,m)}}}function Zt(l,r){return{initialValue:l,hasError:!0,error:r}}function Po(l,r,t){try{return r.forEach(i=>i(t,l)),{initialValue:t,result:t,hasError:!1}}catch(i){return Zt(t,i)}}var ye=(l,r,t,i)=>(u,m="")=>{if(!(l?!r(u):r(u)))throw new B(m,`${t??typeof u} '${u}' ${l?"is":"is not"} ${i}`)};function Fo(l,r,t,i){return`${l} ${r} is${i?" ":" not "}${t}`}function $e(l){return(r,t,i,u,m)=>{if(!t())throw new B(r,Fo(l,i,u,m))}}var Er=$e("array"),Qt=l=>r=>(t,i="")=>{Er(i,()=>l?t.length!==r:t.length===r,`of length ${t.length}`,`of exact length ${r}`,l)},No=l=>r=>(t,i="")=>{Er(i,()=>l?t.length<r:t.length>=r,`of length ${t.length}`,`within minimum length of ${r}`,l)},Ro=l=>r=>(t,i="")=>{Er(i,()=>l?t.length>r:t.length<=r,`of length ${t.length}`,`within maximum length of ${r}`,l)},en=l=>()=>(r,t="")=>{Er(t,()=>l?r.length!==0:r.length===0,`of length ${r.length}`,"empty",l)};function cr(l=[]){let r=[],t=de(r,l,(i,u="")=>{if(!Array.isArray(i))throw new B(u,`Value ${i} is not an array`)});return t.toString=me(t,i=>i.join(", ")),t.toNumber=fe(t,i=>Number(i)),t.toBoolean=pe(t,i=>!!i),t.toCustom=ue(t),t.assert=(i,u)=>(r.push(ye(!1,i,"array",u)),t),t.ofExactLength=i=>(r.push(Qt(!1)(i)),t),t.ofMinLength=i=>(r.push(No(!1)(i)),t),t.ofMaxLength=i=>(r.push(Ro(!1)(i)),t),t.empty=()=>(r.push(en(!1)()),t),t.not={assert:(i,u)=>(r.push(ye(!0,i,"array",u)),t),empty:()=>(r.push(en(!0)()),t),ofExactLength:i=>(r.push(Qt(!0)(i)),t)},t.items=function(i){return cr([(u,m="")=>{let h=t(u,m);if(h.hasError)throw h.error;let w=h.result.map((y,M)=>i(y,[m,`[${M}]`].filter(Boolean).join(".")));if(w.some(y=>y.hasError))throw w.filter(y=>y.hasError);return w.reduce((y,M)=>(M.hasError||y.push(M.result),y),[])}])},t}var nn=$e("boolean"),rn=l=>()=>(r,t="")=>{nn(t,()=>l?!r:r,r,"true",l)},tn=l=>()=>(r,t="")=>{nn(t,()=>l?r:!r,r,"false",l)};function kr(l=[]){let r=[],t=de(r,l,(u,m="")=>{if(typeof u!="boolean")throw new B(m,`Value ${u} is not a boolean`)});t.toString=me(t,u=>u.toString()),t.toNumber=fe(t,u=>u?1:0),t.toBoolean=pe(t,u=>u),t.toCustom=ue(t),t.toArray=ve(t);let i=u=>(m,h)=>(r.push(ye(u,m,"boolean",h)),t);return t.assert=i(!1),t.true=()=>(r.push(rn(!1)()),dr(!0,t)),t.false=()=>(r.push(tn(!1)()),dr(!1,t)),t.not={assert:i(!0),true:()=>(r.push(rn(!0)()),dr(!1,t)),false:()=>(r.push(tn(!0)()),dr(!0,t))},t}function an(l=[]){let t=de([],l,(i,u="")=>{if(typeof i!="boolean")throw new B(u,`Value ${i} is not a boolean`);if(i!==!1)throw new B(u,`Value ${i} must be false`)});return t.toString=me(t,i=>i.toString()),t.toNumber=fe(t,i=>i?1:0),t.toBoolean=pe(t,i=>i),t.toCustom=ue(t),t.toArray=ve(t),t}function on(l=[]){let t=de([],l,(i,u="")=>{if(typeof i!="boolean")throw new B(u,`Value ${i} is not a boolean`);if(i!==!0)throw new B(u,`Value ${i} must be true`)});return t.toString=me(t,i=>i.toString()),t.toNumber=fe(t,i=>i?1:0),t.toBoolean=pe(t,i=>i),t.toCustom=ue(t),t.toArray=ve(t),t}function sn(l=[]){let r=[],t=de(r,l);t.toString=me(t,()=>""),t.toNumber=fe(t,()=>0),t.toBoolean=pe(t,()=>!1),t.toCustom=ue(t),t.toArray=ve(t);let i=u=>(m,h)=>(r.push(ye(u,m,"custom value",h)),t);return t.assert=i(!1),t.not={assert:i(!0)},t}var je=$e("number"),un=l=>r=>(t,i="")=>{if(!(l?r.indexOf(t)===-1:r.indexOf(t)!==-1))throw new B(i,`Number value ${t} ${l?`is one of the disallowed values in [${r.join(", ")}]`:`is not one of the allowed values in [${r.join(", ")}]`}`)},ln=l=>()=>(r,t="")=>{je(t,()=>l?r<0:r>0,r,"positive",l)},cn=l=>()=>(r,t="")=>{je(t,()=>l?r>0:r<0,r,"negative",l)},dn=l=>()=>(r,t="")=>{je(t,()=>l?r!==0:r===0,r,"zero",l)},mn=l=>r=>(t,i="")=>{je(i,()=>l?t>=r:t<r,t,`less than ${r}`,l)},fn=l=>r=>(t,i="")=>{je(i,()=>l?t<=r:t>r,t,`more than ${r}`,l)},pn=l=>r=>(t,i="")=>{je(i,()=>l?t!==r:t===r,t,`equal to ${r}`,l)},_n=l=>r=>(t,i="")=>{je(i,()=>l?t%r!==0:t%r===0,t,`a multiple of ${r}`,l)},hn=l=>()=>(r,t="")=>{je(t,()=>l?!Number.isInteger(r):Number.isInteger(r),r,"an integer",l)};function Tr(l=[]){let r=[],t=de(r,l,(u,m="")=>{if(typeof u!="number")throw new B(m,`Value ${u} is not a number`)});t.toString=me(t,u=>u.toString()),t.toNumber=fe(t,u=>u),t.toBoolean=pe(t,u=>u!==0),t.toCustom=ue(t),t.toArray=ve(t);let i=u=>(m,h)=>(r.push(ye(u,m,"number",h)),t);return t.assert=i(!1),t.allowed=(...u)=>(r.push(un(!1)(u)),t),t.integer=()=>(r.push(hn(!1)()),t),t.positive=()=>(r.push(ln(!1)()),t),t.negative=()=>(r.push(cn(!1)()),t),t.lessThan=u=>(r.push(mn(!1)(u)),t),t.moreThan=u=>(r.push(fn(!1)(u)),t),t.zero=()=>(r.push(dn(!1)()),t),t.multipleOf=u=>(r.push(_n(!1)(u)),t),t.equals=u=>(r.push(pn(!1)(u)),t),t.not={assert:i(!0),allowed:(...u)=>(r.push(un(!0)(u)),t),integer:()=>(r.push(hn(!0)()),t),positive:()=>(r.push(ln(!0)()),t),negative:()=>(r.push(cn(!0)()),t),lessThan:u=>(r.push(mn(!0)(u)),t),moreThan:u=>(r.push(fn(!0)(u)),t),zero:()=>(r.push(dn(!0)()),t),multipleOf:u=>(r.push(_n(!0)(u)),t),equals:u=>(r.push(pn(!0)(u)),t)},t}function xr(l=[]){let r=[],t=de(r,l);t.toCustom=ue(t);let i=u=>(m,h)=>(r.push(ye(u,m,"custom value",h)),t);return t.assert=i(!1),t.not={assert:i(!0)},t}function me(l,r){return(t=r)=>Sr([(i,u="")=>{let m=l(i,u);if(m.hasError)throw m.error;try{return t(m.result)}catch(h){throw new B(u,`Unable to create a string from ${typeof m.result} ${m.result}

 ${h instanceof Error?h.message:h}`)}}])}function fe(l,r){return(t=r)=>Tr([(i,u="")=>{let m=l(i,u);if(m.hasError)throw m.error;try{return t(m.result)}catch(h){throw new B(u,`Unable to create a number from ${typeof m.result} ${m.result}

 ${h instanceof Error?h.message:h}`)}}])}function pe(l,r){return(t=r)=>kr([(i,u="")=>{let m=l(i,u);if(m.hasError)throw m.error;try{return t(m.result)}catch(h){throw new B(u,`Unable to create a booolean from ${typeof m.result} ${m.result}

 ${h instanceof Error?h.message:h}`)}}])}function ue(l){return r=>sn([(t,i="")=>{let u=l(t,i);if(u.hasError)throw u.error;try{return r(u.result)}catch(m){throw new B(i,`Unable to create custom type from ${typeof u.result} ${u.result}

 ${m instanceof Error?m.message:m}`)}}])}function ve(l){return r=>cr([(t,i="")=>{let u=l(t,i);if(u.hasError)throw u.error;try{return r(u.result)}catch(m){throw new B(i,`Unable to create an array from ${typeof u.result} ${u.result}

 ${m instanceof Error?m.message:m}`)}}])}function et(l){return xr([(r,t="")=>{let i=l(r,t);if(i.hasError)throw i.error;return r}])}function dr(l,r){return(l?on:an)([(i,u="")=>{let m=r(i,u);if(m.hasError)throw m.error;return i}])}var vn=$e("string"),gn=(l,r)=>t=>(i,u="")=>{vn(u,()=>{let m=r?t:t.toLowerCase(),h=r?i:i.toLowerCase();return l?h!==m:h===m},i,"equal to",l)},bn=(l,r)=>t=>(i,u="")=>{let m=r?t:t.map(y=>y.toLowerCase()),h=r?i:i.toLowerCase();if(!(l?m.indexOf(h)===-1:m.indexOf(h)!==-1))throw new B(u,`String value ${i} ${l?`is one of the disallowed values in [${t.join(", ")}]`:`is not one of the allowed values in [${t.join(", ")}]`}`)},yn=l=>()=>(r,t="")=>{vn(t,()=>l?r.length!==0:r.length===0,r,"empty",l)},wn=l=>r=>(t,i="")=>{if(!(l?!r.test(t):r.test(t)))throw new B(i,`String value '${t}' ${l?"matches":"does not match"} pattern ${r}`)};function Sr(l=[]){let r=[],t={enabled:!0},i=de(r,l,(m,h="")=>{if(typeof m!="string")throw new B(h,`Value ${m} is not a string`)});i.toString=me(i,m=>m),i.toNumber=fe(i,m=>Number(m)),i.toBoolean=pe(i,m=>!!m),i.toCustom=ue(i),i.toArray=ve(i);let u=m=>(h,w)=>(r.push(ye(m,h,"string",w)),i);return i.assert=u(!1),i.allowed=(...m)=>(r.push(bn(!1,t.enabled)(m)),et(i)),i.matches=m=>(r.push(wn(!1)(m)),i),i.empty=()=>(r.push(yn(!1)()),i),i.equals=m=>(r.push(gn(!1,t.enabled)(m)),et(i)),i.case=m=>(t.enabled=m==="sensitive",i),i.not={assert:u(!0),allowed:(...m)=>(r.push(bn(!0,t.enabled)(m)),i),matches:m=>(r.push(wn(!0)(m)),i),empty:()=>(r.push(yn(!0)()),i),equals:m=>(r.push(gn(!0,t.enabled)(m)),i)},i}function Lr(...l){return(r,t="")=>{let i=[];for(let u of l){let m=u(r,t);if(!m.hasError)return m;i.push(m)}return{hasError:!0,initialValue:r,error:i}}}function Ar(l=[]){let r=de([],l,(t,i="")=>{if(t!==void 0)throw new B(i,`Value ${t} is not undefined`)});return r.toString=me(r,()=>String(void 0)),r.toNumber=fe(r,()=>NaN),r.toBoolean=pe(r,()=>!1),r.toCustom=ue(r),r.toArray=ve(r),r}function Pr(...l){return Lr(Ar(),...l)}function Fr(l=[]){let r=[],t=de(r,l,(u,m="")=>{if(u===null||typeof u!="object"||Array.isArray(u))throw new B(m,`Value ${u} is not an object`)});t.toString=me(t,u=>String(u)),t.toNumber=fe(t,u=>Number(u)),t.toBoolean=pe(t,u=>!!u),t.toCustom=ue(t);let i=u=>(m,h)=>(r.push(ye(u,m,"object",h)),t);return t.assert=i(!1),t.not={assert:i(!0)},t.schema=function(u){return Fr([(m,h="")=>{let w=t(m,h);if(w.hasError)throw w.error;let y={...m??{},...w.result},M=Object.entries(u).map(([k,le])=>[k,le(y[k],[h,k].filter(Boolean).join("."))]),D=M.filter(([,k])=>k.hasError);if(D.length>0)throw D.reduce((k,[le,ie])=>(k[le]=ie,k),{});return M.reduce((k,[le,ie])=>(ie.hasError||(k[le]=ie.result),k),y)}])},t.partial=function(u){return Fr([(m,h="")=>{let w=t(m,h);if(w.hasError)throw w.error;let y={...m??{},...w.result},M=Object.entries(u).map(([k,le])=>{let ie=Pr(le)(y[k],[h,k].filter(Boolean).join("."));return ie.hasError&&console.error("ERROR IS HERE",ie.error),[k,ie]}),D=M.filter(([,k])=>k.hasError);if(D.length>0)throw D.reduce((k,[le,ie])=>(k[le]=ie,k),{});return M.reduce((k,[le,ie])=>(ie.hasError||ie.result!==void 0&&(k[le]=ie.result),k),y)}])},t}function En(l=[]){let r=de([],l,(t,i="")=>{if(t!==null)throw new B(i,`Value ${t} is not null`)});return r.toString=me(r,()=>String(null)),r.toNumber=fe(r,()=>0),r.toBoolean=pe(r,()=>!1),r.toCustom=ue(r),r}function kn(){let l=de([],[],(r,t="")=>{if(r!==null)throw new B(t,`Value ${r} is not an error`)});return l.toString=me(l,r=>String(r)),l.toNumber=fe(l,()=>0),l.toBoolean=pe(l,()=>!1),l.toCustom=ue(l),l}function Tn(l){let r=(t,i="")=>{if(!t||typeof t!="object"||Array.isArray(t))return{initialValue:t,hasError:!0,error:new B(i,`Value ${t} is not a record`)};let u=Object.entries(t).map(([m,h],w)=>l(h,[m,`[${w}]`].filter(Boolean).join(".")));return u.some(m=>m.hasError)?{initialValue:t,hasError:!0,error:u.filter(m=>m.hasError)}:{hasError:!1,initialValue:t,result:t}};return r.toString=me(r,t=>String(t)),r.toNumber=fe(r,t=>Number(t)),r.toBoolean=pe(r,t=>!!t),r.toCustom=ue(r),r.toArray=ve(r),r}var F={string:Sr,number:Tr,boolean:kr,array:cr,object:Fr,error:kn,null:En,undefined:Ar,oneof:Lr,stringUnion:xr,record:Tn,optional:Pr,anything:()=>l=>({initialValue:l,hasError:!1,result:l})};function Pe(l){return r=>!l(r).hasError}var xn=F.object().schema({type:F.string(),item:F.string(),env:F.optional(F.string())});var Oo=F.object().schema({call:F.string().equals("lua-script"),luaScript:F.string(),args:F.record(F.anything()),customListRecord:F.record(F.array().items(xn))}),Sn=Pe(Oo);var we;(function(l){l[l.Ok=0]="Ok",l[l.Yield=1]="Yield",l[l.ErrorRun=2]="ErrorRun",l[l.ErrorSyntax=3]="ErrorSyntax",l[l.ErrorMem=4]="ErrorMem",l[l.ErrorErr=5]="ErrorErr",l[l.ErrorFile=6]="ErrorFile"})(we||(we={}));var pt=4,Ln=-1,Mo=1e6,Ae=-Mo-1e3,ae;(function(l){l[l.None=-1]="None",l[l.Nil=0]="Nil",l[l.Boolean=1]="Boolean",l[l.LightUserdata=2]="LightUserdata",l[l.Number=3]="Number",l[l.String=4]="String",l[l.Table=5]="Table",l[l.Function=6]="Function",l[l.Userdata=7]="Userdata",l[l.Thread=8]="Thread"})(ae||(ae={}));var An;(function(l){l[l.Call=0]="Call",l[l.Ret=1]="Ret",l[l.Line=2]="Line",l[l.Count=3]="Count",l[l.TailCall=4]="TailCall"})(An||(An={}));var rt;(function(l){l[l.Call=1]="Call",l[l.Ret=2]="Ret",l[l.Line=4]="Line",l[l.Count=8]="Count"})(rt||(rt={}));var xe;(function(l){l.Base="_G",l.Coroutine="coroutine",l.Table="table",l.IO="io",l.OS="os",l.String="string",l.UTF8="utf8",l.Math="math",l.Debug="debug",l.Package="package"})(xe||(xe={}));var Nr=class extends Error{},ze=class{constructor(r,t){this.target=r,this.options=t}},Rr=class extends Number{},Ke=class extends Array{},Do=1e3,tt=class l{constructor(r,t,i,u){this.closed=!1,this.lua=r,this.typeExtensions=t,this.address=i,this.parent=u}newThread(){let r=this.lua.lua_newthread(this.address);if(!r)throw new Error("lua_newthread returned a null pointer");return new l(this.lua,this.typeExtensions,r,this.parent||this)}resetThread(){this.assertOk(this.lua.lua_resetthread(this.address))}loadString(r,t){let i=this.lua.module.lengthBytesUTF8(r),u=i+1,m=this.lua.module._malloc(u);try{this.lua.module.stringToUTF8(r,m,u),this.assertOk(this.lua.luaL_loadbufferx(this.address,m,i,t??m,null))}finally{this.lua.module._free(m)}}loadFile(r){this.assertOk(this.lua.luaL_loadfilex(this.address,r,null))}resume(r=0){let t=this.lua.module._malloc(pt);try{return this.lua.module.setValue(t,0,"i32"),{result:this.lua.lua_resume(this.address,null,r,t),resultCount:this.lua.module.getValue(t,"i32")}}finally{this.lua.module._free(t)}}getTop(){return this.lua.lua_gettop(this.address)}setTop(r){this.lua.lua_settop(this.address,r)}remove(r){return this.lua.lua_remove(this.address,r)}setField(r,t,i){r=this.lua.lua_absindex(this.address,r),this.pushValue(i),this.lua.lua_setfield(this.address,r,t)}async run(r=0,t){let i=this.timeout;try{t?.timeout!==void 0&&this.setTimeout(Date.now()+t.timeout);let u=this.resume(r);for(;u.result===we.Yield;){if(this.timeout&&Date.now()>this.timeout)throw u.resultCount>0&&this.pop(u.resultCount),new Nr("thread timeout exceeded");if(u.resultCount>0){let m=this.getValue(-1);this.pop(u.resultCount),m===Promise.resolve(m)?await m:await new Promise(h=>setImmediate(h))}else await new Promise(m=>setImmediate(m));u=this.resume(0)}return this.assertOk(u.result),this.getStackValues()}finally{t?.timeout!==void 0&&this.setTimeout(i)}}runSync(r=0){let t=this.getTop()-r-1;return this.assertOk(this.lua.lua_pcallk(this.address,r,Ln,0,0,null)),this.getStackValues(t)}pop(r=1){this.lua.lua_pop(this.address,r)}call(r,...t){let i=this.lua.lua_getglobal(this.address,r);if(i!==ae.Function)throw new Error(`A function of type '${i}' was pushed, expected is ${ae.Function}`);for(let m of t)this.pushValue(m);let u=this.getTop()-t.length-1;return this.lua.lua_callk(this.address,t.length,Ln,0,null),this.getStackValues(u)}getStackValues(r=0){let t=this.getTop()-r,i=new Ke(t);for(let u=0;u<t;u++)i[u]=this.getValue(r+u+1);return i}stateToThread(r){var t;return r===((t=this.parent)===null||t===void 0?void 0:t.address)?this.parent:new l(this.lua,this.typeExtensions,r,this.parent||this)}pushValue(r,t){let i=this.getValueDecorations(r),u=i.target;if(u instanceof l){this.lua.lua_pushthread(u.address)===1||this.lua.lua_xmove(u.address,this.address,1);return}let m=this.getTop();switch(typeof u){case"undefined":this.lua.lua_pushnil(this.address);break;case"number":Number.isInteger(u)?this.lua.lua_pushinteger(this.address,BigInt(u)):this.lua.lua_pushnumber(this.address,u);break;case"string":this.lua.lua_pushstring(this.address,u);break;case"boolean":this.lua.lua_pushboolean(this.address,u?1:0);break;default:if(this.typeExtensions.find(h=>h.extension.pushValue(this,i,t)))break;if(u===null){this.lua.lua_pushnil(this.address);break}throw new Error(`The type '${typeof u}' is not supported by Lua`)}if(i.options.metatable&&this.setMetatable(-1,i.options.metatable),this.getTop()!==m+1)throw new Error(`pushValue expected stack size ${m+1}, got ${this.getTop()}`)}setMetatable(r,t){if(r=this.lua.lua_absindex(this.address,r),this.lua.lua_getmetatable(this.address,r)){this.pop(1);let i=this.getMetatableName(r);throw new Error(`data already has associated metatable: ${i||"unknown name"}`)}this.pushValue(t),this.lua.lua_setmetatable(this.address,r)}getMetatableName(r){let t=this.lua.luaL_getmetafield(this.address,r,"__name");if(t===ae.Nil)return;if(t!==ae.String){this.pop(1);return}let i=this.lua.lua_tolstring(this.address,-1,null);return this.pop(1),i}getValue(r,t,i){r=this.lua.lua_absindex(this.address,r);let u=t??this.lua.lua_type(this.address,r);switch(u){case ae.None:return;case ae.Nil:return null;case ae.Number:return this.lua.lua_tonumberx(this.address,r,null);case ae.String:return this.lua.lua_tolstring(this.address,r,null);case ae.Boolean:return!!this.lua.lua_toboolean(this.address,r);case ae.Thread:return this.stateToThread(this.lua.lua_tothread(this.address,r));default:{let m;(u===ae.Table||u===ae.Userdata)&&(m=this.getMetatableName(r));let h=this.typeExtensions.find(w=>w.extension.isType(this,r,u,m));return h?h.extension.getValue(this,r,i):(console.warn(`The type '${this.lua.lua_typename(this.address,u)}' returned is not supported on JS`),new Rr(this.lua.lua_topointer(this.address,r)))}}}close(){this.isClosed()||(this.hookFunctionPointer&&this.lua.module.removeFunction(this.hookFunctionPointer),this.closed=!0)}setTimeout(r){r&&r>0?(this.hookFunctionPointer||(this.hookFunctionPointer=this.lua.module.addFunction(()=>{Date.now()>r&&(this.pushValue(new Nr("thread timeout exceeded")),this.lua.lua_error(this.address))},"vii")),this.lua.lua_sethook(this.address,this.hookFunctionPointer,rt.Count,Do),this.timeout=r):this.hookFunctionPointer&&(this.hookFunctionPointer=void 0,this.timeout=void 0,this.lua.lua_sethook(this.address,null,0,0))}getTimeout(){return this.timeout}getPointer(r){return new Rr(this.lua.lua_topointer(this.address,r))}isClosed(){var r;return!this.address||this.closed||!!(!((r=this.parent)===null||r===void 0)&&r.isClosed())}indexToString(r){let t=this.lua.luaL_tolstring(this.address,r,null);return this.pop(),t}dumpStack(r=console.log){let t=this.getTop();for(let i=1;i<=t;i++){let u=this.lua.lua_type(this.address,i),m=this.lua.lua_typename(this.address,u),h=this.getPointer(i),w=this.indexToString(i),y=this.getValue(i,u);r(i,m,h,w,y)}}assertOk(r){if(r!==we.Ok&&r!==we.Yield){let t=we[r],i=new Error(`Lua Error(${t}/${r})`);if(this.getTop()>0)if(r===we.ErrorMem)i.message=this.lua.lua_tolstring(this.address,-1,null);else{let u=this.getValue(-1);u instanceof Error&&(i.stack=u.stack),i.message=this.indexToString(-1)}if(r!==we.ErrorMem)try{this.lua.luaL_traceback(this.address,this.address,null,1);let u=this.lua.lua_tolstring(this.address,-1,null);u.trim()!=="stack traceback:"&&(i.message=`${i.message}
${u}`),this.pop(1)}catch(u){console.warn("Failed to generate stack trace",u)}throw i}}getValueDecorations(r){return r instanceof ze?r:new ze(r,{})}},nt=class extends tt{constructor(r,t){if(t){let i={memoryUsed:0},u=r.module.addFunction((h,w,y,M)=>{if(M===0)return w&&(i.memoryUsed-=y,r.module._free(w)),0;let D=w?M-y:M,k=i.memoryUsed+D;if(M>y&&i.memoryMax&&k>i.memoryMax)return 0;let le=r.module._realloc(w,M);return le&&(i.memoryUsed=k),le},"iiiii"),m=r.lua_newstate(u,null);if(!m)throw r.module.removeFunction(u),new Error("lua_newstate returned a null pointer");super(r,[],m),this.memoryStats=i,this.allocatorFunctionPointer=u}else super(r,[],r.luaL_newstate());if(this.isClosed())throw new Error("Global state could not be created (probably due to lack of memory)")}close(){if(!this.isClosed()){super.close(),this.lua.lua_close(this.address),this.allocatorFunctionPointer&&this.lua.module.removeFunction(this.allocatorFunctionPointer);for(let r of this.typeExtensions)r.extension.close()}}registerTypeExtension(r,t){this.typeExtensions.push({extension:t,priority:r}),this.typeExtensions.sort((i,u)=>u.priority-i.priority)}loadLibrary(r){switch(r){case xe.Base:this.lua.luaopen_base(this.address);break;case xe.Coroutine:this.lua.luaopen_coroutine(this.address);break;case xe.Table:this.lua.luaopen_table(this.address);break;case xe.IO:this.lua.luaopen_io(this.address);break;case xe.OS:this.lua.luaopen_os(this.address);break;case xe.String:this.lua.luaopen_string(this.address);break;case xe.UTF8:this.lua.luaopen_utf8(this.address);break;case xe.Math:this.lua.luaopen_math(this.address);break;case xe.Debug:this.lua.luaopen_debug(this.address);break;case xe.Package:this.lua.luaopen_package(this.address);break}this.lua.lua_setglobal(this.address,r)}get(r){let t=this.lua.lua_getglobal(this.address,r),i=this.getValue(-1,t);return this.pop(),i}set(r,t){this.pushValue(t),this.lua.lua_setglobal(this.address,r)}getTable(r,t){let i=this.getTop(),u=this.lua.lua_getglobal(this.address,r);try{if(u!==ae.Table)throw new TypeError(`Unexpected type in ${r}. Expected ${ae[ae.Table]}. Got ${ae[u]}.`);t(i+1)}finally{this.getTop()!==i+1&&console.warn(`getTable: expected stack size ${i} got ${this.getTop()}`),this.setTop(i)}}getMemoryUsed(){return this.getMemoryStatsRef().memoryUsed}getMemoryMax(){return this.getMemoryStatsRef().memoryMax}setMemoryMax(r){this.getMemoryStatsRef().memoryMax=r}getMemoryStatsRef(){if(!this.memoryStats)throw new Error("Memory allocations is not being traced, please build engine with { traceAllocations: true }");return this.memoryStats}},Me=class{constructor(r,t){this.thread=r,this.name=t}isType(r,t,i,u){return i===ae.Userdata&&u===this.name}getValue(r,t,i){let u=r.lua.luaL_testudata(r.address,t,this.name);if(!u)throw new Error(`data does not have the expected metatable: ${this.name}`);let m=r.lua.module.getValue(u,"*");return r.lua.getRef(m)}pushValue(r,t,i){let{target:u}=t,m=r.lua.ref(u),h=r.lua.lua_newuserdatauv(r.address,pt,0);if(r.lua.module.setValue(h,m,"*"),ae.Nil===r.lua.luaL_getmetatable(r.address,this.name))throw r.pop(2),new Error(`metatable not found: ${this.name}`);return r.lua.lua_setmetatable(r.address,-2),!0}},at=class extends Me{constructor(r,t){if(super(r,"js_error"),this.gcPointer=r.lua.module.addFunction(i=>{let u=r.lua.luaL_checkudata(i,1,this.name),m=r.lua.module.getValue(u,"*");return r.lua.unref(m),we.Ok},"ii"),r.lua.luaL_newmetatable(r.address,this.name)){let i=r.lua.lua_gettop(r.address);r.lua.lua_pushstring(r.address,"protected metatable"),r.lua.lua_setfield(r.address,i,"__metatable"),r.lua.lua_pushcclosure(r.address,this.gcPointer,0),r.lua.lua_setfield(r.address,i,"__gc"),r.pushValue((u,m)=>m==="message"?u.message:null),r.lua.lua_setfield(r.address,i,"__index"),r.pushValue(u=>u.message),r.lua.lua_setfield(r.address,i,"__tostring")}r.lua.lua_pop(r.address,1),t&&r.set("Error",{create:i=>{if(i&&typeof i!="string")throw new Error("message must be a string");return new Error(i)}})}pushValue(r,t){return t.target instanceof Error?super.pushValue(r,t):!1}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};function Co(l,r){return new at(l,r)}var mr=class{constructor(r){this.count=r}};function Pn(l,r){return new ze(l,r)}var ot=class extends Me{constructor(r,t){super(r,"js_function"),this.functionRegistry=typeof FinalizationRegistry<"u"?new FinalizationRegistry(i=>{this.thread.isClosed()||this.thread.lua.luaL_unref(this.thread.address,Ae,i)}):void 0,this.options=t,this.callbackContext=r.newThread(),this.callbackContextIndex=this.thread.lua.luaL_ref(r.address,Ae),this.functionRegistry||console.warn("FunctionTypeExtension: FinalizationRegistry not found. Memory leaks likely."),this.gcPointer=r.lua.module.addFunction(i=>{r.lua.luaL_checkudata(i,1,this.name);let u=r.lua.luaL_checkudata(i,1,this.name),m=r.lua.module.getValue(u,"*");return r.lua.unref(m),we.Ok},"ii"),r.lua.luaL_newmetatable(r.address,this.name)&&(r.lua.lua_pushstring(r.address,"__gc"),r.lua.lua_pushcclosure(r.address,this.gcPointer,0),r.lua.lua_settable(r.address,-3),r.lua.lua_pushstring(r.address,"__metatable"),r.lua.lua_pushstring(r.address,"protected metatable"),r.lua.lua_settable(r.address,-3)),r.lua.lua_pop(r.address,1),this.functionWrapper=r.lua.module.addFunction(i=>{let u=r.stateToThread(i),m=r.lua.luaL_checkudata(i,r.lua.lua_upvalueindex(1),this.name),h=r.lua.module.getValue(m,"*"),{target:w,options:y}=r.lua.getRef(h),M=u.getTop(),D=[];if(y.receiveThread&&D.push(u),y.receiveArgsQuantity)D.push(M);else for(let k=1;k<=M;k++){let le=u.getValue(k);(k!==1||!y?.self||le!==y.self)&&D.push(le)}try{let k=w.apply(y?.self,D);if(k===void 0)return 0;if(k instanceof mr)return k.count;if(k instanceof Ke){for(let le of k)u.pushValue(le);return k.length}else return u.pushValue(k),1}catch(k){if(k===1/0)throw k;return u.pushValue(k),u.lua.lua_error(u.address)}},"ii")}close(){this.thread.lua.module.removeFunction(this.gcPointer),this.thread.lua.module.removeFunction(this.functionWrapper),this.callbackContext.close(),this.callbackContext.lua.luaL_unref(this.callbackContext.address,Ae,this.callbackContextIndex)}isType(r,t,i){return i===ae.Function}pushValue(r,t){if(typeof t.target!="function")return!1;let i=r.lua.ref(t),u=r.lua.lua_newuserdatauv(r.address,pt,0);if(r.lua.module.setValue(u,i,"*"),ae.Nil===r.lua.luaL_getmetatable(r.address,this.name))throw r.pop(1),r.lua.unref(i),new Error(`metatable not found: ${this.name}`);return r.lua.lua_setmetatable(r.address,-2),r.lua.lua_pushcclosure(r.address,this.functionWrapper,1),!0}getValue(r,t){var i;r.lua.lua_pushvalue(r.address,t);let u=r.lua.luaL_ref(r.address,Ae),m=(...h)=>{var w;if(this.callbackContext.isClosed()){console.warn("Tried to call a function after closing lua state");return}let y=this.callbackContext.newThread();try{let M=y.lua.lua_rawgeti(y.address,Ae,BigInt(u));if(M!==ae.Function){let k=y.lua.luaL_getmetafield(y.address,-1,"__call");if(y.pop(),k!==ae.Function)throw new Error(`A value of type '${M}' was pushed but it is not callable`)}for(let k of h)y.pushValue(k);!((w=this.options)===null||w===void 0)&&w.functionTimeout&&y.setTimeout(Date.now()+this.options.functionTimeout);let D=y.lua.lua_pcallk(y.address,h.length,1,0,0,null);if(D===we.Yield)throw new Error("cannot yield in callbacks from javascript");return y.assertOk(D),y.getTop()>0?y.getValue(-1):void 0}finally{y.close(),this.callbackContext.pop()}};return(i=this.functionRegistry)===null||i===void 0||i.register(m,u),m}};function Io(l,r){return new ot(l,r)}var st=class extends Me{constructor(r){if(super(r,"js_null"),this.gcPointer=r.lua.module.addFunction(t=>{let i=r.lua.luaL_checkudata(t,1,this.name),u=r.lua.module.getValue(i,"*");return r.lua.unref(u),we.Ok},"ii"),r.lua.luaL_newmetatable(r.address,this.name)){let t=r.lua.lua_gettop(r.address);r.lua.lua_pushstring(r.address,"protected metatable"),r.lua.lua_setfield(r.address,t,"__metatable"),r.lua.lua_pushcclosure(r.address,this.gcPointer,0),r.lua.lua_setfield(r.address,t,"__gc"),r.pushValue(()=>null),r.lua.lua_setfield(r.address,t,"__index"),r.pushValue(()=>"null"),r.lua.lua_setfield(r.address,t,"__tostring"),r.pushValue((i,u)=>i===u),r.lua.lua_setfield(r.address,t,"__eq")}r.lua.lua_pop(r.address,1),super.pushValue(r,new ze({},{})),r.lua.lua_setglobal(r.address,"null")}getValue(r,t){if(!r.lua.luaL_testudata(r.address,t,this.name))throw new Error(`data does not have the expected metatable: ${this.name}`);return null}pushValue(r,t){return t?.target!==null?!1:(r.lua.lua_getglobal(r.address,"null"),!0)}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};function Uo(l){return new st(l)}var it=l=>l&&(Promise.resolve(l)===l||typeof l.then=="function"),ut=class extends Me{constructor(r,t){if(super(r,"js_promise"),this.gcPointer=r.lua.module.addFunction(i=>{let u=r.lua.luaL_checkudata(i,1,this.name),m=r.lua.module.getValue(u,"*");return r.lua.unref(m),we.Ok},"ii"),r.lua.luaL_newmetatable(r.address,this.name)){let i=r.lua.lua_gettop(r.address);r.lua.lua_pushstring(r.address,"protected metatable"),r.lua.lua_setfield(r.address,i,"__metatable"),r.lua.lua_pushcclosure(r.address,this.gcPointer,0),r.lua.lua_setfield(r.address,i,"__gc");let u=m=>{if(!it(m))throw new Error("self instance is not a promise");return!0};r.pushValue({next:(m,...h)=>u(m)&&m.then(...h),catch:(m,...h)=>u(m)&&m.catch(...h),finally:(m,...h)=>u(m)&&m.finally(...h),await:Pn((m,h)=>{if(u(h),m.address===r.address)throw new Error("cannot await in the main thread");let w,y=h.then(D=>{w={status:"fulfilled",value:D}}).catch(D=>{w={status:"rejected",value:D}}),M=this.thread.lua.module.addFunction(D=>{if(!w)return r.lua.lua_yieldk(m.address,0,0,M);this.thread.lua.module.removeFunction(M);let k=r.stateToThread(D);if(w.status==="rejected")return k.pushValue(w.value||new Error("promise rejected with no error")),this.thread.lua.lua_error(D);if(w.value instanceof mr)return w.value.count;if(w.value instanceof Ke){for(let le of w.value)k.pushValue(le);return w.value.length}else return k.pushValue(w.value),1},"iiii");return m.pushValue(y),new mr(r.lua.lua_yieldk(m.address,1,0,M))},{receiveThread:!0})}),r.lua.lua_setfield(r.address,i,"__index"),r.pushValue((m,h)=>m===h),r.lua.lua_setfield(r.address,i,"__eq")}r.lua.lua_pop(r.address,1),t&&r.set("Promise",{create:i=>new Promise(i),all:i=>{if(!Array.isArray(i))throw new Error("argument must be an array of promises");return Promise.all(i.map(u=>Promise.resolve(u)))},resolve:i=>Promise.resolve(i)})}close(){this.thread.lua.module.removeFunction(this.gcPointer)}pushValue(r,t){return it(t.target)?super.pushValue(r,t):!1}};function Bo(l,r){return new ut(l,r)}function Vo(l,r){return new ze(l,r||{})}var lt=class extends Me{constructor(r){if(super(r,"js_proxy"),this.gcPointer=r.lua.module.addFunction(t=>{let i=r.lua.luaL_checkudata(t,1,this.name),u=r.lua.module.getValue(i,"*");return r.lua.unref(u),we.Ok},"ii"),r.lua.luaL_newmetatable(r.address,this.name)){let t=r.lua.lua_gettop(r.address);r.lua.lua_pushstring(r.address,"protected metatable"),r.lua.lua_setfield(r.address,t,"__metatable"),r.lua.lua_pushcclosure(r.address,this.gcPointer,0),r.lua.lua_setfield(r.address,t,"__gc"),r.pushValue((i,u)=>{switch(typeof u){case"number":u=u-1;case"string":break;default:throw new Error("Only strings or numbers can index js objects")}let m=i[u];return typeof m=="function"?Pn(m,{self:i}):m}),r.lua.lua_setfield(r.address,t,"__index"),r.pushValue((i,u,m)=>{switch(typeof u){case"number":u=u-1;case"string":break;default:throw new Error("Only strings or numbers can index js objects")}i[u]=m}),r.lua.lua_setfield(r.address,t,"__newindex"),r.pushValue(i=>{var u,m;return(m=(u=i.toString)===null||u===void 0?void 0:u.call(i))!==null&&m!==void 0?m:typeof i}),r.lua.lua_setfield(r.address,t,"__tostring"),r.pushValue(i=>i.length||0),r.lua.lua_setfield(r.address,t,"__len"),r.pushValue(i=>{let u=Object.getOwnPropertyNames(i),m=0;return Ke.of(()=>{let h=Ke.of(u[m],i[u[m]]);return m++,h},i,null)}),r.lua.lua_setfield(r.address,t,"__pairs"),r.pushValue((i,u)=>i===u),r.lua.lua_setfield(r.address,t,"__eq"),r.pushValue((i,...u)=>(u[0]===i&&u.shift(),i(...u))),r.lua.lua_setfield(r.address,t,"__call")}r.lua.lua_pop(r.address,1)}isType(r,t,i,u){return i===ae.Userdata&&u===this.name}getValue(r,t){let i=r.lua.lua_touserdata(r.address,t),u=r.lua.module.getValue(i,"*");return r.lua.getRef(u)}pushValue(r,t){var i;let{target:u,options:m}=t;if(m.proxy===void 0){if(u==null||typeof u!="object"&&!(typeof u=="function"&&((i=u.prototype)===null||i===void 0?void 0:i.constructor)===u&&u.toString().startsWith("class "))||it(u))return!1}else if(m.proxy===!1)return!1;return m.metatable&&!(m.metatable instanceof ze)?(t.options.metatable=Vo(m.metatable,{proxy:!1}),!1):super.pushValue(r,t)}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};function $o(l){return new lt(l)}var ct=class extends Me{constructor(r){super(r,"js_table")}close(){}isType(r,t,i){return i===ae.Table}getValue(r,t,i){let u=i||new Map,m=r.lua.lua_topointer(r.address,t),h=u.get(m);if(!h){let w=this.readTableKeys(r,t);h=w.length>0&&w.every((M,D)=>M===String(D+1))?[]:{},u.set(m,h),this.readTableValues(r,t,u,h)}return h}pushValue(r,{target:t},i){if(typeof t!="object"||t===null)return!1;let u=i||new Map,m=u.get(t);if(m!==void 0)return r.lua.lua_rawgeti(r.address,Ae,BigInt(m)),!0;try{let h=r.getTop()+1,w=(y,M)=>{r.lua.lua_createtable(r.address,y,M);let D=r.lua.luaL_ref(r.address,Ae);u.set(t,D),r.lua.lua_rawgeti(r.address,Ae,BigInt(D))};if(Array.isArray(t)){w(t.length,0);for(let y=0;y<t.length;y++)r.pushValue(y+1,u),r.pushValue(t[y],u),r.lua.lua_settable(r.address,h)}else{w(0,Object.getOwnPropertyNames(t).length);for(let y in t)r.pushValue(y,u),r.pushValue(t[y],u),r.lua.lua_settable(r.address,h)}}finally{if(i===void 0)for(let h of u.values())r.lua.luaL_unref(r.address,Ae,h)}return!0}readTableKeys(r,t){let i=[];for(r.lua.lua_pushnil(r.address);r.lua.lua_next(r.address,t);){let u=r.indexToString(-2);i.push(u),r.pop()}return i}readTableValues(r,t,i,u){let m=Array.isArray(u);for(r.lua.lua_pushnil(r.address);r.lua.lua_next(r.address,t);){let h=r.indexToString(-2),w=r.getValue(-1,void 0,i);m?u.push(w):u[h]=w,r.pop()}}};function jo(l){return new ct(l)}var dt=class extends Me{constructor(r){if(super(r,"js_userdata"),this.gcPointer=r.lua.module.addFunction(t=>{let i=r.lua.luaL_checkudata(t,1,this.name),u=r.lua.module.getValue(i,"*");return r.lua.unref(u),we.Ok},"ii"),r.lua.luaL_newmetatable(r.address,this.name)){let t=r.lua.lua_gettop(r.address);r.lua.lua_pushstring(r.address,"protected metatable"),r.lua.lua_setfield(r.address,t,"__metatable"),r.lua.lua_pushcclosure(r.address,this.gcPointer,0),r.lua.lua_setfield(r.address,t,"__gc")}r.lua.lua_pop(r.address,1)}isType(r,t,i,u){return i===ae.Userdata&&u===this.name}getValue(r,t){let i=r.lua.lua_touserdata(r.address,t),u=r.lua.module.getValue(i,"*");return r.lua.getRef(u)}pushValue(r,t){return t.options.reference?super.pushValue(r,t):!1}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};function zo(l){return new dt(l)}var mt=class{constructor(r,{openStandardLibs:t=!0,injectObjects:i=!1,enableProxy:u=!0,traceAllocations:m=!1,functionTimeout:h=void 0}={}){this.cmodule=r,this.global=new nt(this.cmodule,m),this.global.registerTypeExtension(0,jo(this.global)),this.global.registerTypeExtension(0,Io(this.global,{functionTimeout:h})),this.global.registerTypeExtension(1,Bo(this.global,i)),i&&this.global.registerTypeExtension(5,Uo(this.global)),u?this.global.registerTypeExtension(3,$o(this.global)):this.global.registerTypeExtension(1,Co(this.global,i)),this.global.registerTypeExtension(4,zo(this.global)),t&&this.cmodule.luaL_openlibs(this.global.address)}doString(r){return this.callByteCode(t=>t.loadString(r))}doFile(r){return this.callByteCode(t=>t.loadFile(r))}doStringSync(r){return this.global.loadString(r),this.global.runSync()[0]}doFileSync(r){return this.global.loadFile(r),this.global.runSync()[0]}async callByteCode(r){let t=this.global.newThread(),i=this.global.getTop();try{r(t);let u=await t.run(0);return u.length>0?(this.cmodule.lua_xmove(t.address,this.global.address,u.length),this.global.getValue(this.global.getTop()-u.length+1)):void 0}finally{this.global.remove(i)}}},Ho=async function(l={}){var r,t=Object.assign({},l),i,u,m=new Promise((e,n)=>{i=e,u=n});["_malloc","_free","_realloc","_luaL_checkversion_","_luaL_getmetafield","_luaL_callmeta","_luaL_tolstring","_luaL_argerror","_luaL_typeerror","_luaL_checklstring","_luaL_optlstring","_luaL_checknumber","_luaL_optnumber","_luaL_checkinteger","_luaL_optinteger","_luaL_checkstack","_luaL_checktype","_luaL_checkany","_luaL_newmetatable","_luaL_setmetatable","_luaL_testudata","_luaL_checkudata","_luaL_where","_luaL_fileresult","_luaL_execresult","_luaL_ref","_luaL_unref","_luaL_loadfilex","_luaL_loadbufferx","_luaL_loadstring","_luaL_newstate","_luaL_len","_luaL_addgsub","_luaL_gsub","_luaL_setfuncs","_luaL_getsubtable","_luaL_traceback","_luaL_requiref","_luaL_buffinit","_luaL_prepbuffsize","_luaL_addlstring","_luaL_addstring","_luaL_addvalue","_luaL_pushresult","_luaL_pushresultsize","_luaL_buffinitsize","_lua_newstate","_lua_close","_lua_newthread","_lua_resetthread","_lua_atpanic","_lua_version","_lua_absindex","_lua_gettop","_lua_settop","_lua_pushvalue","_lua_rotate","_lua_copy","_lua_checkstack","_lua_xmove","_lua_isnumber","_lua_isstring","_lua_iscfunction","_lua_isinteger","_lua_isuserdata","_lua_type","_lua_typename","_lua_tonumberx","_lua_tointegerx","_lua_toboolean","_lua_tolstring","_lua_rawlen","_lua_tocfunction","_lua_touserdata","_lua_tothread","_lua_topointer","_lua_arith","_lua_rawequal","_lua_compare","_lua_pushnil","_lua_pushnumber","_lua_pushinteger","_lua_pushlstring","_lua_pushstring","_lua_pushcclosure","_lua_pushboolean","_lua_pushlightuserdata","_lua_pushthread","_lua_getglobal","_lua_gettable","_lua_getfield","_lua_geti","_lua_rawget","_lua_rawgeti","_lua_rawgetp","_lua_createtable","_lua_newuserdatauv","_lua_getmetatable","_lua_getiuservalue","_lua_setglobal","_lua_settable","_lua_setfield","_lua_seti","_lua_rawset","_lua_rawseti","_lua_rawsetp","_lua_setmetatable","_lua_setiuservalue","_lua_callk","_lua_pcallk","_lua_load","_lua_dump","_lua_yieldk","_lua_resume","_lua_status","_lua_isyieldable","_lua_setwarnf","_lua_warning","_lua_error","_lua_next","_lua_concat","_lua_len","_lua_stringtonumber","_lua_getallocf","_lua_setallocf","_lua_toclose","_lua_closeslot","_lua_getstack","_lua_getinfo","_lua_getlocal","_lua_setlocal","_lua_getupvalue","_lua_setupvalue","_lua_upvalueid","_lua_upvaluejoin","_lua_sethook","_lua_gethook","_lua_gethookmask","_lua_gethookcount","_lua_setcstacklimit","_luaopen_base","_luaopen_coroutine","_luaopen_table","_luaopen_io","_luaopen_os","_luaopen_string","_luaopen_utf8","_luaopen_math","_luaopen_debug","_luaopen_package","_luaL_openlibs","_memory","___indirect_function_table","___set_stack_limits","onRuntimeInitialized"].forEach(e=>{Object.getOwnPropertyDescriptor(m,e)||Object.defineProperty(m,e,{get:()=>I("You are getting "+e+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>{I("You are setting "+e+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})});var h=typeof window=="object",w=typeof importScripts=="function",y=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",M=!h&&!y&&!w;if(t.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");var D=Object.assign({},t),k="./this.program",le=(e,n)=>{throw n},ie="";function In(e){return t.locateFile?t.locateFile(e,ie):ie+e}var Dr,pr,Cr;if(h||w){if(w?ie=self.location.href:typeof document<"u"&&document.currentScript&&(ie=document.currentScript.src),ie.startsWith("blob:")?ie="":ie=ie.substr(0,ie.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof importScripts=="function"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");Dr=e=>{var n=new XMLHttpRequest;return n.open("GET",e,!1),n.send(null),n.responseText},w&&(Cr=e=>{var n=new XMLHttpRequest;return n.open("GET",e,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),pr=(e,n,a)=>{var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=()=>{if(o.status==200||o.status==0&&o.response){n(o.response);return}a()},o.onerror=a,o.send(null)}}else throw new Error("environment detection error");var Ge=console.log.bind(console),_e=console.error.bind(console);Object.assign(t,D),D=null,go(),Ne("arguments","arguments_"),Ne("thisProgram","thisProgram"),Ne("quit","quit_"),E(typeof t.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),E(typeof t.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),E(typeof t.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),E(typeof t.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),E(typeof t.read>"u","Module.read option was removed (modify read_ in JS)"),E(typeof t.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),E(typeof t.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),E(typeof t.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),E(typeof t.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),Ne("asm","wasmExports"),Ne("read","read_"),Ne("readAsync","readAsync"),Ne("readBinary","readBinary"),Ne("setWindowTitle","setWindowTitle"),E(!M,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var Ir;Ne("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&_e("no native wasm support detected");function bt(e,n){switch(e){case 1:return"i8";case 2:return"i16";case 4:return n?"float":"i32";case 8:return n?"double":"i64";default:I(`getSafeHeapType() invalid bytes=${e}`)}}function v(e,n,a,o){if(e<=0&&I(`segmentation fault storing ${a} bytes to address ${e}`),e%a!==0&&I(`alignment error storing to address ${e}, which was expected to be aligned to a multiple of ${a}`),nr){var c=Yt(0);e+a>c&&I(`segmentation fault, exceeded the top of the available dynamic heap when storing ${a} bytes to address ${e}. DYNAMICTOP=${c}`),c<qe()&&I(`brk >= _emscripten_stack_get_base() (brk=${c}, _emscripten_stack_get_base()=${qe()})`),c>Fe.buffer.byteLength&&I(`brk <= wasmMemory.buffer.byteLength (brk=${c}, wasmMemory.buffer.byteLength=${Fe.buffer.byteLength})`)}return oa(e,n,bt(a,o)),n}function yt(e,n,a){return v(e,n,a,!0)}function C(e,n,a,o){if(e<=0&&I(`segmentation fault loading ${n} bytes from address ${e}`),e%n!==0&&I(`alignment error loading from address ${e}, which was expected to be aligned to a multiple of ${n}`),nr){var c=Yt(0);e+n>c&&I(`segmentation fault, exceeded the top of the available dynamic heap when loading ${n} bytes from address ${e}. DYNAMICTOP=${c}`),c<qe()&&I(`brk >= _emscripten_stack_get_base() (brk=${c}, _emscripten_stack_get_base()=${qe()})`),c>Fe.buffer.byteLength&&I(`brk <= wasmMemory.buffer.byteLength (brk=${c}, wasmMemory.buffer.byteLength=${Fe.buffer.byteLength})`)}var d=bt(n,o),f=ta(e,d);return a&&(f=sa(f,parseInt(d.substr(1),10))),f}function wt(e,n,a){return C(e,n,a,!0)}function Un(){I("segmentation fault")}function Bn(){I("alignment fault")}var Fe,rr=!1;function E(e,n){e||I("Assertion failed"+(n?": "+n:""))}var Ee,tr,Ur,Br,Vr,$r,Se,jr;function vt(){var e=Fe.buffer;Ee=new Int8Array(e),Ur=new Int16Array(e),tr=new Uint8Array(e),Br=new Int32Array(e),Vr=new Uint32Array(e),$r=new Float32Array(e),jr=new Float64Array(e),Se=new BigInt64Array(e),new BigUint64Array(e)}E(!t.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),E(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),E(!t.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),E(!t.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function Vn(){var e=lr();E((e&3)==0),e==0&&(e+=4),v((e>>2)*4,34821223,4),v((e+4>>2)*4,2310721022,4)}function zr(){if(!rr){var e=lr();e==0&&(e+=4);var n=C((e>>2)*4,4,1),a=C((e+4>>2)*4,4,1);(n!=34821223||a!=2310721022)&&I(`Stack overflow! Stack cookie has been overwritten at ${Ce(e)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${Ce(a)} ${Ce(n)}`)}}(function(){var e=new Int16Array(1),n=new Int8Array(e.buffer);if(e[0]=25459,n[0]!==115||n[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})();var Et=[],kt=[],$n=[],nr=!1;function jn(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Wn(t.preRun.shift());Yr(Et)}function zn(){E(!nr),nr=!0,zr(),na(),!t.noFSInit&&!s.init.initialized&&s.init(),s.ignorePermissions=!1,Yr(kt)}function Hn(){zr(),Yr($n)}function Wn(e){Et.unshift(e)}function Yn(e){kt.unshift(e)}E(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),E(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),E(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),E(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var ar=0,We=null,or=null,Xe={};function Tt(e){for(var n=e;;){if(!Xe[e])return e;e=n+Math.random()}}function Hr(e){ar++,e?(E(!Xe[e]),Xe[e]=1,We===null&&typeof setInterval<"u"&&(We=setInterval(()=>{if(rr){clearInterval(We),We=null;return}var n=!1;for(var a in Xe)n||(n=!0,_e("still waiting on run dependencies:")),_e(`dependency: ${a}`);n&&_e("(end of list)")},1e4))):_e("warning: run dependency added without ID")}function _r(e){if(ar--,e?(E(Xe[e]),delete Xe[e]):_e("warning: run dependency removed without ID"),ar==0&&(We!==null&&(clearInterval(We),We=null),or)){var n=or;or=null,n()}}function I(e){e="Aborted("+e+")",_e(e),rr=!0;var n=new WebAssembly.RuntimeError(e);throw u(n),n}var qn="data:application/octet-stream;base64,",xt=e=>e.startsWith(qn),Wr=e=>e.startsWith("file://");function p(e,n){return(...a)=>{E(nr,`native function \`${e}\` called before runtime initialization`);var o=ke[e];return E(o,`exported native function \`${e}\` not found`),E(a.length<=n,`native function \`${e}\` called with ${a.length} args but expects ${n}`),o(...a)}}function Kn(){if(t.locateFile){var e="glue.wasm";return xt(e)?e:In(e)}return new URL("glue.wasm").href}var Je;function St(e){if(e==Je&&Ir)return new Uint8Array(Ir);if(Cr)return Cr(e);throw"both async and sync fetching of the wasm failed"}function Gn(e){if(h||w){if(typeof fetch=="function"&&!Wr(e))return fetch(e,{credentials:"same-origin"}).then(n=>{if(!n.ok)throw`failed to load wasm binary file at '${e}'`;return n.arrayBuffer()}).catch(()=>St(e));if(pr)return new Promise((n,a)=>{pr(e,o=>n(new Uint8Array(o)),a)})}return Promise.resolve().then(()=>St(e))}function Lt(e,n,a){return Gn(e).then(o=>WebAssembly.instantiate(o,n)).then(a,o=>{_e(`failed to asynchronously prepare wasm: ${o}`),Wr(Je)&&_e(`warning: Loading from a file URI (${Je}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),I(o)})}function Xn(e,n,a,o){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!xt(n)&&!Wr(n)&&!y&&typeof fetch=="function"?fetch(n,{credentials:"same-origin"}).then(c=>{var d=WebAssembly.instantiateStreaming(c,a);return d.then(o,function(f){return _e(`wasm streaming compile failed: ${f}`),_e("falling back to ArrayBuffer instantiation"),Lt(n,a,o)})}):Lt(n,a,o)}function Jn(){return{env:Ht,wasi_snapshot_preview1:Ht}}function Zn(){var e=Jn();function n(c,d){return ke=c.exports,Fe=ke.memory,E(Fe,"memory not found in wasm exports"),vt(),Oe=ke.__indirect_function_table,E(Oe,"table not found in wasm exports"),Yn(ke.__wasm_call_ctors),_r("wasm-instantiate"),ke}Hr("wasm-instantiate");var a=t;function o(c){E(t===a,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),a=null,n(c.instance)}return Je||(Je=Kn()),Xn(Ir,Je,e,o).catch(u),{}}function Ne(e,n,a=!0){Object.getOwnPropertyDescriptor(t,e)||Object.defineProperty(t,e,{configurable:!0,get(){let o=a?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";I(`\`Module.${e}\` has been replaced by \`${n}\``+o)}})}function L(e){Object.getOwnPropertyDescriptor(t,e)&&I(`\`Module.${e}\` was supplied but \`${e}\` not included in INCOMING_MODULE_JS_API`)}function At(e){return e==="FS_createPath"||e==="FS_createDataFile"||e==="FS_createPreloadedFile"||e==="FS_unlink"||e==="addRunDependency"||e==="FS_createLazyFile"||e==="FS_createDevice"||e==="removeRunDependency"}function Pt(e,n){typeof globalThis<"u"&&Object.defineProperty(globalThis,e,{configurable:!0,get(){Ie(`\`${e}\` is not longer defined by emscripten. ${n}`)}})}Pt("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),Pt("asm","Please use wasmExports instead");function Qn(e){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,e)&&Object.defineProperty(globalThis,e,{configurable:!0,get(){var n=`\`${e}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,a=e;a.startsWith("_")||(a="$"+e),n+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${a}')`,At(e)&&(n+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),Ie(n)}}),Ft(e)}function Ft(e){Object.getOwnPropertyDescriptor(t,e)||Object.defineProperty(t,e,{configurable:!0,get(){var n=`'${e}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;At(e)&&(n+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),I(n)}})}function ea(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var Yr=e=>{for(;e.length>0;)e.shift()(t)};function ra(e,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":return C(e,1,0);case"i8":return C(e,1,0);case"i16":return C((e>>1)*2,2,0);case"i32":return C((e>>2)*4,4,0);case"i64":return Se[e>>3];case"float":return wt((e>>2)*4,4,0);case"double":return wt((e>>3)*8,8,0);case"*":return C((e>>2)*4,4,1);default:I(`invalid type for getValue: ${n}`)}}function ta(e,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":return Ee[e];case"i8":return Ee[e];case"i16":return Ur[e>>1];case"i32":return Br[e>>2];case"i64":return Se[e>>3];case"float":return $r[e>>2];case"double":return jr[e>>3];case"*":return Vr[e>>2];default:I(`invalid type for getValue: ${n}`)}}var Ce=e=>(E(typeof e=="number"),e>>>=0,"0x"+e.toString(16).padStart(8,"0")),na=()=>{var e=qe(),n=lr();wo(e,n)};function aa(e,n,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":v(e,n,1);break;case"i8":v(e,n,1);break;case"i16":v((e>>1)*2,n,2);break;case"i32":v((e>>2)*4,n,4);break;case"i64":Se[e>>3]=BigInt(n);break;case"float":yt((e>>2)*4,n,4);break;case"double":yt((e>>3)*8,n,8);break;case"*":v((e>>2)*4,n,4);break;default:I(`invalid type for setValue: ${a}`)}}function oa(e,n,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":Ee[e]=n;break;case"i8":Ee[e]=n;break;case"i16":Ur[e>>1]=n;break;case"i32":Br[e>>2]=n;break;case"i64":Se[e>>3]=BigInt(n);break;case"float":$r[e>>2]=n;break;case"double":jr[e>>3]=n;break;case"*":Vr[e>>2]=n;break;default:I(`invalid type for setValue: ${a}`)}}var Nt=e=>Kt(e),Rt=()=>Xt(),sa=(e,n)=>e>=0?e:n<=32?2*Math.abs(1<<n-1)+e:Math.pow(2,n)+e,Ie=e=>{Ie.shown||={},Ie.shown[e]||(Ie.shown[e]=1,y&&(e="warning: "+e),_e(e))},ia=e=>{var n=qe(),a=lr();I(`stack overflow (Attempt to set SP to ${Ce(e)}, with stack limits [${Ce(a)} - ${Ce(n)}]). If you require more stack space build with -sSTACK_SIZE=<bytes>`)},ne={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return n.exec(e).slice(1)},normalizeArray:(e,n)=>{for(var a=0,o=e.length-1;o>=0;o--){var c=e[o];c==="."?e.splice(o,1):c===".."?(e.splice(o,1),a++):a&&(e.splice(o,1),a--)}if(n)for(;a;a--)e.unshift("..");return e},normalize:e=>{var n=ne.isAbs(e),a=e.substr(-1)==="/";return e=ne.normalizeArray(e.split("/").filter(o=>!!o),!n).join("/"),!e&&!n&&(e="."),e&&a&&(e+="/"),(n?"/":"")+e},dirname:e=>{var n=ne.splitPath(e),a=n[0],o=n[1];return!a&&!o?".":(o&&(o=o.substr(0,o.length-1)),a+o)},basename:e=>{if(e==="/")return"/";e=ne.normalize(e),e=e.replace(/\/$/,"");var n=e.lastIndexOf("/");return n===-1?e:e.substr(n+1)},join:(...e)=>ne.normalize(e.join("/")),join2:(e,n)=>ne.normalize(e+"/"+n)},ua=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return e=>crypto.getRandomValues(e);I("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},Ot=e=>(Ot=ua())(e),Re={resolve:(...e)=>{for(var n="",a=!1,o=e.length-1;o>=-1&&!a;o--){var c=o>=0?e[o]:s.cwd();if(typeof c!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!c)return"";n=c+"/"+n,a=ne.isAbs(c)}return n=ne.normalizeArray(n.split("/").filter(d=>!!d),!a).join("/"),(a?"/":"")+n||"."},relative:(e,n)=>{e=Re.resolve(e).substr(1),n=Re.resolve(n).substr(1);function a(P){for(var N=0;N<P.length&&P[N]==="";N++);for(var O=P.length-1;O>=0&&P[O]==="";O--);return N>O?[]:P.slice(N,O-N+1)}for(var o=a(e.split("/")),c=a(n.split("/")),d=Math.min(o.length,c.length),f=d,_=0;_<d;_++)if(o[_]!==c[_]){f=_;break}for(var b=[],_=f;_<o.length;_++)b.push("..");return b=b.concat(c.slice(f)),b.join("/")}},Mt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Ze=(e,n,a)=>{for(var o=n+a,c=n;e[c]&&!(c>=o);)++c;if(c-n>16&&e.buffer&&Mt)return Mt.decode(e.subarray(n,c));for(var d="";n<c;){var f=e[n++];if(!(f&128)){d+=String.fromCharCode(f);continue}var _=e[n++]&63;if((f&224)==192){d+=String.fromCharCode((f&31)<<6|_);continue}var b=e[n++]&63;if((f&240)==224?f=(f&15)<<12|_<<6|b:((f&248)!=240&&Ie("Invalid UTF-8 leading byte "+Ce(f)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),f=(f&7)<<18|_<<12|b<<6|e[n++]&63),f<65536)d+=String.fromCharCode(f);else{var P=f-65536;d+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return d},qr=[],Ue=e=>{for(var n=0,a=0;a<e.length;++a){var o=e.charCodeAt(a);o<=127?n++:o<=2047?n+=2:o>=55296&&o<=57343?(n+=4,++a):n+=3}return n},Kr=(e,n,a,o)=>{if(E(typeof e=="string",`stringToUTF8Array expects a string (got ${typeof e})`),!(o>0))return 0;for(var c=a,d=a+o-1,f=0;f<e.length;++f){var _=e.charCodeAt(f);if(_>=55296&&_<=57343){var b=e.charCodeAt(++f);_=65536+((_&1023)<<10)|b&1023}if(_<=127){if(a>=d)break;n[a++]=_}else if(_<=2047){if(a+1>=d)break;n[a++]=192|_>>6,n[a++]=128|_&63}else if(_<=65535){if(a+2>=d)break;n[a++]=224|_>>12,n[a++]=128|_>>6&63,n[a++]=128|_&63}else{if(a+3>=d)break;_>1114111&&Ie("Invalid Unicode code point "+Ce(_)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),n[a++]=240|_>>18,n[a++]=128|_>>12&63,n[a++]=128|_>>6&63,n[a++]=128|_&63}}return n[a]=0,a-c};function hr(e,n,a){var o=a>0?a:Ue(e)+1,c=new Array(o),d=Kr(e,c,0,c.length);return n&&(c.length=d),c}var la=()=>{if(!qr.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(e=window.prompt("Input: "),e!==null&&(e+=`
`)),!e)return null;qr=hr(e,!0)}return qr.shift()},Be={ttys:[],init(){},shutdown(){},register(e,n){Be.ttys[e]={input:[],output:[],ops:n},s.registerDevice(e,Be.stream_ops)},stream_ops:{open(e){var n=Be.ttys[e.node.rdev];if(!n)throw new s.ErrnoError(43);e.tty=n,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,n,a,o,c){if(!e.tty||!e.tty.ops.get_char)throw new s.ErrnoError(60);for(var d=0,f=0;f<o;f++){var _;try{_=e.tty.ops.get_char(e.tty)}catch{throw new s.ErrnoError(29)}if(_===void 0&&d===0)throw new s.ErrnoError(6);if(_==null)break;d++,n[a+f]=_}return d&&(e.node.timestamp=Date.now()),d},write(e,n,a,o,c){if(!e.tty||!e.tty.ops.put_char)throw new s.ErrnoError(60);try{for(var d=0;d<o;d++)e.tty.ops.put_char(e.tty,n[a+d])}catch{throw new s.ErrnoError(29)}return o&&(e.node.timestamp=Date.now()),d}},default_tty_ops:{get_char(e){return la()},put_char(e,n){n===null||n===10?(Ge(Ze(e.output,0)),e.output=[]):n!=0&&e.output.push(n)},fsync(e){e.output&&e.output.length>0&&(Ge(Ze(e.output,0)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,n,a){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,n){n===null||n===10?(_e(Ze(e.output,0)),e.output=[]):n!=0&&e.output.push(n)},fsync(e){e.output&&e.output.length>0&&(_e(Ze(e.output,0)),e.output=[])}}},Dt=e=>{I("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},R={ops_table:null,mount(e){return R.createNode(null,"/",16895,0)},createNode(e,n,a,o){if(s.isBlkdev(a)||s.isFIFO(a))throw new s.ErrnoError(63);R.ops_table||={dir:{node:{getattr:R.node_ops.getattr,setattr:R.node_ops.setattr,lookup:R.node_ops.lookup,mknod:R.node_ops.mknod,rename:R.node_ops.rename,unlink:R.node_ops.unlink,rmdir:R.node_ops.rmdir,readdir:R.node_ops.readdir,symlink:R.node_ops.symlink},stream:{llseek:R.stream_ops.llseek}},file:{node:{getattr:R.node_ops.getattr,setattr:R.node_ops.setattr},stream:{llseek:R.stream_ops.llseek,read:R.stream_ops.read,write:R.stream_ops.write,allocate:R.stream_ops.allocate,mmap:R.stream_ops.mmap,msync:R.stream_ops.msync}},link:{node:{getattr:R.node_ops.getattr,setattr:R.node_ops.setattr,readlink:R.node_ops.readlink},stream:{}},chrdev:{node:{getattr:R.node_ops.getattr,setattr:R.node_ops.setattr},stream:s.chrdev_stream_ops}};var c=s.createNode(e,n,a,o);return s.isDir(c.mode)?(c.node_ops=R.ops_table.dir.node,c.stream_ops=R.ops_table.dir.stream,c.contents={}):s.isFile(c.mode)?(c.node_ops=R.ops_table.file.node,c.stream_ops=R.ops_table.file.stream,c.usedBytes=0,c.contents=null):s.isLink(c.mode)?(c.node_ops=R.ops_table.link.node,c.stream_ops=R.ops_table.link.stream):s.isChrdev(c.mode)&&(c.node_ops=R.ops_table.chrdev.node,c.stream_ops=R.ops_table.chrdev.stream),c.timestamp=Date.now(),e&&(e.contents[n]=c,e.timestamp=c.timestamp),c},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,n){var a=e.contents?e.contents.length:0;if(!(a>=n)){var o=1024*1024;n=Math.max(n,a*(a<o?2:1.125)>>>0),a!=0&&(n=Math.max(n,256));var c=e.contents;e.contents=new Uint8Array(n),e.usedBytes>0&&e.contents.set(c.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,n){if(e.usedBytes!=n)if(n==0)e.contents=null,e.usedBytes=0;else{var a=e.contents;e.contents=new Uint8Array(n),a&&e.contents.set(a.subarray(0,Math.min(n,e.usedBytes))),e.usedBytes=n}},node_ops:{getattr(e){var n={};return n.dev=s.isChrdev(e.mode)?e.id:1,n.ino=e.id,n.mode=e.mode,n.nlink=1,n.uid=0,n.gid=0,n.rdev=e.rdev,s.isDir(e.mode)?n.size=4096:s.isFile(e.mode)?n.size=e.usedBytes:s.isLink(e.mode)?n.size=e.link.length:n.size=0,n.atime=new Date(e.timestamp),n.mtime=new Date(e.timestamp),n.ctime=new Date(e.timestamp),n.blksize=4096,n.blocks=Math.ceil(n.size/n.blksize),n},setattr(e,n){n.mode!==void 0&&(e.mode=n.mode),n.timestamp!==void 0&&(e.timestamp=n.timestamp),n.size!==void 0&&R.resizeFileStorage(e,n.size)},lookup(e,n){throw s.genericErrors[44]},mknod(e,n,a,o){return R.createNode(e,n,a,o)},rename(e,n,a){if(s.isDir(e.mode)){var o;try{o=s.lookupNode(n,a)}catch{}if(o)for(var c in o.contents)throw new s.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=a,n.contents[a]=e,n.timestamp=e.parent.timestamp,e.parent=n},unlink(e,n){delete e.contents[n],e.timestamp=Date.now()},rmdir(e,n){var a=s.lookupNode(e,n);for(var o in a.contents)throw new s.ErrnoError(55);delete e.contents[n],e.timestamp=Date.now()},readdir(e){var n=[".",".."];for(var a of Object.keys(e.contents))n.push(a);return n},symlink(e,n,a){var o=R.createNode(e,n,41471,0);return o.link=a,o},readlink(e){if(!s.isLink(e.mode))throw new s.ErrnoError(28);return e.link}},stream_ops:{read(e,n,a,o,c){var d=e.node.contents;if(c>=e.node.usedBytes)return 0;var f=Math.min(e.node.usedBytes-c,o);if(E(f>=0),f>8&&d.subarray)n.set(d.subarray(c,c+f),a);else for(var _=0;_<f;_++)n[a+_]=d[c+_];return f},write(e,n,a,o,c,d){if(E(!(n instanceof ArrayBuffer)),n.buffer===Ee.buffer&&(d=!1),!o)return 0;var f=e.node;if(f.timestamp=Date.now(),n.subarray&&(!f.contents||f.contents.subarray)){if(d)return E(c===0,"canOwn must imply no weird position inside the file"),f.contents=n.subarray(a,a+o),f.usedBytes=o,o;if(f.usedBytes===0&&c===0)return f.contents=n.slice(a,a+o),f.usedBytes=o,o;if(c+o<=f.usedBytes)return f.contents.set(n.subarray(a,a+o),c),o}if(R.expandFileStorage(f,c+o),f.contents.subarray&&n.subarray)f.contents.set(n.subarray(a,a+o),c);else for(var _=0;_<o;_++)f.contents[c+_]=n[a+_];return f.usedBytes=Math.max(f.usedBytes,c+o),o},llseek(e,n,a){var o=n;if(a===1?o+=e.position:a===2&&s.isFile(e.node.mode)&&(o+=e.node.usedBytes),o<0)throw new s.ErrnoError(28);return o},allocate(e,n,a){R.expandFileStorage(e.node,n+a),e.node.usedBytes=Math.max(e.node.usedBytes,n+a)},mmap(e,n,a,o,c){if(!s.isFile(e.node.mode))throw new s.ErrnoError(43);var d,f,_=e.node.contents;if(!(c&2)&&_.buffer===Ee.buffer)f=!1,d=_.byteOffset;else{if((a>0||a+n<_.length)&&(_.subarray?_=_.subarray(a,a+n):_=Array.prototype.slice.call(_,a,a+n)),f=!0,d=Dt(),!d)throw new s.ErrnoError(48);Ee.set(_,d)}return{ptr:d,allocated:f}},msync(e,n,a,o,c){return R.stream_ops.write(e,n,0,o,a,!1),0}}},ca=(e,n,a,o)=>{var c=o?"":Tt(`al ${e}`);pr(e,d=>{E(d,`Loading data file "${e}" failed (no arrayBuffer).`),n(new Uint8Array(d)),c&&_r(c)},d=>{if(a)a();else throw`Loading data file "${e}" failed.`}),c&&Hr(c)},da=(e,n,a,o,c,d)=>{s.createDataFile(e,n,a,o,c,d)},ma=[],fa=(e,n,a,o)=>{typeof Browser<"u"&&Browser.init();var c=!1;return ma.forEach(d=>{c||d.canHandle(n)&&(d.handle(e,n,a,o),c=!0)}),c},pa=(e,n,a,o,c,d,f,_,b,P)=>{var N=n?Re.resolve(ne.join2(e,n)):e,O=Tt(`cp ${N}`);function T(S){function A(ce){P?.(),_||da(e,n,ce,o,c,b),d?.(),_r(O)}fa(S,N,A,()=>{f?.(),_r(O)})||A(S)}Hr(O),typeof a=="string"?ca(a,T,f):T(a)},_a=e=>{var n={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},a=n[e];if(typeof a>"u")throw new Error(`Unknown file open mode: ${e}`);return a},Gr=(e,n)=>{var a=0;return e&&(a|=365),n&&(a|=146),a},ha={0:"Success",1:"Arg list too long",2:"Permission denied",3:"Address already in use",4:"Address not available",5:"Address family not supported by protocol family",6:"No more processes",7:"Socket already connected",8:"Bad file number",9:"Trying to read unreadable message",10:"Mount device busy",11:"Operation canceled",12:"No children",13:"Connection aborted",14:"Connection refused",15:"Connection reset by peer",16:"File locking deadlock error",17:"Destination address required",18:"Math arg out of domain of func",19:"Quota exceeded",20:"File exists",21:"Bad address",22:"File too large",23:"Host is unreachable",24:"Identifier removed",25:"Illegal byte sequence",26:"Connection already in progress",27:"Interrupted system call",28:"Invalid argument",29:"I/O error",30:"Socket is already connected",31:"Is a directory",32:"Too many symbolic links",33:"Too many open files",34:"Too many links",35:"Message too long",36:"Multihop attempted",37:"File or path name too long",38:"Network interface is not configured",39:"Connection reset by network",40:"Network is unreachable",41:"Too many open files in system",42:"No buffer space available",43:"No such device",44:"No such file or directory",45:"Exec format error",46:"No record locks available",47:"The link has been severed",48:"Not enough core",49:"No message of desired type",50:"Protocol not available",51:"No space left on device",52:"Function not implemented",53:"Socket is not connected",54:"Not a directory",55:"Directory not empty",56:"State not recoverable",57:"Socket operation on non-socket",59:"Not a typewriter",60:"No such device or address",61:"Value too large for defined data type",62:"Previous owner died",63:"Not super-user",64:"Broken pipe",65:"Protocol error",66:"Unknown protocol",67:"Protocol wrong type for socket",68:"Math result not representable",69:"Read only file system",70:"Illegal seek",71:"No such process",72:"Stale file handle",73:"Connection timed out",74:"Text file busy",75:"Cross-device link",100:"Device not a stream",101:"Bad font file fmt",102:"Invalid slot",103:"Invalid request code",104:"No anode",105:"Block device required",106:"Channel number out of range",107:"Level 3 halted",108:"Level 3 reset",109:"Link number out of range",110:"Protocol driver not attached",111:"No CSI structure available",112:"Level 2 halted",113:"Invalid exchange",114:"Invalid request descriptor",115:"Exchange full",116:"No data (for no delay io)",117:"Timer expired",118:"Out of streams resources",119:"Machine is not on the network",120:"Package not installed",121:"The object is remote",122:"Advertise error",123:"Srmount error",124:"Communication error on send",125:"Cross mount point (not really error)",126:"Given log. name not unique",127:"f.d. invalid for this operation",128:"Remote address changed",129:"Can   access a needed shared lib",130:"Accessing a corrupted shared lib",131:".lib section in a.out corrupted",132:"Attempting to link in too many libs",133:"Attempting to exec a shared library",135:"Streams pipe error",136:"Too many users",137:"Socket type not supported",138:"Not supported",139:"Protocol family not supported",140:"Can't send after socket shutdown",141:"Too many references",142:"Host is down",148:"No medium (in tape drive)",156:"Level 2 not synchronized"},Ct={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},s={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{constructor(e){super(ha[e]),this.name="ErrnoError",this.errno=e;for(var n in Ct)if(Ct[n]===e){this.code=n;break}}},genericErrors:{},filesystems:null,syncFSRequests:0,FSStream:class{constructor(){this.shared={}}get object(){return this.node}set object(e){this.node=e}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{constructor(e,n,a,o){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=s.nextInode++,this.name=n,this.mode=a,this.node_ops={},this.stream_ops={},this.rdev=o,this.readMode=365,this.writeMode=146}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return s.isDir(this.mode)}get isDevice(){return s.isChrdev(this.mode)}},lookupPath(e,n={}){if(e=Re.resolve(e),!e)return{path:"",node:null};var a={follow_mount:!0,recurse_count:0};if(n=Object.assign(a,n),n.recurse_count>8)throw new s.ErrnoError(32);for(var o=e.split("/").filter(O=>!!O),c=s.root,d="/",f=0;f<o.length;f++){var _=f===o.length-1;if(_&&n.parent)break;if(c=s.lookupNode(c,o[f]),d=ne.join2(d,o[f]),s.isMountpoint(c)&&(!_||_&&n.follow_mount)&&(c=c.mounted.root),!_||n.follow)for(var b=0;s.isLink(c.mode);){var P=s.readlink(d);d=Re.resolve(ne.dirname(d),P);var N=s.lookupPath(d,{recurse_count:n.recurse_count+1});if(c=N.node,b++>40)throw new s.ErrnoError(32)}}return{path:d,node:c}},getPath(e){for(var n;;){if(s.isRoot(e)){var a=e.mount.mountpoint;return n?a[a.length-1]!=="/"?`${a}/${n}`:a+n:a}n=n?`${e.name}/${n}`:e.name,e=e.parent}},hashName(e,n){for(var a=0,o=0;o<n.length;o++)a=(a<<5)-a+n.charCodeAt(o)|0;return(e+a>>>0)%s.nameTable.length},hashAddNode(e){var n=s.hashName(e.parent.id,e.name);e.name_next=s.nameTable[n],s.nameTable[n]=e},hashRemoveNode(e){var n=s.hashName(e.parent.id,e.name);if(s.nameTable[n]===e)s.nameTable[n]=e.name_next;else for(var a=s.nameTable[n];a;){if(a.name_next===e){a.name_next=e.name_next;break}a=a.name_next}},lookupNode(e,n){var a=s.mayLookup(e);if(a)throw new s.ErrnoError(a);for(var o=s.hashName(e.id,n),c=s.nameTable[o];c;c=c.name_next){var d=c.name;if(c.parent.id===e.id&&d===n)return c}return s.lookup(e,n)},createNode(e,n,a,o){E(typeof e=="object");var c=new s.FSNode(e,n,a,o);return s.hashAddNode(c),c},destroyNode(e){s.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var n=["r","w","rw"][e&3];return e&512&&(n+="w"),n},nodePermissions(e,n){return s.ignorePermissions?0:n.includes("r")&&!(e.mode&292)||n.includes("w")&&!(e.mode&146)||n.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!s.isDir(e.mode))return 54;var n=s.nodePermissions(e,"x");return n||(e.node_ops.lookup?0:2)},mayCreate(e,n){try{var a=s.lookupNode(e,n);return 20}catch{}return s.nodePermissions(e,"wx")},mayDelete(e,n,a){var o;try{o=s.lookupNode(e,n)}catch(d){return d.errno}var c=s.nodePermissions(e,"wx");if(c)return c;if(a){if(!s.isDir(o.mode))return 54;if(s.isRoot(o)||s.getPath(o)===s.cwd())return 10}else if(s.isDir(o.mode))return 31;return 0},mayOpen(e,n){return e?s.isLink(e.mode)?32:s.isDir(e.mode)&&(s.flagsToPermissionString(n)!=="r"||n&512)?31:s.nodePermissions(e,s.flagsToPermissionString(n)):44},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=s.MAX_OPEN_FDS;e++)if(!s.streams[e])return e;throw new s.ErrnoError(33)},getStreamChecked(e){var n=s.getStream(e);if(!n)throw new s.ErrnoError(8);return n},getStream:e=>s.streams[e],createStream(e,n=-1){return e=Object.assign(new s.FSStream,e),n==-1&&(n=s.nextfd()),e.fd=n,s.streams[n]=e,e},closeStream(e){s.streams[e]=null},dupStream(e,n=-1){var a=s.createStream(e,n);return a.stream_ops?.dup?.(a),a},chrdev_stream_ops:{open(e){var n=s.getDevice(e.node.rdev);e.stream_ops=n.stream_ops,e.stream_ops.open?.(e)},llseek(){throw new s.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,n)=>e<<8|n,registerDevice(e,n){s.devices[e]={stream_ops:n}},getDevice:e=>s.devices[e],getMounts(e){for(var n=[],a=[e];a.length;){var o=a.pop();n.push(o),a.push(...o.mounts)}return n},syncfs(e,n){typeof e=="function"&&(n=e,e=!1),s.syncFSRequests++,s.syncFSRequests>1&&_e(`warning: ${s.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var a=s.getMounts(s.root.mount),o=0;function c(f){return E(s.syncFSRequests>0),s.syncFSRequests--,n(f)}function d(f){if(f)return d.errored?void 0:(d.errored=!0,c(f));++o>=a.length&&c(null)}a.forEach(f=>{if(!f.type.syncfs)return d(null);f.type.syncfs(f,e,d)})},mount(e,n,a){if(typeof e=="string")throw e;var o=a==="/",c=!a,d;if(o&&s.root)throw new s.ErrnoError(10);if(!o&&!c){var f=s.lookupPath(a,{follow_mount:!1});if(a=f.path,d=f.node,s.isMountpoint(d))throw new s.ErrnoError(10);if(!s.isDir(d.mode))throw new s.ErrnoError(54)}var _={type:e,opts:n,mountpoint:a,mounts:[]},b=e.mount(_);return b.mount=_,_.root=b,o?s.root=b:d&&(d.mounted=_,d.mount&&d.mount.mounts.push(_)),b},unmount(e){var n=s.lookupPath(e,{follow_mount:!1});if(!s.isMountpoint(n.node))throw new s.ErrnoError(28);var a=n.node,o=a.mounted,c=s.getMounts(o);Object.keys(s.nameTable).forEach(f=>{for(var _=s.nameTable[f];_;){var b=_.name_next;c.includes(_.mount)&&s.destroyNode(_),_=b}}),a.mounted=null;var d=a.mount.mounts.indexOf(o);E(d!==-1),a.mount.mounts.splice(d,1)},lookup(e,n){return e.node_ops.lookup(e,n)},mknod(e,n,a){var o=s.lookupPath(e,{parent:!0}),c=o.node,d=ne.basename(e);if(!d||d==="."||d==="..")throw new s.ErrnoError(28);var f=s.mayCreate(c,d);if(f)throw new s.ErrnoError(f);if(!c.node_ops.mknod)throw new s.ErrnoError(63);return c.node_ops.mknod(c,d,n,a)},create(e,n){return n=n!==void 0?n:438,n&=4095,n|=32768,s.mknod(e,n,0)},mkdir(e,n){return n=n!==void 0?n:511,n&=1023,n|=16384,s.mknod(e,n,0)},mkdirTree(e,n){for(var a=e.split("/"),o="",c=0;c<a.length;++c)if(a[c]){o+="/"+a[c];try{s.mkdir(o,n)}catch(d){if(d.errno!=20)throw d}}},mkdev(e,n,a){return typeof a>"u"&&(a=n,n=438),n|=8192,s.mknod(e,n,a)},symlink(e,n){if(!Re.resolve(e))throw new s.ErrnoError(44);var a=s.lookupPath(n,{parent:!0}),o=a.node;if(!o)throw new s.ErrnoError(44);var c=ne.basename(n),d=s.mayCreate(o,c);if(d)throw new s.ErrnoError(d);if(!o.node_ops.symlink)throw new s.ErrnoError(63);return o.node_ops.symlink(o,c,e)},rename(e,n){var a=ne.dirname(e),o=ne.dirname(n),c=ne.basename(e),d=ne.basename(n),f,_,b;if(f=s.lookupPath(e,{parent:!0}),_=f.node,f=s.lookupPath(n,{parent:!0}),b=f.node,!_||!b)throw new s.ErrnoError(44);if(_.mount!==b.mount)throw new s.ErrnoError(75);var P=s.lookupNode(_,c),N=Re.relative(e,o);if(N.charAt(0)!==".")throw new s.ErrnoError(28);if(N=Re.relative(n,a),N.charAt(0)!==".")throw new s.ErrnoError(55);var O;try{O=s.lookupNode(b,d)}catch{}if(P!==O){var T=s.isDir(P.mode),S=s.mayDelete(_,c,T);if(S)throw new s.ErrnoError(S);if(S=O?s.mayDelete(b,d,T):s.mayCreate(b,d),S)throw new s.ErrnoError(S);if(!_.node_ops.rename)throw new s.ErrnoError(63);if(s.isMountpoint(P)||O&&s.isMountpoint(O))throw new s.ErrnoError(10);if(b!==_&&(S=s.nodePermissions(_,"w"),S))throw new s.ErrnoError(S);s.hashRemoveNode(P);try{_.node_ops.rename(P,b,d)}catch(A){throw A}finally{s.hashAddNode(P)}}},rmdir(e){var n=s.lookupPath(e,{parent:!0}),a=n.node,o=ne.basename(e),c=s.lookupNode(a,o),d=s.mayDelete(a,o,!0);if(d)throw new s.ErrnoError(d);if(!a.node_ops.rmdir)throw new s.ErrnoError(63);if(s.isMountpoint(c))throw new s.ErrnoError(10);a.node_ops.rmdir(a,o),s.destroyNode(c)},readdir(e){var n=s.lookupPath(e,{follow:!0}),a=n.node;if(!a.node_ops.readdir)throw new s.ErrnoError(54);return a.node_ops.readdir(a)},unlink(e){var n=s.lookupPath(e,{parent:!0}),a=n.node;if(!a)throw new s.ErrnoError(44);var o=ne.basename(e),c=s.lookupNode(a,o),d=s.mayDelete(a,o,!1);if(d)throw new s.ErrnoError(d);if(!a.node_ops.unlink)throw new s.ErrnoError(63);if(s.isMountpoint(c))throw new s.ErrnoError(10);a.node_ops.unlink(a,o),s.destroyNode(c)},readlink(e){var n=s.lookupPath(e),a=n.node;if(!a)throw new s.ErrnoError(44);if(!a.node_ops.readlink)throw new s.ErrnoError(28);return Re.resolve(s.getPath(a.parent),a.node_ops.readlink(a))},stat(e,n){var a=s.lookupPath(e,{follow:!n}),o=a.node;if(!o)throw new s.ErrnoError(44);if(!o.node_ops.getattr)throw new s.ErrnoError(63);return o.node_ops.getattr(o)},lstat(e){return s.stat(e,!0)},chmod(e,n,a){var o;if(typeof e=="string"){var c=s.lookupPath(e,{follow:!a});o=c.node}else o=e;if(!o.node_ops.setattr)throw new s.ErrnoError(63);o.node_ops.setattr(o,{mode:n&4095|o.mode&-4096,timestamp:Date.now()})},lchmod(e,n){s.chmod(e,n,!0)},fchmod(e,n){var a=s.getStreamChecked(e);s.chmod(a.node,n)},chown(e,n,a,o){var c;if(typeof e=="string"){var d=s.lookupPath(e,{follow:!o});c=d.node}else c=e;if(!c.node_ops.setattr)throw new s.ErrnoError(63);c.node_ops.setattr(c,{timestamp:Date.now()})},lchown(e,n,a){s.chown(e,n,a,!0)},fchown(e,n,a){var o=s.getStreamChecked(e);s.chown(o.node,n,a)},truncate(e,n){if(n<0)throw new s.ErrnoError(28);var a;if(typeof e=="string"){var o=s.lookupPath(e,{follow:!0});a=o.node}else a=e;if(!a.node_ops.setattr)throw new s.ErrnoError(63);if(s.isDir(a.mode))throw new s.ErrnoError(31);if(!s.isFile(a.mode))throw new s.ErrnoError(28);var c=s.nodePermissions(a,"w");if(c)throw new s.ErrnoError(c);a.node_ops.setattr(a,{size:n,timestamp:Date.now()})},ftruncate(e,n){var a=s.getStreamChecked(e);if((a.flags&2097155)===0)throw new s.ErrnoError(28);s.truncate(a.node,n)},utime(e,n,a){var o=s.lookupPath(e,{follow:!0}),c=o.node;c.node_ops.setattr(c,{timestamp:Math.max(n,a)})},open(e,n,a){if(e==="")throw new s.ErrnoError(44);n=typeof n=="string"?_a(n):n,n&64?(a=typeof a>"u"?438:a,a=a&4095|32768):a=0;var o;if(typeof e=="object")o=e;else{e=ne.normalize(e);try{var c=s.lookupPath(e,{follow:!(n&131072)});o=c.node}catch{}}var d=!1;if(n&64)if(o){if(n&128)throw new s.ErrnoError(20)}else o=s.mknod(e,a,0),d=!0;if(!o)throw new s.ErrnoError(44);if(s.isChrdev(o.mode)&&(n&=-513),n&65536&&!s.isDir(o.mode))throw new s.ErrnoError(54);if(!d){var f=s.mayOpen(o,n);if(f)throw new s.ErrnoError(f)}n&512&&!d&&s.truncate(o,0),n&=-131713;var _=s.createStream({node:o,path:s.getPath(o),flags:n,seekable:!0,position:0,stream_ops:o.stream_ops,ungotten:[],error:!1});return _.stream_ops.open&&_.stream_ops.open(_),t.logReadFiles&&!(n&1)&&(s.readFiles||(s.readFiles={}),e in s.readFiles||(s.readFiles[e]=1)),_},close(e){if(s.isClosed(e))throw new s.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(n){throw n}finally{s.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,n,a){if(s.isClosed(e))throw new s.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new s.ErrnoError(70);if(a!=0&&a!=1&&a!=2)throw new s.ErrnoError(28);return e.position=e.stream_ops.llseek(e,n,a),e.ungotten=[],e.position},read(e,n,a,o,c){if(E(a>=0),o<0||c<0)throw new s.ErrnoError(28);if(s.isClosed(e))throw new s.ErrnoError(8);if((e.flags&2097155)===1)throw new s.ErrnoError(8);if(s.isDir(e.node.mode))throw new s.ErrnoError(31);if(!e.stream_ops.read)throw new s.ErrnoError(28);var d=typeof c<"u";if(!d)c=e.position;else if(!e.seekable)throw new s.ErrnoError(70);var f=e.stream_ops.read(e,n,a,o,c);return d||(e.position+=f),f},write(e,n,a,o,c,d){if(E(a>=0),o<0||c<0)throw new s.ErrnoError(28);if(s.isClosed(e))throw new s.ErrnoError(8);if((e.flags&2097155)===0)throw new s.ErrnoError(8);if(s.isDir(e.node.mode))throw new s.ErrnoError(31);if(!e.stream_ops.write)throw new s.ErrnoError(28);e.seekable&&e.flags&1024&&s.llseek(e,0,2);var f=typeof c<"u";if(!f)c=e.position;else if(!e.seekable)throw new s.ErrnoError(70);var _=e.stream_ops.write(e,n,a,o,c,d);return f||(e.position+=_),_},allocate(e,n,a){if(s.isClosed(e))throw new s.ErrnoError(8);if(n<0||a<=0)throw new s.ErrnoError(28);if((e.flags&2097155)===0)throw new s.ErrnoError(8);if(!s.isFile(e.node.mode)&&!s.isDir(e.node.mode))throw new s.ErrnoError(43);if(!e.stream_ops.allocate)throw new s.ErrnoError(138);e.stream_ops.allocate(e,n,a)},mmap(e,n,a,o,c){if((o&2)!==0&&(c&2)===0&&(e.flags&2097155)!==2)throw new s.ErrnoError(2);if((e.flags&2097155)===1)throw new s.ErrnoError(2);if(!e.stream_ops.mmap)throw new s.ErrnoError(43);return e.stream_ops.mmap(e,n,a,o,c)},msync(e,n,a,o,c){return E(a>=0),e.stream_ops.msync?e.stream_ops.msync(e,n,a,o,c):0},ioctl(e,n,a){if(!e.stream_ops.ioctl)throw new s.ErrnoError(59);return e.stream_ops.ioctl(e,n,a)},readFile(e,n={}){if(n.flags=n.flags||0,n.encoding=n.encoding||"binary",n.encoding!=="utf8"&&n.encoding!=="binary")throw new Error(`Invalid encoding type "${n.encoding}"`);var a,o=s.open(e,n.flags),c=s.stat(e),d=c.size,f=new Uint8Array(d);return s.read(o,f,0,d,0),n.encoding==="utf8"?a=Ze(f,0):n.encoding==="binary"&&(a=f),s.close(o),a},writeFile(e,n,a={}){a.flags=a.flags||577;var o=s.open(e,a.flags,a.mode);if(typeof n=="string"){var c=new Uint8Array(Ue(n)+1),d=Kr(n,c,0,c.length);s.write(o,c,0,d,void 0,a.canOwn)}else if(ArrayBuffer.isView(n))s.write(o,n,0,n.byteLength,void 0,a.canOwn);else throw new Error("Unsupported data type");s.close(o)},cwd:()=>s.currentPath,chdir(e){var n=s.lookupPath(e,{follow:!0});if(n.node===null)throw new s.ErrnoError(44);if(!s.isDir(n.node.mode))throw new s.ErrnoError(54);var a=s.nodePermissions(n.node,"x");if(a)throw new s.ErrnoError(a);s.currentPath=n.path},createDefaultDirectories(){s.mkdir("/tmp"),s.mkdir("/home"),s.mkdir("/home/web_user")},createDefaultDevices(){s.mkdir("/dev"),s.registerDevice(s.makedev(1,3),{read:()=>0,write:(o,c,d,f,_)=>f}),s.mkdev("/dev/null",s.makedev(1,3)),Be.register(s.makedev(5,0),Be.default_tty_ops),Be.register(s.makedev(6,0),Be.default_tty1_ops),s.mkdev("/dev/tty",s.makedev(5,0)),s.mkdev("/dev/tty1",s.makedev(6,0));var e=new Uint8Array(1024),n=0,a=()=>(n===0&&(n=Ot(e).byteLength),e[--n]);s.createDevice("/dev","random",a),s.createDevice("/dev","urandom",a),s.mkdir("/dev/shm"),s.mkdir("/dev/shm/tmp")},createSpecialDirectories(){s.mkdir("/proc");var e=s.mkdir("/proc/self");s.mkdir("/proc/self/fd"),s.mount({mount(){var n=s.createNode(e,"fd",16895,73);return n.node_ops={lookup(a,o){var c=+o,d=s.getStreamChecked(c),f={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>d.path}};return f.parent=f,f}},n}},{},"/proc/self/fd")},createStandardStreams(){t.stdin?s.createDevice("/dev","stdin",t.stdin):s.symlink("/dev/tty","/dev/stdin"),t.stdout?s.createDevice("/dev","stdout",null,t.stdout):s.symlink("/dev/tty","/dev/stdout"),t.stderr?s.createDevice("/dev","stderr",null,t.stderr):s.symlink("/dev/tty1","/dev/stderr");var e=s.open("/dev/stdin",0),n=s.open("/dev/stdout",1),a=s.open("/dev/stderr",1);E(e.fd===0,`invalid handle for stdin (${e.fd})`),E(n.fd===1,`invalid handle for stdout (${n.fd})`),E(a.fd===2,`invalid handle for stderr (${a.fd})`)},staticInit(){[44].forEach(e=>{s.genericErrors[e]=new s.ErrnoError(e),s.genericErrors[e].stack="<generic error, no stack>"}),s.nameTable=new Array(4096),s.mount(R,{},"/"),s.createDefaultDirectories(),s.createDefaultDevices(),s.createSpecialDirectories(),s.filesystems={MEMFS:R}},init(e,n,a){E(!s.init.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),s.init.initialized=!0,t.stdin=e||t.stdin,t.stdout=n||t.stdout,t.stderr=a||t.stderr,s.createStandardStreams()},quit(){s.init.initialized=!1,Wt(0);for(var e=0;e<s.streams.length;e++){var n=s.streams[e];n&&s.close(n)}},findObject(e,n){var a=s.analyzePath(e,n);return a.exists?a.object:null},analyzePath(e,n){try{var a=s.lookupPath(e,{follow:!n});e=a.path}catch{}var o={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var a=s.lookupPath(e,{parent:!0});o.parentExists=!0,o.parentPath=a.path,o.parentObject=a.node,o.name=ne.basename(e),a=s.lookupPath(e,{follow:!n}),o.exists=!0,o.path=a.path,o.object=a.node,o.name=a.node.name,o.isRoot=a.path==="/"}catch(c){o.error=c.errno}return o},createPath(e,n,a,o){e=typeof e=="string"?e:s.getPath(e);for(var c=n.split("/").reverse();c.length;){var d=c.pop();if(d){var f=ne.join2(e,d);try{s.mkdir(f)}catch{}e=f}}return f},createFile(e,n,a,o,c){var d=ne.join2(typeof e=="string"?e:s.getPath(e),n),f=Gr(o,c);return s.create(d,f)},createDataFile(e,n,a,o,c,d){var f=n;e&&(e=typeof e=="string"?e:s.getPath(e),f=n?ne.join2(e,n):e);var _=Gr(o,c),b=s.create(f,_);if(a){if(typeof a=="string"){for(var P=new Array(a.length),N=0,O=a.length;N<O;++N)P[N]=a.charCodeAt(N);a=P}s.chmod(b,_|146);var T=s.open(b,577);s.write(T,a,0,a.length,0,d),s.close(T),s.chmod(b,_)}},createDevice(e,n,a,o){var c=ne.join2(typeof e=="string"?e:s.getPath(e),n),d=Gr(!!a,!!o);s.createDevice.major||(s.createDevice.major=64);var f=s.makedev(s.createDevice.major++,0);return s.registerDevice(f,{open(_){_.seekable=!1},close(_){o?.buffer?.length&&o(10)},read(_,b,P,N,O){for(var T=0,S=0;S<N;S++){var A;try{A=a()}catch{throw new s.ErrnoError(29)}if(A===void 0&&T===0)throw new s.ErrnoError(6);if(A==null)break;T++,b[P+S]=A}return T&&(_.node.timestamp=Date.now()),T},write(_,b,P,N,O){for(var T=0;T<N;T++)try{o(b[P+T])}catch{throw new s.ErrnoError(29)}return N&&(_.node.timestamp=Date.now()),T}}),s.mkdev(c,d,f)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(Dr)try{e.contents=hr(Dr(e.url),!0),e.usedBytes=e.contents.length}catch{throw new s.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(e,n,a,o,c){class d{constructor(){this.lengthKnown=!1,this.chunks=[]}get(S){if(!(S>this.length-1||S<0)){var A=S%this.chunkSize,ce=S/this.chunkSize|0;return this.getter(ce)[A]}}setDataGetter(S){this.getter=S}cacheLength(){var S=new XMLHttpRequest;if(S.open("HEAD",a,!1),S.send(null),!(S.status>=200&&S.status<300||S.status===304))throw new Error("Couldn't load "+a+". Status: "+S.status);var A=Number(S.getResponseHeader("Content-length")),ce,Te=(ce=S.getResponseHeader("Accept-Ranges"))&&ce==="bytes",be=(ce=S.getResponseHeader("Content-Encoding"))&&ce==="gzip",g=1024*1024;Te||(g=A);var x=(se,Le)=>{if(se>Le)throw new Error("invalid range ("+se+", "+Le+") or no bytes requested!");if(Le>A-1)throw new Error("only "+A+" bytes available! programmer error!");var he=new XMLHttpRequest;if(he.open("GET",a,!1),A!==g&&he.setRequestHeader("Range","bytes="+se+"-"+Le),he.responseType="arraybuffer",he.overrideMimeType&&he.overrideMimeType("text/plain; charset=x-user-defined"),he.send(null),!(he.status>=200&&he.status<300||he.status===304))throw new Error("Couldn't load "+a+". Status: "+he.status);return he.response!==void 0?new Uint8Array(he.response||[]):hr(he.responseText||"",!0)},ge=this;ge.setDataGetter(se=>{var Le=se*g,he=(se+1)*g-1;if(he=Math.min(he,A-1),typeof ge.chunks[se]>"u"&&(ge.chunks[se]=x(Le,he)),typeof ge.chunks[se]>"u")throw new Error("doXHR failed!");return ge.chunks[se]}),(be||!A)&&(g=A=1,A=this.getter(0).length,g=A,Ge("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=A,this._chunkSize=g,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!w)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var f=new d,_={isDevice:!1,contents:f}}else var _={isDevice:!1,url:a};var b=s.createFile(e,n,_,o,c);_.contents?b.contents=_.contents:_.url&&(b.contents=null,b.url=_.url),Object.defineProperties(b,{usedBytes:{get:function(){return this.contents.length}}});var P={},N=Object.keys(b.stream_ops);N.forEach(T=>{var S=b.stream_ops[T];P[T]=(...A)=>(s.forceLoadFile(b),S(...A))});function O(T,S,A,ce,Te){var be=T.node.contents;if(Te>=be.length)return 0;var g=Math.min(be.length-Te,ce);if(E(g>=0),be.slice)for(var x=0;x<g;x++)S[A+x]=be[Te+x];else for(var x=0;x<g;x++)S[A+x]=be.get(Te+x);return g}return P.read=(T,S,A,ce,Te)=>(s.forceLoadFile(b),O(T,S,A,ce,Te)),P.mmap=(T,S,A,ce,Te)=>{s.forceLoadFile(b);var be=Dt();if(!be)throw new s.ErrnoError(48);return O(T,Ee,be,S,A),{ptr:be,allocated:!0}},b.stream_ops=P,b},absolutePath(){I("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){I("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){I("FS.createLink has been removed; use FS.symlink instead")},joinPath(){I("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){I("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){I("FS.standardizePath has been removed; use PATH.normalize instead")}},gr=(e,n)=>(E(typeof e=="number",`UTF8ToString expects a number (got ${typeof e})`),e?Ze(tr,e,n):""),oe={DEFAULT_POLLMASK:5,calculateAt(e,n,a){if(ne.isAbs(n))return n;var o;if(e===-100)o=s.cwd();else{var c=oe.getStreamFromFD(e);o=c.path}if(n.length==0){if(!a)throw new s.ErrnoError(44);return o}return ne.join2(o,n)},doStat(e,n,a){var o=e(n);v((a>>2)*4,o.dev,4),v((a+4>>2)*4,o.mode,4),v((a+8>>2)*4,o.nlink,4),v((a+12>>2)*4,o.uid,4),v((a+16>>2)*4,o.gid,4),v((a+20>>2)*4,o.rdev,4),Se[a+24>>3]=BigInt(o.size),v((a+32>>2)*4,4096,4),v((a+36>>2)*4,o.blocks,4);var c=o.atime.getTime(),d=o.mtime.getTime(),f=o.ctime.getTime();return Se[a+40>>3]=BigInt(Math.floor(c/1e3)),v((a+48>>2)*4,c%1e3*1e3,4),Se[a+56>>3]=BigInt(Math.floor(d/1e3)),v((a+64>>2)*4,d%1e3*1e3,4),Se[a+72>>3]=BigInt(Math.floor(f/1e3)),v((a+80>>2)*4,f%1e3*1e3,4),Se[a+88>>3]=BigInt(o.ino),0},doMsync(e,n,a,o,c){if(!s.isFile(n.node.mode))throw new s.ErrnoError(43);if(o&2)return 0;var d=tr.slice(e,e+a);s.msync(n,d,c,a,o)},getStreamFromFD(e){var n=s.getStreamChecked(e);return n},varargs:void 0,getStr(e){var n=gr(e);return n}};function ga(e,n,a){try{var o=oe.getStreamFromFD(e);if(E(!a),o.fd===n)return-28;var c=s.getStream(n);return c&&s.close(c),s.dupStream(o,n).fd}catch(d){if(typeof s>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}function br(){E(oe.varargs!=null);var e=C((+oe.varargs>>2)*4,4,0);return oe.varargs+=4,e}var Qe=br;function ba(e,n,a){oe.varargs=a;try{var o=oe.getStreamFromFD(e);switch(n){case 0:{var c=br();if(c<0)return-28;for(;s.streams[c];)c++;var d;return d=s.dupStream(o,c),d.fd}case 1:case 2:return 0;case 3:return o.flags;case 4:{var c=br();return o.flags|=c,0}case 12:{var c=Qe(),f=0;return v((c+f>>1)*2,2,2),0}case 13:case 14:return 0}return-28}catch(_){if(typeof s>"u"||_.name!=="ErrnoError")throw _;return-_.errno}}function ya(e,n,a){oe.varargs=a;try{var o=oe.getStreamFromFD(e);switch(n){case 21509:return o.tty?0:-59;case 21505:{if(!o.tty)return-59;if(o.tty.ops.ioctl_tcgets){var c=o.tty.ops.ioctl_tcgets(o),d=Qe();v((d>>2)*4,c.c_iflag||0,4),v((d+4>>2)*4,c.c_oflag||0,4),v((d+8>>2)*4,c.c_cflag||0,4),v((d+12>>2)*4,c.c_lflag||0,4);for(var f=0;f<32;f++)v(d+f+17,c.c_cc[f]||0,1);return 0}return 0}case 21510:case 21511:case 21512:return o.tty?0:-59;case 21506:case 21507:case 21508:{if(!o.tty)return-59;if(o.tty.ops.ioctl_tcsets){for(var d=Qe(),_=C((d>>2)*4,4,0),b=C((d+4>>2)*4,4,0),P=C((d+8>>2)*4,4,0),N=C((d+12>>2)*4,4,0),O=[],f=0;f<32;f++)O.push(C(d+f+17,1,0));return o.tty.ops.ioctl_tcsets(o.tty,n,{c_iflag:_,c_oflag:b,c_cflag:P,c_lflag:N,c_cc:O})}return 0}case 21519:{if(!o.tty)return-59;var d=Qe();return v((d>>2)*4,0,4),0}case 21520:return o.tty?-28:-59;case 21531:{var d=Qe();return s.ioctl(o,n,d)}case 21523:{if(!o.tty)return-59;if(o.tty.ops.ioctl_tiocgwinsz){var T=o.tty.ops.ioctl_tiocgwinsz(o.tty),d=Qe();v((d>>1)*2,T[0],2),v((d+2>>1)*2,T[1],2)}return 0}case 21524:return o.tty?0:-59;case 21515:return o.tty?0:-59;default:return-28}}catch(S){if(typeof s>"u"||S.name!=="ErrnoError")throw S;return-S.errno}}function wa(e,n,a,o){oe.varargs=o;try{n=oe.getStr(n),n=oe.calculateAt(e,n);var c=o?br():0;return s.open(n,a,c).fd}catch(d){if(typeof s>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}var Ve=(e,n,a)=>(E(typeof a=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),Kr(e,tr,n,a));function va(e,n,a,o){try{if(n=oe.getStr(n),n=oe.calculateAt(e,n),o<=0)return-28;var c=s.readlink(n),d=Math.min(o,Ue(c)),f=C(a+d,1,0);return Ve(c,a,o+1),v(a+d,f,1),d}catch(_){if(typeof s>"u"||_.name!=="ErrnoError")throw _;return-_.errno}}function Ea(e,n,a,o){try{return n=oe.getStr(n),o=oe.getStr(o),n=oe.calculateAt(e,n),o=oe.calculateAt(a,o),s.rename(n,o),0}catch(c){if(typeof s>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function ka(e){try{return e=oe.getStr(e),s.rmdir(e),0}catch(n){if(typeof s>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function Ta(e,n,a){try{return n=oe.getStr(n),n=oe.calculateAt(e,n),a===0?s.unlink(n):a===512?s.rmdir(n):I("Invalid flags passed to unlinkat"),0}catch(o){if(typeof s>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}var xa=()=>{I("native code called abort()")},Sa=1,La=()=>Sa,Aa=e=>e?-52:0,Pa=()=>{throw 1/0},Fa=9007199254740992,Na=-9007199254740992,Xr=e=>e<Na||e>Fa?NaN:Number(e);function Ra(e,n){e=Xr(e);var a=new Date(e*1e3);v((n>>2)*4,a.getUTCSeconds(),4),v((n+4>>2)*4,a.getUTCMinutes(),4),v((n+8>>2)*4,a.getUTCHours(),4),v((n+12>>2)*4,a.getUTCDate(),4),v((n+16>>2)*4,a.getUTCMonth(),4),v((n+20>>2)*4,a.getUTCFullYear()-1900,4),v((n+24>>2)*4,a.getUTCDay(),4);var o=Date.UTC(a.getUTCFullYear(),0,1,0,0,0,0),c=(a.getTime()-o)/(1e3*60*60*24)|0;v((n+28>>2)*4,c,4)}var sr=e=>e%4===0&&(e%100!==0||e%400===0),Oa=[0,31,60,91,121,152,182,213,244,274,305,335],Ma=[0,31,59,90,120,151,181,212,243,273,304,334],It=e=>{var n=sr(e.getFullYear()),a=n?Oa:Ma,o=a[e.getMonth()]+e.getDate()-1;return o};function Da(e,n){e=Xr(e);var a=new Date(e*1e3);v((n>>2)*4,a.getSeconds(),4),v((n+4>>2)*4,a.getMinutes(),4),v((n+8>>2)*4,a.getHours(),4),v((n+12>>2)*4,a.getDate(),4),v((n+16>>2)*4,a.getMonth(),4),v((n+20>>2)*4,a.getFullYear()-1900,4),v((n+24>>2)*4,a.getDay(),4);var o=It(a)|0;v((n+28>>2)*4,o,4),v((n+36>>2)*4,-(a.getTimezoneOffset()*60),4);var c=new Date(a.getFullYear(),0,1),d=new Date(a.getFullYear(),6,1).getTimezoneOffset(),f=c.getTimezoneOffset(),_=(d!=f&&a.getTimezoneOffset()==Math.min(f,d))|0;v((n+32>>2)*4,_,4)}var Ca=function(e){var n=(()=>{var a=new Date(C((e+20>>2)*4,4,0)+1900,C((e+16>>2)*4,4,0),C((e+12>>2)*4,4,0),C((e+8>>2)*4,4,0),C((e+4>>2)*4,4,0),C((e>>2)*4,4,0),0),o=C((e+32>>2)*4,4,0),c=a.getTimezoneOffset(),d=new Date(a.getFullYear(),0,1),f=new Date(a.getFullYear(),6,1).getTimezoneOffset(),_=d.getTimezoneOffset(),b=Math.min(_,f);if(o<0)v((e+32>>2)*4,+(f!=_&&b==c),4);else if(o>0!=(b==c)){var P=Math.max(_,f),N=o>0?b:P;a.setTime(a.getTime()+(N-c)*6e4)}v((e+24>>2)*4,a.getDay(),4);var O=It(a)|0;v((e+28>>2)*4,O,4),v((e>>2)*4,a.getSeconds(),4),v((e+4>>2)*4,a.getMinutes(),4),v((e+8>>2)*4,a.getHours(),4),v((e+12>>2)*4,a.getDate(),4),v((e+16>>2)*4,a.getMonth(),4),v((e+20>>2)*4,a.getYear(),4);var T=a.getTime();return isNaN(T)?-1:T/1e3})();return BigInt(n)},Ia=(e,n,a,o)=>{var c=new Date().getFullYear(),d=new Date(c,0,1),f=new Date(c,6,1),_=d.getTimezoneOffset(),b=f.getTimezoneOffset(),P=Math.max(_,b);v((e>>2)*4,P*60,4),v((n>>2)*4,+(_!=b),4);var N=S=>S.toLocaleTimeString(void 0,{hour12:!1,timeZoneName:"short"}).split(" ")[1],O=N(d),T=N(f);E(O),E(T),E(Ue(O)<=16,`timezone name truncated to fit in TZNAME_MAX (${O})`),E(Ue(T)<=16,`timezone name truncated to fit in TZNAME_MAX (${T})`),b<_?(Ve(O,a,17),Ve(T,o,17)):(Ve(O,o,17),Ve(T,a,17))},Ua=()=>Date.now(),Ut;Ut=()=>performance.now();var Ba=()=>2147483648,Va=e=>{var n=Fe.buffer,a=(e-n.byteLength+65535)/65536;try{return Fe.grow(a),vt(),1}catch(o){_e(`growMemory: Attempted to grow heap from ${n.byteLength} bytes to ${e} bytes, but got error: ${o}`)}},$a=e=>{var n=tr.length;e>>>=0,E(e>n);var a=Ba();if(e>a)return _e(`Cannot enlarge memory, requested ${e} bytes, but the limit is ${a} bytes!`),!1;for(var o=(b,P)=>b+(P-b%P)%P,c=1;c<=4;c*=2){var d=n*(1+.2/c);d=Math.min(d,e+100663296);var f=Math.min(a,o(Math.max(e,d),65536)),_=Va(f);if(_)return!0}return _e(`Failed to grow the heap from ${n} bytes to ${f} bytes, not enough memory!`),!1},yr={},ja=()=>k||"./this.program",ir=()=>{if(!ir.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:ja()};for(var a in yr)yr[a]===void 0?delete n[a]:n[a]=yr[a];var o=[];for(var a in n)o.push(`${a}=${n[a]}`);ir.strings=o}return ir.strings},za=(e,n)=>{for(var a=0;a<e.length;++a)E(e.charCodeAt(a)===(e.charCodeAt(a)&255)),v(n++,e.charCodeAt(a),1);v(n,0,1)},Ha=(e,n)=>{var a=0;return ir().forEach((o,c)=>{var d=n+a;v((e+c*4>>2)*4,d,4),za(o,d),a+=o.length+1}),0},Wa=(e,n)=>{var a=ir();v((e>>2)*4,a.length,4);var o=0;return a.forEach(c=>o+=c.length+1),v((n>>2)*4,o,4),0},Ya=e=>{rr=!0,le(e,new ea(e))},qa=(e,n)=>{xo(),Ya(e)},Ka=qa;function Ga(e){try{var n=oe.getStreamFromFD(e);return s.close(n),0}catch(a){if(typeof s>"u"||a.name!=="ErrnoError")throw a;return a.errno}}var Xa=(e,n,a,o)=>{for(var c=0,d=0;d<a;d++){var f=C((n>>2)*4,4,1),_=C((n+4>>2)*4,4,1);n+=8;var b=s.read(e,Ee,f,_,o);if(b<0)return-1;if(c+=b,b<_)break;typeof o<"u"&&(o+=b)}return c};function Ja(e,n,a,o){try{var c=oe.getStreamFromFD(e),d=Xa(c,n,a);return v((o>>2)*4,d,4),0}catch(f){if(typeof s>"u"||f.name!=="ErrnoError")throw f;return f.errno}}function Za(e,n,a,o){n=Xr(n);try{if(isNaN(n))return 61;var c=oe.getStreamFromFD(e);return s.llseek(c,n,a),Se[o>>3]=BigInt(c.position),c.getdents&&n===0&&a===0&&(c.getdents=null),0}catch(d){if(typeof s>"u"||d.name!=="ErrnoError")throw d;return d.errno}}var Qa=(e,n,a,o)=>{for(var c=0,d=0;d<a;d++){var f=C((n>>2)*4,4,1),_=C((n+4>>2)*4,4,1);n+=8;var b=s.write(e,Ee,f,_,o);if(b<0)return-1;c+=b,typeof o<"u"&&(o+=b)}return c};function eo(e,n,a,o){try{var c=oe.getStreamFromFD(e),d=Qa(c,n,a);return v((o>>2)*4,d,4),0}catch(f){if(typeof s>"u"||f.name!=="ErrnoError")throw f;return f.errno}}var ro=(e,n)=>{for(var a=0,o=0;o<=n;a+=e[o++]);return a},Bt=[31,29,31,30,31,30,31,31,30,31,30,31],Vt=[31,28,31,30,31,30,31,31,30,31,30,31],to=(e,n)=>{for(var a=new Date(e.getTime());n>0;){var o=sr(a.getFullYear()),c=a.getMonth(),d=(o?Bt:Vt)[c];if(n>d-a.getDate())n-=d-a.getDate()+1,a.setDate(1),c<11?a.setMonth(c+1):(a.setMonth(0),a.setFullYear(a.getFullYear()+1));else return a.setDate(a.getDate()+n),a}return a},$t=(e,n)=>{E(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),Ee.set(e,n)},no=(e,n,a,o)=>{var c=C((o+40>>2)*4,4,1),d={tm_sec:C((o>>2)*4,4,0),tm_min:C((o+4>>2)*4,4,0),tm_hour:C((o+8>>2)*4,4,0),tm_mday:C((o+12>>2)*4,4,0),tm_mon:C((o+16>>2)*4,4,0),tm_year:C((o+20>>2)*4,4,0),tm_wday:C((o+24>>2)*4,4,0),tm_yday:C((o+28>>2)*4,4,0),tm_isdst:C((o+32>>2)*4,4,0),tm_gmtoff:C((o+36>>2)*4,4,0),tm_zone:c?gr(c):""},f=gr(a),_={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var b in _)f=f.replace(new RegExp(b,"g"),_[b]);var P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],N=["January","February","March","April","May","June","July","August","September","October","November","December"];function O(g,x,ge){for(var se=typeof g=="number"?g.toString():g||"";se.length<x;)se=ge[0]+se;return se}function T(g,x){return O(g,x,"0")}function S(g,x){function ge(Le){return Le<0?-1:Le>0?1:0}var se;return(se=ge(g.getFullYear()-x.getFullYear()))===0&&(se=ge(g.getMonth()-x.getMonth()))===0&&(se=ge(g.getDate()-x.getDate())),se}function A(g){switch(g.getDay()){case 0:return new Date(g.getFullYear()-1,11,29);case 1:return g;case 2:return new Date(g.getFullYear(),0,3);case 3:return new Date(g.getFullYear(),0,2);case 4:return new Date(g.getFullYear(),0,1);case 5:return new Date(g.getFullYear()-1,11,31);case 6:return new Date(g.getFullYear()-1,11,30)}}function ce(g){var x=to(new Date(g.tm_year+1900,0,1),g.tm_yday),ge=new Date(x.getFullYear(),0,4),se=new Date(x.getFullYear()+1,0,4),Le=A(ge),he=A(se);return S(Le,x)<=0?S(he,x)<=0?x.getFullYear()+1:x.getFullYear():x.getFullYear()-1}var Te={"%a":g=>P[g.tm_wday].substring(0,3),"%A":g=>P[g.tm_wday],"%b":g=>N[g.tm_mon].substring(0,3),"%B":g=>N[g.tm_mon],"%C":g=>{var x=g.tm_year+1900;return T(x/100|0,2)},"%d":g=>T(g.tm_mday,2),"%e":g=>O(g.tm_mday,2," "),"%g":g=>ce(g).toString().substring(2),"%G":ce,"%H":g=>T(g.tm_hour,2),"%I":g=>{var x=g.tm_hour;return x==0?x=12:x>12&&(x-=12),T(x,2)},"%j":g=>T(g.tm_mday+ro(sr(g.tm_year+1900)?Bt:Vt,g.tm_mon-1),3),"%m":g=>T(g.tm_mon+1,2),"%M":g=>T(g.tm_min,2),"%n":()=>`
`,"%p":g=>g.tm_hour>=0&&g.tm_hour<12?"AM":"PM","%S":g=>T(g.tm_sec,2),"%t":()=>"	","%u":g=>g.tm_wday||7,"%U":g=>{var x=g.tm_yday+7-g.tm_wday;return T(Math.floor(x/7),2)},"%V":g=>{var x=Math.floor((g.tm_yday+7-(g.tm_wday+6)%7)/7);if((g.tm_wday+371-g.tm_yday-2)%7<=2&&x++,x){if(x==53){var se=(g.tm_wday+371-g.tm_yday)%7;se!=4&&(se!=3||!sr(g.tm_year))&&(x=1)}}else{x=52;var ge=(g.tm_wday+7-g.tm_yday-1)%7;(ge==4||ge==5&&sr(g.tm_year%400-1))&&x++}return T(x,2)},"%w":g=>g.tm_wday,"%W":g=>{var x=g.tm_yday+7-(g.tm_wday+6)%7;return T(Math.floor(x/7),2)},"%y":g=>(g.tm_year+1900).toString().substring(2),"%Y":g=>g.tm_year+1900,"%z":g=>{var x=g.tm_gmtoff,ge=x>=0;return x=Math.abs(x)/60,x=x/60*100+x%60,(ge?"+":"-")+("0000"+x).slice(-4)},"%Z":g=>g.tm_zone,"%%":()=>"%"};f=f.replace(/%%/g,"\0\0");for(var b in Te)f.includes(b)&&(f=f.replace(new RegExp(b,"g"),Te[b](d)));f=f.replace(/\0\0/g,"%");var be=hr(f,!1);return be.length>n?0:($t(be,e),be.length-1)},ur=[],Oe,Jr=e=>{var n=ur[e];return n||(e>=ur.length&&(ur.length=e+1),ur[e]=n=Oe.get(e)),E(Oe.get(e)==n,"JavaScript-side Wasm function table mirror is out of date!"),n},ao=e=>{var n=t["_"+e];return E(n,"Cannot call unknown function "+e+", make sure it is exported"),n},jt=e=>Gt(e),oo=e=>{var n=Ue(e)+1,a=jt(n);return Ve(e,a,n),a},so=(e,n,a,o,c)=>{var d={string:A=>{var ce=0;return A!=null&&A!==0&&(ce=oo(A)),ce},array:A=>{var ce=jt(A.length);return $t(A,ce),ce}};function f(A){return n==="string"?gr(A):n==="boolean"?!!A:A}var _=ao(e),b=[],P=0;if(E(n!=="array",'Return type should not be "array".'),o)for(var N=0;N<o.length;N++){var O=d[a[N]];O?(P===0&&(P=Rt()),b[N]=O(o[N])):b[N]=o[N]}var T=_(...b);function S(A){return P!==0&&Nt(P),f(A)}return T=S(T),T},zt=(e,n)=>{E(e<16384),e<128?n.push(e):n.push(e%128|128,e>>7)},io=e=>{for(var n={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},a={parameters:[],results:e[0]=="v"?[]:[n[e[0]]]},o=1;o<e.length;++o)E(e[o]in n,"invalid signature char: "+e[o]),a.parameters.push(n[e[o]]);return a},uo=(e,n)=>{var a=e.slice(0,1),o=e.slice(1),c={i:127,p:127,j:126,f:125,d:124,e:111};n.push(96),zt(o.length,n);for(var d=0;d<o.length;++d)E(o[d]in c,"invalid signature char: "+o[d]),n.push(c[o[d]]);a=="v"?n.push(0):n.push(1,c[a])},lo=(e,n)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(io(n),e);var a=[1];uo(n,a);var o=[0,97,115,109,1,0,0,0,1];zt(a.length,o),o.push(...a),o.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var c=new WebAssembly.Module(new Uint8Array(o)),d=new WebAssembly.Instance(c,{e:{f:e}}),f=d.exports.f;return f},co=(e,n)=>{if(Ye)for(var a=e;a<e+n;a++){var o=Jr(a);o&&Ye.set(o,a)}},Ye,mo=e=>(Ye||(Ye=new WeakMap,co(0,Oe.length)),Ye.get(e)||0),Zr=[],fo=()=>{if(Zr.length)return Zr.pop();try{Oe.grow(1)}catch(e){throw e instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":e}return Oe.length-1},Qr=(e,n)=>{Oe.set(e,n),ur[e]=Oe.get(e)},po=(e,n)=>{E(typeof e<"u");var a=mo(e);if(a)return a;var o=fo();try{Qr(o,e)}catch(d){if(!(d instanceof TypeError))throw d;E(typeof n<"u","Missing signature argument to addFunction: "+e);var c=lo(e,n);Qr(o,c)}return Ye.set(e,o),o},_o=e=>{Ye.delete(Jr(e)),Qr(e,null),Zr.push(e)},ho=e=>{var n=Ue(e)+1,a=bo(n);return a&&Ve(e,a,n),a};s.createPreloadedFile=pa,s.staticInit();function go(){L("ENVIRONMENT"),L("GL_MAX_TEXTURE_IMAGE_UNITS"),L("SDL_canPlayWithWebAudio"),L("SDL_numSimultaneouslyQueuedBuffers"),L("INITIAL_MEMORY"),L("wasmMemory"),L("arguments"),L("buffer"),L("canvas"),L("doNotCaptureKeyboard"),L("dynamicLibraries"),L("elementPointerLock"),L("extraStackTrace"),L("forcedAspectRatio"),L("instantiateWasm"),L("keyboardListeningElement"),L("freePreloadedMediaOnUse"),L("loadSplitModule"),L("logReadFiles"),L("mainScriptUrlOrBlob"),L("mem"),L("monitorRunDependencies"),L("noExitRuntime"),L("noInitialRun"),L("onAbort"),L("onCustomMessage"),L("onExit"),L("onFree"),L("onFullScreen"),L("onMalloc"),L("onRealloc"),L("onRuntimeInitialized"),L("postMainLoop"),L("postRun"),L("preInit"),L("preMainLoop"),L("preinitializedWebGLContext"),L("preloadPlugins"),L("print"),L("printErr"),L("quit"),L("setStatus"),L("statusMessage"),L("stderr"),L("stdin"),L("stdout"),L("thisProgram"),L("wasm"),L("wasmBinary"),L("websocket"),L("fetchSettings")}var Ht={__handle_stack_overflow:ia,__syscall_dup3:ga,__syscall_fcntl64:ba,__syscall_ioctl:ya,__syscall_openat:wa,__syscall_readlinkat:va,__syscall_renameat:Ea,__syscall_rmdir:ka,__syscall_unlinkat:Ta,_abort_js:xa,_emscripten_get_now_is_monotonic:La,_emscripten_system:Aa,_emscripten_throw_longjmp:Pa,_gmtime_js:Ra,_localtime_js:Da,_mktime_js:Ca,_tzset_js:Ia,alignfault:Bn,emscripten_date_now:Ua,emscripten_get_now:Ut,emscripten_resize_heap:$a,environ_get:Ha,environ_sizes_get:Wa,exit:Ka,fd_close:Ga,fd_read:Ja,fd_seek:Za,fd_write:eo,invoke_vii:vo,segfault:Un,strftime:no},ke=Zn();t._lua_checkstack=p("lua_checkstack",2),t._lua_xmove=p("lua_xmove",3),t._lua_atpanic=p("lua_atpanic",2),t._lua_version=p("lua_version",1),t._lua_absindex=p("lua_absindex",2),t._lua_gettop=p("lua_gettop",1),t._lua_settop=p("lua_settop",2),t._lua_closeslot=p("lua_closeslot",2),t._lua_rotate=p("lua_rotate",3),t._lua_copy=p("lua_copy",3),t._lua_pushvalue=p("lua_pushvalue",2),t._lua_type=p("lua_type",2),t._lua_typename=p("lua_typename",2),t._lua_iscfunction=p("lua_iscfunction",2),t._lua_isinteger=p("lua_isinteger",2),t._lua_isnumber=p("lua_isnumber",2),t._lua_isstring=p("lua_isstring",2),t._lua_isuserdata=p("lua_isuserdata",2),t._lua_rawequal=p("lua_rawequal",3),t._lua_arith=p("lua_arith",2),t._lua_compare=p("lua_compare",4),t._lua_stringtonumber=p("lua_stringtonumber",2),t._lua_tonumberx=p("lua_tonumberx",3),t._lua_tointegerx=p("lua_tointegerx",3),t._lua_toboolean=p("lua_toboolean",2),t._lua_tolstring=p("lua_tolstring",3),t._lua_rawlen=p("lua_rawlen",2),t._lua_tocfunction=p("lua_tocfunction",2),t._lua_touserdata=p("lua_touserdata",2),t._lua_tothread=p("lua_tothread",2),t._lua_topointer=p("lua_topointer",2),t._lua_pushnil=p("lua_pushnil",1),t._lua_pushnumber=p("lua_pushnumber",2),t._lua_pushinteger=p("lua_pushinteger",2),t._lua_pushlstring=p("lua_pushlstring",3),t._lua_pushstring=p("lua_pushstring",2),t._lua_pushcclosure=p("lua_pushcclosure",3),t._lua_pushboolean=p("lua_pushboolean",2),t._lua_pushlightuserdata=p("lua_pushlightuserdata",2),t._lua_pushthread=p("lua_pushthread",1),t._lua_getglobal=p("lua_getglobal",2),t._lua_gettable=p("lua_gettable",2),t._lua_getfield=p("lua_getfield",3),t._lua_geti=p("lua_geti",3),t._lua_rawget=p("lua_rawget",2),t._lua_rawgeti=p("lua_rawgeti",3),t._lua_rawgetp=p("lua_rawgetp",3),t._lua_createtable=p("lua_createtable",3),t._lua_getmetatable=p("lua_getmetatable",2),t._lua_getiuservalue=p("lua_getiuservalue",3),t._lua_setglobal=p("lua_setglobal",2),t._lua_settable=p("lua_settable",2),t._lua_setfield=p("lua_setfield",3),t._lua_seti=p("lua_seti",3),t._lua_rawset=p("lua_rawset",2),t._lua_rawsetp=p("lua_rawsetp",3),t._lua_rawseti=p("lua_rawseti",3),t._lua_setmetatable=p("lua_setmetatable",2),t._lua_setiuservalue=p("lua_setiuservalue",3),t._lua_callk=p("lua_callk",5),t._lua_pcallk=p("lua_pcallk",6),t._lua_load=p("lua_load",5),t._lua_dump=p("lua_dump",4),t._lua_status=p("lua_status",1),t._lua_error=p("lua_error",1),t._lua_next=p("lua_next",2),t._lua_toclose=p("lua_toclose",2),t._lua_concat=p("lua_concat",2),t._lua_len=p("lua_len",2),t._lua_getallocf=p("lua_getallocf",2),t._lua_setallocf=p("lua_setallocf",3),t._lua_setwarnf=p("lua_setwarnf",3),t._lua_warning=p("lua_warning",3),t._lua_newuserdatauv=p("lua_newuserdatauv",3),t._lua_getupvalue=p("lua_getupvalue",3),t._lua_setupvalue=p("lua_setupvalue",3),t._lua_upvalueid=p("lua_upvalueid",3),t._lua_upvaluejoin=p("lua_upvaluejoin",5),t._luaL_traceback=p("luaL_traceback",4),t._luaL_buffinit=p("luaL_buffinit",2),t._luaL_addstring=p("luaL_addstring",2),t._luaL_prepbuffsize=p("luaL_prepbuffsize",2),t._lua_getstack=p("lua_getstack",3),t._luaL_addvalue=p("luaL_addvalue",1),t._lua_getinfo=p("lua_getinfo",3),t._luaL_pushresult=p("luaL_pushresult",1),t._luaL_addlstring=p("luaL_addlstring",3),t._luaL_argerror=p("luaL_argerror",3),t._luaL_where=p("luaL_where",2),t._luaL_typeerror=p("luaL_typeerror",3),t._luaL_getmetafield=p("luaL_getmetafield",3),t._luaL_fileresult=p("luaL_fileresult",3),t._luaL_execresult=p("luaL_execresult",2),t._luaL_newmetatable=p("luaL_newmetatable",2),t._luaL_setmetatable=p("luaL_setmetatable",2),t._luaL_testudata=p("luaL_testudata",3),t._luaL_checkudata=p("luaL_checkudata",3),t._luaL_optlstring=p("luaL_optlstring",4),t._luaL_checklstring=p("luaL_checklstring",3),t._luaL_checkstack=p("luaL_checkstack",3),t._luaL_checktype=p("luaL_checktype",3),t._luaL_checkany=p("luaL_checkany",2),t._luaL_checknumber=p("luaL_checknumber",2),t._luaL_optnumber=p("luaL_optnumber",3),t._luaL_checkinteger=p("luaL_checkinteger",2),t._luaL_optinteger=p("luaL_optinteger",3),t._luaL_pushresultsize=p("luaL_pushresultsize",2),t._luaL_buffinitsize=p("luaL_buffinitsize",3),t._luaL_ref=p("luaL_ref",2),t._luaL_unref=p("luaL_unref",3),t._luaL_loadfilex=p("luaL_loadfilex",3),t._luaL_loadbufferx=p("luaL_loadbufferx",5),t._luaL_loadstring=p("luaL_loadstring",2),t._luaL_callmeta=p("luaL_callmeta",3),t._luaL_len=p("luaL_len",2),t._luaL_tolstring=p("luaL_tolstring",3),t._luaL_setfuncs=p("luaL_setfuncs",3),t._luaL_getsubtable=p("luaL_getsubtable",3),t._luaL_requiref=p("luaL_requiref",4),t._luaL_addgsub=p("luaL_addgsub",4),t._luaL_gsub=p("luaL_gsub",4),t._luaL_newstate=p("luaL_newstate",0),t._lua_newstate=p("lua_newstate",2),t._free=p("free",1),t._realloc=p("realloc",2);var Wt=p("fflush",1);t._luaL_checkversion_=p("luaL_checkversion_",3),t._luaopen_base=p("luaopen_base",1),t._luaopen_coroutine=p("luaopen_coroutine",1),t._lua_newthread=p("lua_newthread",1),t._lua_yieldk=p("lua_yieldk",4),t._lua_isyieldable=p("lua_isyieldable",1),t._lua_resetthread=p("lua_resetthread",2),t._lua_resume=p("lua_resume",4),t._luaopen_debug=p("luaopen_debug",1),t._lua_gethookmask=p("lua_gethookmask",1),t._lua_gethook=p("lua_gethook",1),t._lua_gethookcount=p("lua_gethookcount",1),t._lua_getlocal=p("lua_getlocal",3),t._lua_sethook=p("lua_sethook",4),t._lua_setlocal=p("lua_setlocal",3),t._lua_setcstacklimit=p("lua_setcstacklimit",2),t._luaL_openlibs=p("luaL_openlibs",1),t._luaopen_package=p("luaopen_package",1),t._luaopen_table=p("luaopen_table",1),t._luaopen_io=p("luaopen_io",1),t._luaopen_os=p("luaopen_os",1),t._luaopen_string=p("luaopen_string",1),t._luaopen_math=p("luaopen_math",1),t._luaopen_utf8=p("luaopen_utf8",1),t._lua_close=p("lua_close",1);var bo=t._malloc=p("malloc",1),Yt=p("sbrk",1),yo=p("setThrew",2),qt=()=>(qt=ke.emscripten_stack_init)(),qe=()=>(qe=ke.emscripten_stack_get_base)(),lr=()=>(lr=ke.emscripten_stack_get_end)(),Kt=e=>(Kt=ke._emscripten_stack_restore)(e),Gt=e=>(Gt=ke._emscripten_stack_alloc)(e),Xt=()=>(Xt=ke.emscripten_stack_get_current)(),wo=t.___set_stack_limits=p("__set_stack_limits",2);function vo(e,n,a){var o=Rt();try{Jr(e)(n,a)}catch(c){if(Nt(o),c!==c+0)throw c;yo(1,0)}}t.ENV=yr,t.ccall=so,t.addFunction=po,t.removeFunction=_o,t.setValue=aa,t.getValue=ra,t.stringToUTF8=Ve,t.lengthBytesUTF8=Ue,t.stringToNewUTF8=ho,t.FS=s;var Eo=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getTempRet0","setTempRet0","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","readEmAsmArgs","jstoi_q","listenOnce","autoResumeAudioContext","getDynCaller","dynCall","handleException","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","cwrap","reallyNegative","strLen","reSign","formatString","intArrayToString","AsciiToString","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","createDyncallWrapper","safeSetTimeout","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","getPromise","makePromise","idsToPromises","makePromiseCallback","Browser_asyncPrepareDataCounter","setMainLoop","getSocketFromFD","getSocketAddress","FS_unlink","FS_mkdirTree","_setNetworkCallback"];Eo.forEach(Qn);var ko=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","HEAPF32","HEAPF64","HEAP_DATA_VIEW","HEAP8","HEAPU8","HEAP16","HEAPU16","HEAP32","HEAPU32","HEAP64","HEAPU64","writeStackCookie","checkStackCookie","MAX_INT53","MIN_INT53","bigintToI53Checked","stackSave","stackRestore","stackAlloc","ptrToString","zeroMemory","exitJS","getHeapMax","growMemory","setStackLimits","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","isLeapYear","ydayFromDate","arraySum","addDays","ERRNO_CODES","ERRNO_MESSAGES","DNS","Protocols","Sockets","initRandomFill","randomFill","timers","warnOnce","readEmAsmArgsArray","jstoi_s","getExecutableName","keepRuntimeAlive","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","getCFunc","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","freeTableIndexes","functionsInTableMap","getEmptyTableSlot","updateTableMap","getFunctionAddress","unSign","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","intArrayFromString","stringToAscii","UTF16Decoder","stringToUTF8OnStack","writeArrayToMemory","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","getEnvStrings","doReadv","doWritev","promiseMap","Browser","getPreloadedImageData__data","wget","SYSCALLS","preloadPlugins","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","FS_createPath","FS_createDevice","FS_readFile","FS_createDataFile","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS"];ko.forEach(Ft);var wr;or=function e(){wr||Jt(),wr||(or=e)};function To(){qt(),Vn()}function Jt(){if(ar>0||(To(),jn(),ar>0))return;function e(){wr||(wr=!0,t.calledRun=!0,!rr&&(zn(),i(t),E(!t._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Hn()))}e(),zr()}function xo(){var e=Ge,n=_e,a=!1;Ge=_e=o=>{a=!0};try{Wt(0),["stdout","stderr"].forEach(function(o){var c=s.analyzePath("/dev/"+o);if(c){var d=c.object,f=d.rdev,_=Be.ttys[f];_?.output?.length&&(a=!0)}})}catch{}Ge=e,_e=n,a&&Ie("stdio streams had content in them that was not flushed. you should set EXIT_RUNTIME to 1 (see the Emscripten FAQ), or make sure to emit a newline when you printf etc.")}Jt(),r=m;for(let e of Object.keys(t))e in l||Object.defineProperty(l,e,{configurable:!0,get(){I(`Access to module property ('${e}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return r},ft=class l{static async initialize(r,t){let i=await Ho({locateFile:(u,m)=>r||m+u,preRun:u=>{typeof t=="object"&&Object.entries(t).forEach(([m,h])=>u.ENV[m]=h)}});return new l(i)}constructor(r){this.referenceTracker=new WeakMap,this.referenceMap=new Map,this.availableReferences=[],this.module=r,this.luaL_checkversion_=this.cwrap("luaL_checkversion_",null,["number","number","number"]),this.luaL_getmetafield=this.cwrap("luaL_getmetafield","number",["number","number","string"]),this.luaL_callmeta=this.cwrap("luaL_callmeta","number",["number","number","string"]),this.luaL_tolstring=this.cwrap("luaL_tolstring","string",["number","number","number"]),this.luaL_argerror=this.cwrap("luaL_argerror","number",["number","number","string"]),this.luaL_typeerror=this.cwrap("luaL_typeerror","number",["number","number","string"]),this.luaL_checklstring=this.cwrap("luaL_checklstring","string",["number","number","number"]),this.luaL_optlstring=this.cwrap("luaL_optlstring","string",["number","number","string","number"]),this.luaL_checknumber=this.cwrap("luaL_checknumber","number",["number","number"]),this.luaL_optnumber=this.cwrap("luaL_optnumber","number",["number","number","number"]),this.luaL_checkinteger=this.cwrap("luaL_checkinteger","number",["number","number"]),this.luaL_optinteger=this.cwrap("luaL_optinteger","number",["number","number","number"]),this.luaL_checkstack=this.cwrap("luaL_checkstack",null,["number","number","string"]),this.luaL_checktype=this.cwrap("luaL_checktype",null,["number","number","number"]),this.luaL_checkany=this.cwrap("luaL_checkany",null,["number","number"]),this.luaL_newmetatable=this.cwrap("luaL_newmetatable","number",["number","string"]),this.luaL_setmetatable=this.cwrap("luaL_setmetatable",null,["number","string"]),this.luaL_testudata=this.cwrap("luaL_testudata","number",["number","number","string"]),this.luaL_checkudata=this.cwrap("luaL_checkudata","number",["number","number","string"]),this.luaL_where=this.cwrap("luaL_where",null,["number","number"]),this.luaL_fileresult=this.cwrap("luaL_fileresult","number",["number","number","string"]),this.luaL_execresult=this.cwrap("luaL_execresult","number",["number","number"]),this.luaL_ref=this.cwrap("luaL_ref","number",["number","number"]),this.luaL_unref=this.cwrap("luaL_unref",null,["number","number","number"]),this.luaL_loadfilex=this.cwrap("luaL_loadfilex","number",["number","string","string"]),this.luaL_loadbufferx=this.cwrap("luaL_loadbufferx","number",["number","string|number","number","string|number","string"]),this.luaL_loadstring=this.cwrap("luaL_loadstring","number",["number","string"]),this.luaL_newstate=this.cwrap("luaL_newstate","number",[]),this.luaL_len=this.cwrap("luaL_len","number",["number","number"]),this.luaL_addgsub=this.cwrap("luaL_addgsub",null,["number","string","string","string"]),this.luaL_gsub=this.cwrap("luaL_gsub","string",["number","string","string","string"]),this.luaL_setfuncs=this.cwrap("luaL_setfuncs",null,["number","number","number"]),this.luaL_getsubtable=this.cwrap("luaL_getsubtable","number",["number","number","string"]),this.luaL_traceback=this.cwrap("luaL_traceback",null,["number","number","string","number"]),this.luaL_requiref=this.cwrap("luaL_requiref",null,["number","string","number","number"]),this.luaL_buffinit=this.cwrap("luaL_buffinit",null,["number","number"]),this.luaL_prepbuffsize=this.cwrap("luaL_prepbuffsize","string",["number","number"]),this.luaL_addlstring=this.cwrap("luaL_addlstring",null,["number","string","number"]),this.luaL_addstring=this.cwrap("luaL_addstring",null,["number","string"]),this.luaL_addvalue=this.cwrap("luaL_addvalue",null,["number"]),this.luaL_pushresult=this.cwrap("luaL_pushresult",null,["number"]),this.luaL_pushresultsize=this.cwrap("luaL_pushresultsize",null,["number","number"]),this.luaL_buffinitsize=this.cwrap("luaL_buffinitsize","string",["number","number","number"]),this.lua_newstate=this.cwrap("lua_newstate","number",["number","number"]),this.lua_close=this.cwrap("lua_close",null,["number"]),this.lua_newthread=this.cwrap("lua_newthread","number",["number"]),this.lua_resetthread=this.cwrap("lua_resetthread","number",["number"]),this.lua_atpanic=this.cwrap("lua_atpanic","number",["number","number"]),this.lua_version=this.cwrap("lua_version","number",["number"]),this.lua_absindex=this.cwrap("lua_absindex","number",["number","number"]),this.lua_gettop=this.cwrap("lua_gettop","number",["number"]),this.lua_settop=this.cwrap("lua_settop",null,["number","number"]),this.lua_pushvalue=this.cwrap("lua_pushvalue",null,["number","number"]),this.lua_rotate=this.cwrap("lua_rotate",null,["number","number","number"]),this.lua_copy=this.cwrap("lua_copy",null,["number","number","number"]),this.lua_checkstack=this.cwrap("lua_checkstack","number",["number","number"]),this.lua_xmove=this.cwrap("lua_xmove",null,["number","number","number"]),this.lua_isnumber=this.cwrap("lua_isnumber","number",["number","number"]),this.lua_isstring=this.cwrap("lua_isstring","number",["number","number"]),this.lua_iscfunction=this.cwrap("lua_iscfunction","number",["number","number"]),this.lua_isinteger=this.cwrap("lua_isinteger","number",["number","number"]),this.lua_isuserdata=this.cwrap("lua_isuserdata","number",["number","number"]),this.lua_type=this.cwrap("lua_type","number",["number","number"]),this.lua_typename=this.cwrap("lua_typename","string",["number","number"]),this.lua_tonumberx=this.cwrap("lua_tonumberx","number",["number","number","number"]),this.lua_tointegerx=this.cwrap("lua_tointegerx","number",["number","number","number"]),this.lua_toboolean=this.cwrap("lua_toboolean","number",["number","number"]),this.lua_tolstring=this.cwrap("lua_tolstring","string",["number","number","number"]),this.lua_rawlen=this.cwrap("lua_rawlen","number",["number","number"]),this.lua_tocfunction=this.cwrap("lua_tocfunction","number",["number","number"]),this.lua_touserdata=this.cwrap("lua_touserdata","number",["number","number"]),this.lua_tothread=this.cwrap("lua_tothread","number",["number","number"]),this.lua_topointer=this.cwrap("lua_topointer","number",["number","number"]),this.lua_arith=this.cwrap("lua_arith",null,["number","number"]),this.lua_rawequal=this.cwrap("lua_rawequal","number",["number","number","number"]),this.lua_compare=this.cwrap("lua_compare","number",["number","number","number","number"]),this.lua_pushnil=this.cwrap("lua_pushnil",null,["number"]),this.lua_pushnumber=this.cwrap("lua_pushnumber",null,["number","number"]),this.lua_pushinteger=this.cwrap("lua_pushinteger",null,["number","number"]),this.lua_pushlstring=this.cwrap("lua_pushlstring","string",["number","string|number","number"]),this.lua_pushstring=this.cwrap("lua_pushstring","string",["number","string|number"]),this.lua_pushcclosure=this.cwrap("lua_pushcclosure",null,["number","number","number"]),this.lua_pushboolean=this.cwrap("lua_pushboolean",null,["number","number"]),this.lua_pushlightuserdata=this.cwrap("lua_pushlightuserdata",null,["number","number"]),this.lua_pushthread=this.cwrap("lua_pushthread","number",["number"]),this.lua_getglobal=this.cwrap("lua_getglobal","number",["number","string"]),this.lua_gettable=this.cwrap("lua_gettable","number",["number","number"]),this.lua_getfield=this.cwrap("lua_getfield","number",["number","number","string"]),this.lua_geti=this.cwrap("lua_geti","number",["number","number","number"]),this.lua_rawget=this.cwrap("lua_rawget","number",["number","number"]),this.lua_rawgeti=this.cwrap("lua_rawgeti","number",["number","number","number"]),this.lua_rawgetp=this.cwrap("lua_rawgetp","number",["number","number","number"]),this.lua_createtable=this.cwrap("lua_createtable",null,["number","number","number"]),this.lua_newuserdatauv=this.cwrap("lua_newuserdatauv","number",["number","number","number"]),this.lua_getmetatable=this.cwrap("lua_getmetatable","number",["number","number"]),this.lua_getiuservalue=this.cwrap("lua_getiuservalue","number",["number","number","number"]),this.lua_setglobal=this.cwrap("lua_setglobal",null,["number","string"]),this.lua_settable=this.cwrap("lua_settable",null,["number","number"]),this.lua_setfield=this.cwrap("lua_setfield",null,["number","number","string"]),this.lua_seti=this.cwrap("lua_seti",null,["number","number","number"]),this.lua_rawset=this.cwrap("lua_rawset",null,["number","number"]),this.lua_rawseti=this.cwrap("lua_rawseti",null,["number","number","number"]),this.lua_rawsetp=this.cwrap("lua_rawsetp",null,["number","number","number"]),this.lua_setmetatable=this.cwrap("lua_setmetatable","number",["number","number"]),this.lua_setiuservalue=this.cwrap("lua_setiuservalue","number",["number","number","number"]),this.lua_callk=this.cwrap("lua_callk",null,["number","number","number","number","number"]),this.lua_pcallk=this.cwrap("lua_pcallk","number",["number","number","number","number","number","number"]),this.lua_load=this.cwrap("lua_load","number",["number","number","number","string","string"]),this.lua_dump=this.cwrap("lua_dump","number",["number","number","number","number"]),this.lua_yieldk=this.cwrap("lua_yieldk","number",["number","number","number","number"]),this.lua_resume=this.cwrap("lua_resume","number",["number","number","number","number"]),this.lua_status=this.cwrap("lua_status","number",["number"]),this.lua_isyieldable=this.cwrap("lua_isyieldable","number",["number"]),this.lua_setwarnf=this.cwrap("lua_setwarnf",null,["number","number","number"]),this.lua_warning=this.cwrap("lua_warning",null,["number","string","number"]),this.lua_error=this.cwrap("lua_error","number",["number"]),this.lua_next=this.cwrap("lua_next","number",["number","number"]),this.lua_concat=this.cwrap("lua_concat",null,["number","number"]),this.lua_len=this.cwrap("lua_len",null,["number","number"]),this.lua_stringtonumber=this.cwrap("lua_stringtonumber","number",["number","string"]),this.lua_getallocf=this.cwrap("lua_getallocf","number",["number","number"]),this.lua_setallocf=this.cwrap("lua_setallocf",null,["number","number","number"]),this.lua_toclose=this.cwrap("lua_toclose",null,["number","number"]),this.lua_closeslot=this.cwrap("lua_closeslot",null,["number","number"]),this.lua_getstack=this.cwrap("lua_getstack","number",["number","number","number"]),this.lua_getinfo=this.cwrap("lua_getinfo","number",["number","string","number"]),this.lua_getlocal=this.cwrap("lua_getlocal","string",["number","number","number"]),this.lua_setlocal=this.cwrap("lua_setlocal","string",["number","number","number"]),this.lua_getupvalue=this.cwrap("lua_getupvalue","string",["number","number","number"]),this.lua_setupvalue=this.cwrap("lua_setupvalue","string",["number","number","number"]),this.lua_upvalueid=this.cwrap("lua_upvalueid","number",["number","number","number"]),this.lua_upvaluejoin=this.cwrap("lua_upvaluejoin",null,["number","number","number","number","number"]),this.lua_sethook=this.cwrap("lua_sethook",null,["number","number","number","number"]),this.lua_gethook=this.cwrap("lua_gethook","number",["number"]),this.lua_gethookmask=this.cwrap("lua_gethookmask","number",["number"]),this.lua_gethookcount=this.cwrap("lua_gethookcount","number",["number"]),this.lua_setcstacklimit=this.cwrap("lua_setcstacklimit","number",["number","number"]),this.luaopen_base=this.cwrap("luaopen_base","number",["number"]),this.luaopen_coroutine=this.cwrap("luaopen_coroutine","number",["number"]),this.luaopen_table=this.cwrap("luaopen_table","number",["number"]),this.luaopen_io=this.cwrap("luaopen_io","number",["number"]),this.luaopen_os=this.cwrap("luaopen_os","number",["number"]),this.luaopen_string=this.cwrap("luaopen_string","number",["number"]),this.luaopen_utf8=this.cwrap("luaopen_utf8","number",["number"]),this.luaopen_math=this.cwrap("luaopen_math","number",["number"]),this.luaopen_debug=this.cwrap("luaopen_debug","number",["number"]),this.luaopen_package=this.cwrap("luaopen_package","number",["number"]),this.luaL_openlibs=this.cwrap("luaL_openlibs",null,["number"])}lua_remove(r,t){this.lua_rotate(r,t,-1),this.lua_pop(r,1)}lua_pop(r,t){this.lua_settop(r,-t-1)}luaL_getmetatable(r,t){return this.lua_getfield(r,Ae,t)}lua_yield(r,t){return this.lua_yieldk(r,t,0,null)}lua_upvalueindex(r){return Ae-r}ref(r){let t=this.referenceTracker.get(r);if(t)return t.refCount++,t.index;let i=this.availableReferences.pop(),u=i===void 0?this.referenceMap.size+1:i;return this.referenceMap.set(u,r),this.referenceTracker.set(r,{refCount:1,index:u}),this.lastRefIndex=u,u}unref(r){let t=this.referenceMap.get(r);if(t===void 0)return;let i=this.referenceTracker.get(t);if(i===void 0){this.referenceTracker.delete(t),this.availableReferences.push(r);return}i.refCount--,i.refCount<=0&&(this.referenceTracker.delete(t),this.referenceMap.delete(r),this.availableReferences.push(r))}getRef(r){return this.referenceMap.get(r)}getLastRefIndex(){return this.lastRefIndex}printRefs(){for(let[r,t]of this.referenceMap.entries())console.log(r,t)}cwrap(r,t,i){return i.some(m=>m==="string|number")?(...m)=>{let h=[],w=i.map((y,M)=>{var D;if(y==="string|number"){if(typeof m[M]=="number")return"number";if(((D=m[M])===null||D===void 0?void 0:D.length)>1024){let k=this.module.stringToNewUTF8(m[M]);return m[M]=k,h.push(k),"number"}else return"string"}return y});try{return this.module.ccall(r,t,w,m)}finally{for(let y of h)this.module._free(y)}}:(...m)=>this.module.ccall(r,t,i,m)}},Wo="1.16.0",Or=class{constructor(r,t){var i;r===void 0&&(typeof window=="object"&&typeof window.document<"u"||typeof self=="object"&&((i=self?.constructor)===null||i===void 0?void 0:i.name)==="DedicatedWorkerGlobalScope")&&(r=`https://unpkg.com/wasmoon@${Wo}/dist/glue.wasm`),this.luaWasmPromise=ft.initialize(r,t)}async mountFile(r,t){this.mountFileSync(await this.getLuaModule(),r,t)}mountFileSync(r,t,i){let u=t.lastIndexOf("/"),m=t.substring(u+1),h=t.substring(0,t.length-m.length-1);if(h.length>0){let w=h.split("/").reverse(),y="";for(;w.length;){let M=w.pop();if(!M)continue;let D=`${y}/${M}`;try{r.module.FS.mkdir(D)}catch{}y=D}}r.module.FS.writeFile(t,i)}async createEngine(r={}){return new mt(await this.getLuaModule(),r)}async getLuaModule(){return this.luaWasmPromise}};function er(...l){}globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION||(globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION=globalThis.console);var Fn=globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION;var Nn=null,Yo=(U??[]).map(l=>l.split(".")),He=Fn;globalThis.console===He&&(globalThis.console=new Proxy(He,{get:()=>er}));function Mr(l){return Rn(l,Yo)||Nn&&!Rn(l,Nn)?{log:er,warn:er,error:(r,...t)=>He.error(`[${l}] ${r}`,...t),info:er,debug:er}:{log:(r,...t)=>He.log(`[${l}] ${r}`,...t),warn:(r,...t)=>He.warn(`[${l}] ${r}`,...t),error:(r,...t)=>He.error(`[${l}] ${r}`,...t),info:(r,...t)=>He.info(`[${l}] ${r}`,...t),debug:(r,...t)=>He.debug(`[${l}] ${r}`,...t)}}function Rn(l,r){let t=l.split(".");for(let i of r){let u=0,m=!0;for(;u<t.length;){if(i[u]==="*"){if(i.length-1===u){m=!0;break}u+=1;continue}if(i[u]===t[u]){u+=1;continue}m=!1;break}if(m)return!0}return!1}var fr=globalThis.browser??globalThis.chrome;fr&&fr.runtime&&(fr.runtime.OnInstalledReason=fr.runtime.OnInstalledReason??{INSTALL:"install",UPDATE:"update",CHROME_UPDATE:"chrome_update",SHARED_MODULE_UPDATE:"shared_module_update"});var qo={},ph=Mr("m.policy_evaluator"),On={"glue.wasm":"./module_statics/policy-evaluator/glue.wasm"};var _h=new Proxy(qo,{get:(l,r,t)=>{if(r==="Content"){let i=globalThis.ContentModule?.policyEvaluator;if(!i)throw globalThis.ServiceWorkerGlobalScope?new Error("Content modules can not be loaded in a background script"):new Error("Content modules can only be loaded after initialization");return i}if(r==="Background"){let i=globalThis.BackgroundModule?.policyEvaluator;if(!i)throw globalThis.ServiceWorkerGlobalScope?new Error("Background modules can only be loaded after initialization"):new Error("Background modules can not be loaded in a content script");return i}}});function Mn(l){return!!(l&&typeof l=="object"&&!Array.isArray(l))}function Ko(l){return{success:!1,error:l}}function Go(l){return{success:!0,value:l}}function _t(l){try{let r=l();return Xo(r)?r:Go(r)}catch(r){return Ko(r)}}function Xo(l){return Mn(l)&&typeof l.success=="boolean"&&(l.success&&"value"in l||!l.success&&"error"in l)}function Dn(l){return _t(()=>JSON.stringify(l))}var De=class l extends Error{_error;_type;_state;static SerializedType="JSONableError";constructor(r){super(typeof r=="string"?r:void 0),this._error=typeof r=="string"?this:r,this._type=l.SerializedType}toJSON(){return{__serialized_type:this._type,stack:this._error.stack,message:this._error.message,name:this._error.name,state:this._state}}static create(r){if(r instanceof Error)return new l(r);if(typeof r=="string"||typeof r=="boolean"||typeof r=="number"||typeof r=="symbol"||typeof r=="bigint"||typeof r=="function")return new l(r.toString());if(Zo(r))return Qo(r);let t=Dn(r);return t.success?new l(t.value):new l("Unserializeable data error")}setState(r){this._state=r}},Jo=F.object().schema({__serialized_type:F.string().equals(De.SerializedType),stack:F.optional(F.string()),message:F.string(),name:F.string(),state:F.anything()}),Zo=Pe(Jo);function Qo(l){let r=new Error;return r.stack=l.stack,r.name=l.name,r.message=l.message,new De(r)}var ht=class l extends De{static SerializedType="UnexpectedResponseError";constructor(r,t={}){super(`Expected [${r}] response was not valid`),this._type=l.SerializedType,this.setState({expectedType:r,errors:t})}},es=F.object().schema({__serialized_type:F.string().equals(ht.SerializedType),stack:F.optional(F.string()),message:F.string(),name:F.string(),state:F.object().schema({expectedType:F.string(),errors:F.record(F.string())})}),pb=Pe(es);var ts=F.object().schema({result_type:F.string().allowed("string_literal","serialized_error"),result_value:F.string()});function gt(l,r){return{result_type:l,result_value:r}}var Ly=Pe(ts);var ns=F.object().schema({keepalive:F.oneof(F.number(),F.boolean().false()),maxConcurrency:F.oneof(F.string().equals("max"),F.number())}),as=F.object().schema({ready:F.boolean().true(),poolSettings:ns}),tw=Pe(as),nw=Mr("offscreen.initialize_worker");function Cn(l){self.postMessage("ready"),self.addEventListener("message",async r=>{let{bytes:t,parameters:i}=r.data;t!==null&&!(t instanceof Uint8Array)&&self.postMessage(gt("serialized_error",JSON.stringify(De.create("Invalid binary data in request"))));try{let u=await l(t,i);self.postMessage(u)}catch(u){self.postMessage(gt("serialized_error",JSON.stringify(De.create(u))))}})}Cn(async(l,r)=>{if(!Sn(r))throw new Error("Unknown call or parameters");let i=await new Or(On["glue.wasm"]).createEngine({enableProxy:!1,openStandardLibs:!0});try{return Object.entries(r.args)?.forEach(([m,h])=>{i.global.set(m,h)}),i.global.set("customCategory",ss),i.global.set("customList",os(r.customListRecord)),i.global.set("Effect",{Block:"Block",Isolate:"Isolate",Allow:"Allow"}),await i.doString(r.luaScript),i.global.get("evaluate")()}finally{i.global.close()}});var os=l=>r=>l[r]?.map(t=>t.item)||[],ss=l=>`@custom@:${l}`;})();
