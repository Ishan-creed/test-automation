"use strict";(()=>{var u=[];function Y(...r){}globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION||(globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION=globalThis.console);var Fe=globalThis.I_TRULY_NEED_THE_RAW_CONSOLE_NOT_THE_PROXY_VERSION;var Pe=null,kt=(u??[]).map(r=>r.split(".")),q=Fe;globalThis.console===q&&(globalThis.console=new Proxy(q,{get:()=>Y}));function $(r){return Re(r,kt)||Pe&&!Re(r,Pe)?{log:Y,warn:Y,error:(e,...t)=>q.error(`[${r}] ${e}`,...t),info:Y,debug:Y}:{log:(e,...t)=>q.log(`[${r}] ${e}`,...t),warn:(e,...t)=>q.warn(`[${r}] ${e}`,...t),error:(e,...t)=>q.error(`[${r}] ${e}`,...t),info:(e,...t)=>q.info(`[${r}] ${e}`,...t),debug:(e,...t)=>q.debug(`[${r}] ${e}`,...t)}}function Re(r,e){let t=r.split(".");for(let n of e){let o=0,i=!0;for(;o<t.length;){if(n[o]==="*"){if(n.length-1===o){i=!0;break}o+=1;continue}if(n[o]===t[o]){o+=1;continue}i=!1;break}if(i)return!0}return!1}var X=globalThis.browser??globalThis.chrome;X&&X.runtime&&(X.runtime.OnInstalledReason=X.runtime.OnInstalledReason??{INSTALL:"install",UPDATE:"update",CHROME_UPDATE:"chrome_update",SHARED_MODULE_UPDATE:"shared_module_update"});var Et={},Tn=$("m.file_analyzer"),Be={"squarex_macroanalyzer_bg.wasm":"./module_statics/file-analyzer/squarex_macroanalyzer_bg.wasm"};var Sn=new Proxy(Et,{get:(r,e,t)=>{if(e==="Content"){let n=globalThis.ContentModule?.fileAnalyzer;if(!n)throw globalThis.ServiceWorkerGlobalScope?new Error("Content modules can not be loaded in a background script"):new Error("Content modules can only be loaded after initialization");return n}if(e==="Background"){let n=globalThis.BackgroundModule?.fileAnalyzer;if(!n)throw globalThis.ServiceWorkerGlobalScope?new Error("Background modules can only be loaded after initialization"):new Error("Background modules can not be loaded in a content script");return n}}});var At=$("m.file_analyzer"),P,j=0,Q=null;function ee(){if(!P)throw new Error("WASM is not initialized");return(Q===null||Q.byteLength===0)&&(Q=new Uint8Array(P.memory.buffer)),Q}var oe=typeof TextEncoder<"u"?new TextEncoder:{encode:()=>{throw Error("TextEncoder not available")}},Tt=typeof oe.encodeInto=="function"?function(r,e){return oe.encodeInto(r,e)}:function(r,e){let t=oe.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ne(r,e,t){if(t===void 0){let l=oe.encode(r),R=e(l.length,1)>>>0;return ee().subarray(R,R+l.length).set(l),j=l.length,R}let n=r.length,o=e(n,1)>>>0,i=ee(),a=0;for(;a<n;a++){let l=r.charCodeAt(a);if(l>127)break;i[o+a]=l}if(a!==n){a!==0&&(r=r.slice(a)),o=t(o,n,n=a+r.length*3,1)>>>0;let l=ee().subarray(o+a,o+n),R=Tt(r,l);a+=R.written,o=t(o,n,a,1)>>>0}return j=a,o}function St(r){return r==null}var Z=null;function xe(){if(!P)throw new Error("WASM is not initialized");return(Z===null||Z.buffer.detached===!0||Z.buffer.detached===void 0&&Z.buffer!==P.memory.buffer)&&(Z=new DataView(P.memory.buffer)),Z}var Oe=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Oe.decode();function ie(r,e){return r=r>>>0,Oe.decode(ee().subarray(r,r+e))}function he(r,e){let t=e(r.length*1,1)>>>0;return ee().set(r,t/1),j=r.length,t}function Ue(r,e,t,n){if(!P)throw new Error("WASM not initialized!");let o,i;try{let a=he(r,P.__wbindgen_malloc),l=j,R=P.analyze_macro(a,l,e,t,n?1:0);return o=R[0],i=R[1],ie(R[0],R[1])}finally{P.__wbindgen_free(o,i,1)}}function Ft(r){if(!P)throw new Error("WASM not initialized!");let e=P.__externref_table_alloc();return P.__wbindgen_export_0.set(e,r),e}function Pt(r,e){let t=e(r.length*4,4)>>>0,n=xe();for(let o=0;o<r.length;o++)n.setUint32(t+4*o,Ft(r[o]),!0);return j=r.length,t}function Ce(r,e,t,n,o,i,a){let l,R;if(!P)throw new Error("WASM not initialized!");try{let M=he(r,P.__wbindgen_malloc),J=j,B=Ne(e,P.__wbindgen_malloc,P.__wbindgen_realloc),v=j,z=Pt(t,P.__wbindgen_malloc),ht=j,ne=P.analyze_zip(M,J,B,v,z,ht,n,o,i,a);return l=ne[0],R=ne[1],ie(ne[0],ne[1])}finally{P.__wbindgen_free(l,R,1)}}function Le(r){let e,t;if(!P)throw new Error("WASM not initialized!");try{let n=he(r,P.__wbindgen_malloc),o=j,i=P.analyze_pdf(n,o);return e=i[0],t=i[1],ie(i[0],i[1])}finally{P.__wbindgen_free(e,t,1)}}async function Rt(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")At.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}let t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Bt(){let r={};return r.wbg={},r.wbg.__wbindgen_init_externref_table=function(){if(!P)throw new Error("WASM not initialized!");let e=P.__wbindgen_export_0,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},r.wbg.__wbindgen_string_get=function(e,t){if(!P)throw new Error("WASM not initialized!");let n=t,o=typeof n=="string"?n:void 0,i=St(o)?0:Ne(o,P.__wbindgen_malloc,P.__wbindgen_realloc),a=j;xe().setInt32(e+4*1,a,!0),xe().setInt32(e+4*0,i,!0)},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ie(e,t))},r}function Nt(r,e){if(P=r.exports,ze.__wbindgen_wasm_module=e,Z=null,Q=null,!P)throw new Error("WASM not initialized!");return P.__wbindgen_start(),P}async function ze(){if(P!==void 0)return P;let r=Be["squarex_macroanalyzer_bg.wasm"],e=Bt();let{instance:t,module:n}=await Rt(await fetch(r),e);return Nt(t,n)}var We=ze;var Ot=function(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t},Ut=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ae,c=class extends Error{constructor(e,t){super(t),ae.set(this,void 0),Ot(this,ae,e,"f")}get key(){return Ut(this,ae,"f")}};ae=new WeakMap;function O(r,e,t){return(n,o="")=>{try{let i=e.reduce((a,l)=>l(a,o),n);return t?.(i,o),Ct(o,r,i)}catch(i){return Ie(n,i)}}}function Ie(r,e){return{initialValue:r,hasError:!0,error:e}}function Ct(r,e,t){try{return e.forEach(n=>n(t,r)),{initialValue:t,result:t,hasError:!1}}catch(n){return Ie(t,n)}}var W=(r,e,t,n)=>(o,i="")=>{if(!(r?!e(o):e(o)))throw new c(i,`${t??typeof o} '${o}' ${r?"is":"is not"} ${n}`)};function Lt(r,e,t,n){return`${r} ${e} is${n?" ":" not "}${t}`}function H(r){return(e,t,n,o,i)=>{if(!t())throw new c(e,Lt(r,n,o,i))}}var se=H("array"),ve=r=>e=>(t,n="")=>{se(n,()=>r?t.length!==e:t.length===e,`of length ${t.length}`,`of exact length ${e}`,r)},zt=r=>e=>(t,n="")=>{se(n,()=>r?t.length<e:t.length>=e,`of length ${t.length}`,`within minimum length of ${e}`,r)},Wt=r=>e=>(t,n="")=>{se(n,()=>r?t.length>e:t.length<=e,`of length ${t.length}`,`within maximum length of ${e}`,r)},Me=r=>()=>(e,t="")=>{se(t,()=>r?e.length!==0:e.length===0,`of length ${e.length}`,"empty",r)};function te(r=[]){let e=[],t=O(e,r,(n,o="")=>{if(!Array.isArray(n))throw new c(o,`Value ${n} is not an array`)});return t.toString=U(t,n=>n.join(", ")),t.toNumber=C(t,n=>Number(n)),t.toBoolean=L(t,n=>!!n),t.toCustom=N(t),t.assert=(n,o)=>(e.push(W(!1,n,"array",o)),t),t.ofExactLength=n=>(e.push(ve(!1)(n)),t),t.ofMinLength=n=>(e.push(zt(!1)(n)),t),t.ofMaxLength=n=>(e.push(Wt(!1)(n)),t),t.empty=()=>(e.push(Me(!1)()),t),t.not={assert:(n,o)=>(e.push(W(!0,n,"array",o)),t),empty:()=>(e.push(Me(!0)()),t),ofExactLength:n=>(e.push(ve(!0)(n)),t)},t.items=function(n){return te([(o,i="")=>{let a=t(o,i);if(a.hasError)throw a.error;let l=a.result.map((R,M)=>n(R,[i,`[${M}]`].filter(Boolean).join(".")));if(l.some(R=>R.hasError))throw l.filter(R=>R.hasError);return l.reduce((R,M)=>(M.hasError||R.push(M.result),R),[])}])},t}var $e=H("boolean"),De=r=>()=>(e,t="")=>{$e(t,()=>r?!e:e,e,"true",r)},Ve=r=>()=>(e,t="")=>{$e(t,()=>r?e:!e,e,"false",r)};function le(r=[]){let e=[],t=O(e,r,(o,i="")=>{if(typeof o!="boolean")throw new c(i,`Value ${o} is not a boolean`)});t.toString=U(t,o=>o.toString()),t.toNumber=C(t,o=>o?1:0),t.toBoolean=L(t,o=>o),t.toCustom=N(t),t.toArray=I(t);let n=o=>(i,a)=>(e.push(W(o,i,"boolean",a)),t);return t.assert=n(!1),t.true=()=>(e.push(De(!1)()),re(!0,t)),t.false=()=>(e.push(Ve(!1)()),re(!1,t)),t.not={assert:n(!0),true:()=>(e.push(De(!0)()),re(!1,t)),false:()=>(e.push(Ve(!0)()),re(!0,t))},t}function je(r=[]){let t=O([],r,(n,o="")=>{if(typeof n!="boolean")throw new c(o,`Value ${n} is not a boolean`);if(n!==!1)throw new c(o,`Value ${n} must be false`)});return t.toString=U(t,n=>n.toString()),t.toNumber=C(t,n=>n?1:0),t.toBoolean=L(t,n=>n),t.toCustom=N(t),t.toArray=I(t),t}function qe(r=[]){let t=O([],r,(n,o="")=>{if(typeof n!="boolean")throw new c(o,`Value ${n} is not a boolean`);if(n!==!0)throw new c(o,`Value ${n} must be true`)});return t.toString=U(t,n=>n.toString()),t.toNumber=C(t,n=>n?1:0),t.toBoolean=L(t,n=>n),t.toCustom=N(t),t.toArray=I(t),t}function He(r=[]){let e=[],t=O(e,r);t.toString=U(t,()=>""),t.toNumber=C(t,()=>0),t.toBoolean=L(t,()=>!1),t.toCustom=N(t),t.toArray=I(t);let n=o=>(i,a)=>(e.push(W(o,i,"custom value",a)),t);return t.assert=n(!1),t.not={assert:n(!0)},t}var K=H("number"),Ke=r=>e=>(t,n="")=>{if(!(r?e.indexOf(t)===-1:e.indexOf(t)!==-1))throw new c(n,`Number value ${t} ${r?`is one of the disallowed values in [${e.join(", ")}]`:`is not one of the allowed values in [${e.join(", ")}]`}`)},Je=r=>()=>(e,t="")=>{K(t,()=>r?e<0:e>0,e,"positive",r)},Ze=r=>()=>(e,t="")=>{K(t,()=>r?e>0:e<0,e,"negative",r)},Ye=r=>()=>(e,t="")=>{K(t,()=>r?e!==0:e===0,e,"zero",r)},Ge=r=>e=>(t,n="")=>{K(n,()=>r?t>=e:t<e,t,`less than ${e}`,r)},Xe=r=>e=>(t,n="")=>{K(n,()=>r?t<=e:t>e,t,`more than ${e}`,r)},Qe=r=>e=>(t,n="")=>{K(n,()=>r?t!==e:t===e,t,`equal to ${e}`,r)},et=r=>e=>(t,n="")=>{K(n,()=>r?t%e!==0:t%e===0,t,`a multiple of ${e}`,r)},tt=r=>()=>(e,t="")=>{K(t,()=>r?!Number.isInteger(e):Number.isInteger(e),e,"an integer",r)};function ue(r=[]){let e=[],t=O(e,r,(o,i="")=>{if(typeof o!="number")throw new c(i,`Value ${o} is not a number`)});t.toString=U(t,o=>o.toString()),t.toNumber=C(t,o=>o),t.toBoolean=L(t,o=>o!==0),t.toCustom=N(t),t.toArray=I(t);let n=o=>(i,a)=>(e.push(W(o,i,"number",a)),t);return t.assert=n(!1),t.allowed=(...o)=>(e.push(Ke(!1)(o)),t),t.integer=()=>(e.push(tt(!1)()),t),t.positive=()=>(e.push(Je(!1)()),t),t.negative=()=>(e.push(Ze(!1)()),t),t.lessThan=o=>(e.push(Ge(!1)(o)),t),t.moreThan=o=>(e.push(Xe(!1)(o)),t),t.zero=()=>(e.push(Ye(!1)()),t),t.multipleOf=o=>(e.push(et(!1)(o)),t),t.equals=o=>(e.push(Qe(!1)(o)),t),t.not={assert:n(!0),allowed:(...o)=>(e.push(Ke(!0)(o)),t),integer:()=>(e.push(tt(!0)()),t),positive:()=>(e.push(Je(!0)()),t),negative:()=>(e.push(Ze(!0)()),t),lessThan:o=>(e.push(Ge(!0)(o)),t),moreThan:o=>(e.push(Xe(!0)(o)),t),zero:()=>(e.push(Ye(!0)()),t),multipleOf:o=>(e.push(et(!0)(o)),t),equals:o=>(e.push(Qe(!0)(o)),t)},t}function ce(r=[]){let e=[],t=O(e,r);t.toCustom=N(t);let n=o=>(i,a)=>(e.push(W(o,i,"custom value",a)),t);return t.assert=n(!1),t.not={assert:n(!0)},t}function U(r,e){return(t=e)=>me([(n,o="")=>{let i=r(n,o);if(i.hasError)throw i.error;try{return t(i.result)}catch(a){throw new c(o,`Unable to create a string from ${typeof i.result} ${i.result}

 ${a instanceof Error?a.message:a}`)}}])}function C(r,e){return(t=e)=>ue([(n,o="")=>{let i=r(n,o);if(i.hasError)throw i.error;try{return t(i.result)}catch(a){throw new c(o,`Unable to create a number from ${typeof i.result} ${i.result}

 ${a instanceof Error?a.message:a}`)}}])}function L(r,e){return(t=e)=>le([(n,o="")=>{let i=r(n,o);if(i.hasError)throw i.error;try{return t(i.result)}catch(a){throw new c(o,`Unable to create a booolean from ${typeof i.result} ${i.result}

 ${a instanceof Error?a.message:a}`)}}])}function N(r){return e=>He([(t,n="")=>{let o=r(t,n);if(o.hasError)throw o.error;try{return e(o.result)}catch(i){throw new c(n,`Unable to create custom type from ${typeof o.result} ${o.result}

 ${i instanceof Error?i.message:i}`)}}])}function I(r){return e=>te([(t,n="")=>{let o=r(t,n);if(o.hasError)throw o.error;try{return e(o.result)}catch(i){throw new c(n,`Unable to create an array from ${typeof o.result} ${o.result}

 ${i instanceof Error?i.message:i}`)}}])}function _e(r){return ce([(e,t="")=>{let n=r(e,t);if(n.hasError)throw n.error;return e}])}function re(r,e){return(r?qe:je)([(n,o="")=>{let i=e(n,o);if(i.hasError)throw i.error;return n}])}var at=H("string"),rt=(r,e)=>t=>(n,o="")=>{at(o,()=>{let i=e?t:t.toLowerCase(),a=e?n:n.toLowerCase();return r?a!==i:a===i},n,"equal to",r)},nt=(r,e)=>t=>(n,o="")=>{let i=e?t:t.map(R=>R.toLowerCase()),a=e?n:n.toLowerCase();if(!(r?i.indexOf(a)===-1:i.indexOf(a)!==-1))throw new c(o,`String value ${n} ${r?`is one of the disallowed values in [${t.join(", ")}]`:`is not one of the allowed values in [${t.join(", ")}]`}`)},ot=r=>()=>(e,t="")=>{at(t,()=>r?e.length!==0:e.length===0,e,"empty",r)},it=r=>e=>(t,n="")=>{if(!(r?!e.test(t):e.test(t)))throw new c(n,`String value '${t}' ${r?"matches":"does not match"} pattern ${e}`)};function me(r=[]){let e=[],t={enabled:!0},n=O(e,r,(i,a="")=>{if(typeof i!="string")throw new c(a,`Value ${i} is not a string`)});n.toString=U(n,i=>i),n.toNumber=C(n,i=>Number(i)),n.toBoolean=L(n,i=>!!i),n.toCustom=N(n),n.toArray=I(n);let o=i=>(a,l)=>(e.push(W(i,a,"string",l)),n);return n.assert=o(!1),n.allowed=(...i)=>(e.push(nt(!1,t.enabled)(i)),_e(n)),n.matches=i=>(e.push(it(!1)(i)),n),n.empty=()=>(e.push(ot(!1)()),n),n.equals=i=>(e.push(rt(!1,t.enabled)(i)),_e(n)),n.case=i=>(t.enabled=i==="sensitive",n),n.not={assert:o(!0),allowed:(...i)=>(e.push(nt(!0,t.enabled)(i)),n),matches:i=>(e.push(it(!0)(i)),n),empty:()=>(e.push(ot(!0)()),n),equals:i=>(e.push(rt(!0,t.enabled)(i)),n)},n}function pe(...r){return(e,t="")=>{let n=[];for(let o of r){let i=o(e,t);if(!i.hasError)return i;n.push(i)}return{hasError:!0,initialValue:e,error:n}}}function fe(r=[]){let e=O([],r,(t,n="")=>{if(t!==void 0)throw new c(n,`Value ${t} is not undefined`)});return e.toString=U(e,()=>String(void 0)),e.toNumber=C(e,()=>NaN),e.toBoolean=L(e,()=>!1),e.toCustom=N(e),e.toArray=I(e),e}function ye(...r){return pe(fe(),...r)}function de(r=[]){let e=[],t=O(e,r,(o,i="")=>{if(o===null||typeof o!="object"||Array.isArray(o))throw new c(i,`Value ${o} is not an object`)});t.toString=U(t,o=>String(o)),t.toNumber=C(t,o=>Number(o)),t.toBoolean=L(t,o=>!!o),t.toCustom=N(t);let n=o=>(i,a)=>(e.push(W(o,i,"object",a)),t);return t.assert=n(!1),t.not={assert:n(!0)},t.schema=function(o){return de([(i,a="")=>{let l=t(i,a);if(l.hasError)throw l.error;let R={...i??{},...l.result},M=Object.entries(o).map(([B,v])=>[B,v(R[B],[a,B].filter(Boolean).join("."))]),J=M.filter(([,B])=>B.hasError);if(J.length>0)throw J.reduce((B,[v,z])=>(B[v]=z,B),{});return M.reduce((B,[v,z])=>(z.hasError||(B[v]=z.result),B),R)}])},t.partial=function(o){return de([(i,a="")=>{let l=t(i,a);if(l.hasError)throw l.error;let R={...i??{},...l.result},M=Object.entries(o).map(([B,v])=>{let z=ye(v)(R[B],[a,B].filter(Boolean).join("."));return z.hasError&&console.error("ERROR IS HERE",z.error),[B,z]}),J=M.filter(([,B])=>B.hasError);if(J.length>0)throw J.reduce((B,[v,z])=>(B[v]=z,B),{});return M.reduce((B,[v,z])=>(z.hasError||z.result!==void 0&&(B[v]=z.result),B),R)}])},t}function st(r=[]){let e=O([],r,(t,n="")=>{if(t!==null)throw new c(n,`Value ${t} is not null`)});return e.toString=U(e,()=>String(null)),e.toNumber=C(e,()=>0),e.toBoolean=L(e,()=>!1),e.toCustom=N(e),e}function lt(){let r=O([],[],(e,t="")=>{if(e!==null)throw new c(t,`Value ${e} is not an error`)});return r.toString=U(r,e=>String(e)),r.toNumber=C(r,()=>0),r.toBoolean=L(r,()=>!1),r.toCustom=N(r),r}function ut(r){let e=(t,n="")=>{if(!t||typeof t!="object"||Array.isArray(t))return{initialValue:t,hasError:!0,error:new c(n,`Value ${t} is not a record`)};let o=Object.entries(t).map(([i,a],l)=>r(a,[i,`[${l}]`].filter(Boolean).join(".")));return o.some(i=>i.hasError)?{initialValue:t,hasError:!0,error:o.filter(i=>i.hasError)}:{hasError:!1,initialValue:t,result:t}};return e.toString=U(e,t=>String(t)),e.toNumber=C(e,t=>Number(t)),e.toBoolean=L(e,t=>!!t),e.toCustom=N(e),e.toArray=I(e),e}var s={string:me,number:ue,boolean:le,array:te,object:de,error:lt,null:st,undefined:fe,oneof:pe,stringUnion:ce,record:ut,optional:ye,anything:()=>r=>({initialValue:r,hasError:!1,result:r})};function D(r){return e=>!r(e).hasError}var ge=s.oneof(s.object().schema({type:s.string().allowed("inline")}),s.object().schema({type:s.string().equals("opfs"),location:s.string()}));var It=s.object().schema({call:s.string().equals("analyze_macro"),vba_stomping_detection:s.number(),max_ole_size:s.number(),is_old_format:s.boolean(),content_location:ge}),ct=D(It),vt=s.object().schema({call:s.string().equals("analyze_zip"),content_location:ge,file_name:s.string(),passwords:s.array().items(s.string()),vba_stomping_detection:s.number(),max_level:s.number(),max_zip_size:s.number(),max_ole_size:s.number()}),mt=D(vt),Mt=s.object().schema({call:s.string().equals("analyze_pdf"),content_location:ge}),pt=D(Mt);function ft(r){return!!(r&&typeof r=="object"&&!Array.isArray(r))}function be(r){return{success:!1,error:r}}function yt(r){return{success:!0,value:r}}function ke(r){try{let e=r();return gt(e)?e:yt(e)}catch(e){return be(e)}}async function G(r){try{let e=await r();return gt(e)?e:yt(e)}catch(e){return be(e)}}async function dt(r){let e=await r;return Dt(e)}function Dt(r){if(!r.success)throw r.error;return r.value}function gt(r){return ft(r)&&typeof r.success=="boolean"&&(r.success&&"value"in r||!r.success&&"error"in r)}function bt(r){return ke(()=>JSON.stringify(r))}var V=class r extends Error{_error;_type;_state;static SerializedType="JSONableError";constructor(e){super(typeof e=="string"?e:void 0),this._error=typeof e=="string"?this:e,this._type=r.SerializedType}toJSON(){return{__serialized_type:this._type,stack:this._error.stack,message:this._error.message,name:this._error.name,state:this._state}}static create(e){if(e instanceof Error)return new r(e);if(typeof e=="string"||typeof e=="boolean"||typeof e=="number"||typeof e=="symbol"||typeof e=="bigint"||typeof e=="function")return new r(e.toString());if($t(e))return jt(e);let t=bt(e);return t.success?new r(t.value):new r("Unserializeable data error")}setState(e){this._state=e}},Vt=s.object().schema({__serialized_type:s.string().equals(V.SerializedType),stack:s.optional(s.string()),message:s.string(),name:s.string(),state:s.anything()}),$t=D(Vt);function jt(r){let e=new Error;return e.stack=r.stack,e.name=r.name,e.message=r.message,new V(e)}var Ee=class r extends V{static SerializedType="UnexpectedResponseError";constructor(e,t={}){super(`Expected [${e}] response was not valid`),this._type=r.SerializedType,this.setState({expectedType:e,errors:t})}},qt=s.object().schema({__serialized_type:s.string().equals(Ee.SerializedType),stack:s.optional(s.string()),message:s.string(),name:s.string(),state:s.object().schema({expectedType:s.string(),errors:s.record(s.string())})}),oy=D(qt);var Ht=s.object().schema({result_type:s.string().allowed("string_literal","serialized_error"),result_value:s.string()});function Ae(r,e){return{result_type:r,result_value:e}}var bd=D(Ht);var Kt=s.object().schema({keepalive:s.oneof(s.number(),s.boolean().false()),maxConcurrency:s.oneof(s.string().equals("max"),s.number())}),Jt=s.object().schema({ready:s.boolean().true(),poolSettings:Kt}),Hd=D(Jt),Kd=$("offscreen.initialize_worker");function wt(r){self.postMessage("ready"),self.addEventListener("message",async e=>{let{bytes:t,parameters:n}=e.data;t!==null&&!(t instanceof Uint8Array)&&self.postMessage(Ae("serialized_error",JSON.stringify(V.create("Invalid binary data in request"))));try{let o=await r(t,n);self.postMessage(o)}catch(o){self.postMessage(Ae("serialized_error",JSON.stringify(V.create(o))))}})}var xt=$("common.opfs"),Te=class extends V{static SerializedType="OPFSError";constructor(e){let t=e instanceof Error?e.message:e;super(`Error during OPFS operation: ${t}`),this.setState({originalError:e})}},we=class r{static isSupported=()=>typeof navigator.storage?.getDirectory=="function";static async asFailable(e){let t=await G(e);return t.success?t:be(new Te(t.error instanceof Error?t.error:JSON.stringify(t)))}static async _getRootDirectory(){return navigator.storage.getDirectory()}static async _getDirectoryHandle(e){if(!e.endsWith("/")&&e!=="")throw new Error("path should end with / or should be blank for root");e==="/"&&(e="");let t=await r._getRootDirectory(),n=e.split("/"),o=t;for(let i=0;i<n.length-1;i++){let a=await G(()=>o.getDirectoryHandle(n[i],{create:!0}));if(a.success)o=a.value;else throw xt.error(`error getting directory handle for [${n[i]}]`,a.error),new Error(`error getting directory handle for [${n[i]}]`)}return o}static async _getFileHandle(e,t){let n=e.lastIndexOf("/"),o=await r._getDirectoryHandle(e.substring(0,n+1)),i=e.substring(n+1);return await o.getFileHandle(i,t)}static async _getFile(e){return(await this._getFileHandle(e,{create:!1})).getFile()}static async _getFileWriteStream(e,t){return(await this._getFileHandle(e,{create:t?.create??!1})).createWritable({keepExistingData:t?.keepExistingData??!1})}static async _writeFile(e,t,n={keepExistingData:!1}){let o=await r._getFileWriteStream(e,{keepExistingData:n.keepExistingData,create:!0});await o.write(t),await o.close()}static async getFileWriteStream(e,t){return r.asFailable(()=>r._getFileWriteStream(e,t))}static async writeFile(e,t,n){return r.asFailable(()=>r._writeFile(e,t,n))}static async getFileReadStream(e){return r.asFailable(async()=>(await r._getFile(e)).stream())}static async getFile(e){return r.asFailable(()=>r._getFile(e))}static async readFileHeader(e,t){return r.asFailable(async()=>{let n=(await r._getFile(e)).slice(0,t).stream(),o=new Response(n);return new Uint8Array(await o.arrayBuffer())})}static async readAllFileBytes(e){return r.asFailable(async()=>{let t=(await r._getFile(e)).stream(),n=new Response(t);return new Uint8Array(await n.arrayBuffer())})}static async readAllFileText(e){let t=await r.getFileReadStream(e);return t.success?r.asFailable(async()=>{let n=new TextDecoderStream;t.value.pipeTo(n.writable);let o=n.readable.getReader(),i=!1,a="";for(;!i;){let l=await o.read();l.value&&(a+=l.value),i=l.done}return a}):t}static async destroyFileInDir(e,t){return r.asFailable(async()=>await t.removeEntry(e,{recursive:!0}))}static async destroyFile(e){return r.asFailable(async()=>{let t=e.lastIndexOf("/"),n=await r._getDirectoryHandle(e.substring(0,t+1)),o=e.substring(t+1);return await n.removeEntry(o,{recursive:!0})})}static async _listFiles(e){let t=e.values(),n=[];for await(let o of t){let i=o;i.kind==="directory"?n.push(...await this._listFiles(i)):n.push({dirHandle:e,fileName:i.name})}return n}static async listFiles(e){let t=await G(()=>this._getDirectoryHandle(e));return t.success?this._listFiles(t.value):(xt.error("error getting handle",t.error),[])}};var Vg=$("worker.analyze_macro_file");async function Se(r,e){return e.type==="inline"?r:await dt(we.readAllFileBytes(e.location))}wt(async(r,e)=>{if(await We(),!r)throw new Error("Missing file content to analyze");if(ct(e))return Ue(await Se(r,e.content_location),e.vba_stomping_detection,e.max_ole_size,e.is_old_format);if(mt(e))return Ce(await Se(r,e.content_location),e.file_name,e.passwords,e.max_level,e.vba_stomping_detection,BigInt(e.max_zip_size),e.max_ole_size);if(pt(e))return Le(await Se(r,e.content_location));throw new Error("Unknown call or parameters")});})();
